<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>实现配置中心 | 余思博客</title><meta name="description" content="实现配置中心"><meta name="keywords" content="springcloud-alibaba"><meta name="author" content="余思"><meta name="copyright" content="余思"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="实现配置中心"><meta name="twitter:description" content="实现配置中心"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="实现配置中心"><meta property="og:url" content="http://envyzhan.top/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/"><meta property="og:site_name" content="余思博客"><meta property="og:description" content="实现配置中心"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://envyzhan.top/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/"><link rel="prev" title="Open API、存储和集群部署" href="http://envyzhan.top/2020/03/06/spring-cloud-alibaba-nacos-3-openapi-store-cluser/"><link rel="next" title="实现服务注册与发现" href="http://envyzhan.top/2020/03/02/spring-cloud-alibaba-nacos-1-implement-service-registration-and-discovery/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://envythink.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: 余思","link":"链接: http://envyzhan.top/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/","source":"来源: 余思博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">余思博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-html5" aria-hidden="true"></i><span> 前端</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> Java</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 运维</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 中间件</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page" href="/categories/nginx/"><i class="fa-fw fa fa-location-arrow"></i><span> Nginx</span></a></li><li><a class="site-page" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bell" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/categories/algorithm/"><i class="fa-fw fa fa-plane"></i><span> 算法建模</span></a></li><li><a class="site-page" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-address-book" aria-hidden="true"></i><span> 生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">213</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-html5" aria-hidden="true"></i><span> 前端</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> Java</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 运维</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 中间件</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page" href="/categories/nginx/"><i class="fa-fw fa fa-location-arrow"></i><span> Nginx</span></a></li><li><a class="site-page" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bell" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/categories/algorithm/"><i class="fa-fw fa fa-plane"></i><span> 算法建模</span></a></li><li><a class="site-page" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-address-book" aria-hidden="true"></i><span> 生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#写在前面"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">写在前面</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#快速入门"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">快速入门</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建配置"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">创建配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建应用"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">创建应用</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#服务端配置详解"><span class="toc_mobile_items-number"></span> <span class="toc_mobile_items-text">服务端配置详解</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#加载规则"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">加载规则</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#多环境管理"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">多环境管理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#使用Data-ID配合profiles来实现"><span class="toc_mobile_items-number">2.0.1.</span> <span class="toc_mobile_items-text">使用Data ID配合profiles来实现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#使用Group实现"><span class="toc_mobile_items-number">2.0.2.</span> <span class="toc_mobile_items-text">使用Group实现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#使用Namespace实现"><span class="toc_mobile_items-number">2.0.3.</span> <span class="toc_mobile_items-text">使用Namespace实现</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#怎么选择"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">怎么选择</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#注意事项"><span class="toc_mobile_items-number">3.0.1.</span> <span class="toc_mobile_items-text">注意事项</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#加载多个配置"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">加载多个配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#共享配置"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">共享配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#配置加载的优先级"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">配置加载的优先级</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#写在前面"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#快速入门"><span class="toc-number"></span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建配置"><span class="toc-number">1.</span> <span class="toc-text">创建配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建应用"><span class="toc-number">2.</span> <span class="toc-text">创建应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#服务端配置详解"><span class="toc-number"></span> <span class="toc-text">服务端配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#加载规则"><span class="toc-number">1.</span> <span class="toc-text">加载规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多环境管理"><span class="toc-number">2.</span> <span class="toc-text">多环境管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#使用Data-ID配合profiles来实现"><span class="toc-number">2.0.1.</span> <span class="toc-text">使用Data ID配合profiles来实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用Group实现"><span class="toc-number">2.0.2.</span> <span class="toc-text">使用Group实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用Namespace实现"><span class="toc-number">2.0.3.</span> <span class="toc-text">使用Namespace实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#怎么选择"><span class="toc-number">3.</span> <span class="toc-text">怎么选择</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#注意事项"><span class="toc-number">3.0.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载多个配置"><span class="toc-number">4.</span> <span class="toc-text">加载多个配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#共享配置"><span class="toc-number">5.</span> <span class="toc-text">共享配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置加载的优先级"><span class="toc-number">6.</span> <span class="toc-text">配置加载的优先级</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">实现配置中心</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-04</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/springcloud/">springcloud</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">7.3k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 24 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>在前面分析Nacos的<code>pom.xml</code>依赖文件时，我们发现Nacos不仅支持Eureka的服务发现与注册外，还具有Ribbon的客户端负载均衡、Config的分布式配置等功能。那么本篇就来学习最后的一个功能，如何使用Nacos实现配置中心这一目的。</p>
<p>通过Nacos的配置管理，开发者可以将整个架构体系中的所有配置都集中在Nacos中进行存储。</p>
<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><p>接下来将演示如何使用Nacos实现配置中心，主要包括如何在Nacos中创建配置内容和如何在Spring Cloud应用中加载Nacos配置中心的配置信息。</p>
<h3 id="创建配置"><a href="#创建配置" class="headerlink" title="创建配置"></a>创建配置</h3><p>请注意这里依旧不像之前在学习Spring Cloud Config实现配置中心时那样，需要先创建一个Spring Boot应用作为config-server，那是因为这里的Nacos既是一个“eureka-server”项目，还是一个“config-server”项目，因此配置中心服务端项目其实可以复用之前的<code>nacos-server-1.3.1</code>，但是需要进行一些配置修改，如下所示：</p>
<p>第一步，启动Nacos服务端，点击左侧的配置管理—>配置列表，然后点击右上角的“+”按钮，进入“新建配置”页面，填写下图所示的内容：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-06b36872c21502ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-06b36872c21502ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-a04fcc0840baa3a1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-a04fcc0840baa3a1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>解释一下上述参数的含义：</p>
<ul>
<li><code>Data ID</code>，这个是服务配置文件的全称，格式为<code>服务名.配置格式</code>，这里填入<code>config-client.properties</code>；</li>
<li><code>Group</code>，这里不修改，使用默认的组，值为DEFAULT_GROUP；</li>
<li><code>配置格式</code>，一般是YAML或者Properties，笔者这里选择Properties；</li>
<li><code>配置内容</code>，这个是应用需要加载的配置信息，也就是<code>Data ID</code>文件中的内容，这里笔者设置了三条参数：<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-client</span><br><span class="line">server.port=8020</span><br><span class="line">envythink=prod-1.0</span><br></pre></td></tr></tbody></table></figure></div>
看到这里你会发现这个和Spring Cloud Config不同，这里居然自己设置了应用的配置信息，然后运用直接就可以从它这里获取配置信息。而在Spring Cloud Config则是采用Git来存储配置信息，它需要用户配置Git仓库地址信息、用户信息，然后通过git clone命令将配置信息从Git仓库中复制一份在本地进行存储，然后读取这些内容并返回给微服务应用进行加载。</li>
</ul>
<h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><p><strong>第一步，创建Spring Boot项目。</strong>使用<code>Spring Initializr</code>工具创建一个Spring Boot应用，名称为<code>config-client</code>，请注意这个名字尽量与之前的<code>Data ID</code>保持一致。</p>
<p><strong>第二步，编辑依赖文件。</strong>编辑项目的pom.xml依赖文件，添加如下配置信息：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><parent></parent></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line">    <artifactid>spring-boot-starter-parent</artifactid></span><br><span class="line">    <version>2.3.2.RELEASE</version></span><br><span class="line">    <relativepath> <!-- lookup parent from repository --></relativepath></span><br><span class="line"></span><br><span class="line"><dependencymanagement></dependencymanagement></span><br><span class="line">    <dependencies></dependencies></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.cloud</groupid></span><br><span class="line">            <artifactid>spring-cloud-dependencies</artifactid></span><br><span class="line">            <version>Hoxton.SR8</version></span><br><span class="line">            <type>pom</type></span><br><span class="line">            <scope>import</scope></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>com.alibaba.cloud</groupid></span><br><span class="line">            <artifactid>spring-cloud-alibaba-dependencies</artifactid></span><br><span class="line">            <version>2.2.3.RELEASE</version></span><br><span class="line">            <type>pom</type></span><br><span class="line">            <scope>import</scope></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><dependencies></dependencies></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework.boot</groupid></span><br><span class="line">        <artifactid>spring-boot-starter-web</artifactid></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>com.alibaba.cloud</groupid></span><br><span class="line">        <artifactid>spring-cloud-starter-alibaba-nacos-config</artifactid></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.projectlombok</groupid></span><br><span class="line">        <artifactid>lombok</artifactid></span><br><span class="line">        <version>1.18.2</version></span><br><span class="line">        <optional>true</optional></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework.boot</groupid></span><br><span class="line">        <artifactid>spring-boot-starter-test</artifactid></span><br><span class="line">        <scope>test</scope></span><br><span class="line">        <exclusions></exclusions></span><br><span class="line">            <exclusion></exclusion></span><br><span class="line">                <groupid>org.junit.vintage</groupid></span><br><span class="line">                <artifactid>junit-vintage-engine</artifactid></span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><build></build></span><br><span class="line">    <plugins></plugins></span><br><span class="line">        <plugin></plugin></span><br><span class="line">            <groupid>org.springframework.boot</groupid></span><br><span class="line">            <artifactid>spring-boot-maven-plugin</artifactid></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>特别注意其中Spring Cloud、Spring Cloud Alibaba和Spring Boot这三者的版本信息，这个在前面已经介绍了。同时需要将之前使用的<code>spring-cloud-starter-alibaba-nacos-discovery</code>依赖修改为<code>spring-cloud-starter-alibaba-nacos-config</code>，这也就说明Nacos的服务注册与发现功能和配置中心这两个功能是可以独立使用的，需要使用什么功能就添加对应的依赖即可：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><!--Nacos配置中心功能--></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.alibaba.cloud</groupid></span><br><span class="line">    <artifactid>spring-cloud-starter-alibaba-nacos-config</artifactid></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><!--Nacos服务注册与发现功能--></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.alibaba.cloud</groupid></span><br><span class="line">    <artifactid>spring-cloud-starter-alibaba-nacos-discovery</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p><strong>第三步，提供一个访问接口。</strong>由于这是一个web工程，因此可以添加一个Controller，并提供一个访问入口。在项目目录下新建controller包，并在里面新建HelloController文件，其中的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@RefreshScope</span><br><span class="line">@RestController</span><br><span class="line">public class HelloController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private Environment environment;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Value("${envythink}")</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @GetMapping(value = "/hello")</span><br><span class="line">    public String hello(){</span><br><span class="line">        log.info("envythink is "+name);</span><br><span class="line">        return name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @GetMapping(value = "/world")</span><br><span class="line">    public String world(){</span><br><span class="line">        log.info("the world method is calling");</span><br><span class="line">        return environment.getProperty("envythink","未定义");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>关于上述代码，这里有几点需要引起注意：（1）先定义envythink这个属性，然后通过<code>@Value</code>注解来绑定配置服务中配置的envythink属性；（2）除了通过使用<code>@Value</code>注解来对属性进行绑定注入外，还可以使用Environment对象来获取配置属性，需要注意的是这个Environment对象存在于<code>org.springframework.core.env.Environment</code>包内，导包不能出错；（3） 其中的<code>@RefreshScope</code>注解用于实现配置和实例的刷新。</p>
<p><strong>第四步，属性配置。</strong>在<code>application.properties</code>配置文件同级目录下新建一个<code>bootstrap.properties</code>文件(注意名字不能修改)，然后在里面用于配置一些信息，用于获取配置文件<code>config-client</code>的位置：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-client</span><br><span class="line">server.port=8020</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意由于此处使用的是Nacos的配置中心功能，没有使用期服务注册与发现功能，因此这里使用<code>spring.cloud.nacos.config.server-addr</code>参数来绑定Nacos配置中心地址。再次强调这里的配置文件名称必须为<code>bootstrap.properties</code>，因为它的优先级高于<code>application.properties</code>配置文件，且其中<code>spring.application.name</code>必须是前面在Nacos配置中设置的<code>Data Id</code>。</p>
<p><strong>第五步，启动项目。</strong>首先确保之前下载的nacos服务已经正常运行，然后启动这里名为<code>config-client</code>的服务，可以发现在其控制台输出如下信息：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Located property source: [BootstrapPropertySource {name='bootstrapProperties-config-client.properties,DEFAULT_GROUP'}, BootstrapPropertySource {name='bootstrapProperties-config-client,DEFAULT_GROUP'}]</span><br></pre></td></tr></tbody></table></figure></div>
<p>也就是说这里会先读取之前我们在<code>bootstrap.properties</code>启动文件中设置的信息，并后续通过这些参数来从Nacos配置中心获取配置信息。</p>
<p><strong>第六步，验证配置获取和动态刷新。</strong>开发者最简单的验证方式就是直接打开浏览器访问<code>http://localhost:8020/hello</code>，如果返回prod-1.0也就是之前在Nacos中配置的信息，说明已经可以获取到配置信息：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-99d95375408e31fb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-99d95375408e31fb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>将下来直接修改Nacos配置中心的配置项，将其中envythink的值由prod-1.0修改为prod-111.0，之后点击发布，并再次访问该接口，可以看到返回信息发生了变化：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-a2b52384dbbe0159.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-a2b52384dbbe0159.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-e12829f4621f67f0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-e12829f4621f67f0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>同时仔细观察config-client项目的输出控制台，发现已经出现提示envythink配置刷新的信息：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-90cde0a5d8ce48a0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-90cde0a5d8ce48a0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>这样Nacos配置中心的基础入门学习就完成了，按照之前学习Spring Cloud Config的顺序，接下来应当是介绍Nacos服务端和客户端的相关配置。</p>
<h1 id="服务端配置详解"><a href="#服务端配置详解" class="headerlink" title="服务端配置详解"></a>服务端配置详解</h1><p>尽管Nacos官方提供了Nacos服务端应用，但是这已经是打包好的程序，我们之前使用的都是默认配置，接下来就仿照学习zipkin-server时的情形，来根据一些环境参数来自定义服务端配置。</p>
<h3 id="加载规则"><a href="#加载规则" class="headerlink" title="加载规则"></a>加载规则</h3><p>在入门例子中，我们都是完全采用了默认的配置，那么在此种条件下Nacos是如何加载配置信息的呢？</p>
<p>之前我们在Nacos中创建的配置内容是这样的：<br>（1）<code>Data ID</code>为<code>config-client.properties</code>；<br>（2）<code>Group</code>使用了默认的DEFAULT_GROUP；<br>（3）<code>配置格式</code>选择Properties；<br>（4）<code>配置内容</code>填写以下信息：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-client</span><br><span class="line">server.port=8020</span><br><span class="line">envythink=prod-1.0</span><br></pre></td></tr></tbody></table></figure></div>
<p>接下来对上述配置内容进行拆分，这里主要涉及到三个参数，它们与具体应用的配置对应关系如下：<br>（1）<code>Data ID</code>中的<code>config-client</code>其实对应于客户端中<code>spring.cloud.nacos.config.prefix</code>参数，其值默认为<code>${spring.application.name}</code>，也就是服务名称；<br>（2）<code>Data ID</code>中的<code>properties</code>其实对应于客户端中<code>spring.cloud.nacos.config.file-extension</code>参数，其值默认为properties；<br>（3）<code>Group</code>其实对应于客户端中<code>spring.cloud.nacos.config.group</code>参数，其值默认为DEFAULT_GROUP。<br>至于其中的<code>配置格式</code>其实也就是（2）中的参数，<code>配置内容</code>其实也就是配置文件中的内容。</p>
<p>接下来依旧使用之前的config-client项目，通过手动修改一些参数来演示这些参数的使用，并加深对上述参数与客户端之间的对应关系的理解与印象。</p>
<p><strong>场景1</strong>：不通过服务名来加载，则是自定义名称，但是组依旧是使用DEFAULT_GROUP，那么就可以通过在客户端config-client项目的<code>bootstrap.properties</code>启动文件中添加如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.prefix=config-client</span><br></pre></td></tr></tbody></table></figure></div>
<p>因为前面之所以配置<code>spring.application.name</code>也能实现这个目的，那是因为<code>spring.cloud.nacos.config.prefix</code>参数默认值为<code>spring.application.name</code>的缘故，要知道其真正是通过上述参数来控制的。</p>
<hr>
<p><strong>场景2</strong>：不通过服务名来加载，自定义组名为ENVY_GROUP，此时仍可以通过在客户端config-client项目的bootstrap.properties启动文件中添加如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.prefix=config-client</span><br><span class="line">spring.cloud.nacos.config.group=ENVY_GROUP</span><br></pre></td></tr></tbody></table></figure></div>
<hr>
<p><strong>场景3</strong>：不通过服务名来加载，自定义组名为ENVY_GROUP，且使用YAML格式的配置文件，此时还此时还可以通过在客户端config-client项目的bootstrap.properties启动文件中添加如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.prefix=config-client</span><br><span class="line">spring.cloud.nacos.config.group=ENVY_GROUP</span><br><span class="line">spring.cloud.nacos.config.file-extension=yaml</span><br></pre></td></tr></tbody></table></figure></div>
<p>其实上面这三个参数中场景1和场景3的参数配置没什么特殊，主要是场景2中组的设置有时候可以派上大用处，尤其是在公司产品线较多的情况下，可以解决同名应用的冲突问题，正常情况下都可以使用它来区分不同用途或者不同环境的配置。</p>
<h3 id="多环境管理"><a href="#多环境管理" class="headerlink" title="多环境管理"></a>多环境管理</h3><p>其实Nacos本身就具有多个不同管理级别的概念，像之前学到的Data ID、Group和NameSpace等，既然讲到了Nacos可以实现多环境的配置，那么接下来就学习Nacos如何实现多环境的配置。</p>
<h5 id="使用Data-ID配合profiles来实现"><a href="#使用Data-ID配合profiles来实现" class="headerlink" title="使用Data ID配合profiles来实现"></a>使用<code>Data ID</code>配合<code>profiles</code>来实现</h5><p>其实这个<code>Data ID</code>官方定义是配置集ID，而配置集是一组相关或者不相关的配置项的集合。在系统中，一个配置文件通常就是一个配置集，里面包含了系统各个方面的配置记录，如前面在创建配置时需要设置的几项参数，当然也可能包含数据源、线程池以及日志级别的配置项等信息。</p>
<p>那自然配置集ID就是用来唯一标识某个配置集，它是组织划分配置的一个维度。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。<code>Data ID</code>通常采用类Java包（如 <code>com.envy.tk.refund.log.level</code>）的命名规则来保证全局的唯一性。请注意此命名规则非强制，开发者可自定义设置。</p>
<p>在学习Spring Cloud Config服务端的配置一文中讲到，Config客户端应用启动时，会根据<code>bootstrap.properties</code>配置文件中配置的应用名<code>{ application }</code>、环境名<code>{ profile }</code>、分支名<code>{ label }</code>、Config Server地址等信息，向Config Server请求来获取配置信息。</p>
<p>既然Nacos底层使用了Config，那么也是具有类似的操作，只不过这些参数都是由Nacos配置中心来设置的。通过前面的学习，我们可以将Nacos中的Data ID理解为是一个Spring Cloud应用的配置文件名称，它默认的名称格式为：<code>${spring.application.name}.properties</code>。</p>
<p>既然使用了Config，那么这个<code>Data ID</code>的名称规则其实也应该包含逻辑，就像在Spring Cloud Config中使用<code>spring.profiles.active</code>参数来指定具体的环境名称，因此这里的<code>Data ID</code>其实就可以修改为<code>${spring.application.name}-${spring.profiles.active}.properties</code>这一格式。如果把之前在加载规则中学到的3个参数也添加进来，并进行修改的话，那么此时<code>Data ID</code>的完整格式如下所示：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">${spring.cloud.nacos.config.prefix}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</span><br></pre></td></tr></tbody></table></figure></div>
<p>如果其中的<code>${spring.cloud.nacos.config.prefix}</code>和<code>${spring.cloud.nacos.config.file-extension}</code>都使用默认值，那么就变成了<code>${spring.application.name}-${spring.profiles.active}.properties</code>，正常我们都使用后者。其实这也能体现出Spring Boot提倡的习惯优于配置这一设计理念。</p>
<p>前面说的都是理论知识，接下来将通过基于前面的例子实现的一个demo来演示Nacos如何多环境管理。</p>
<p><strong>第一步，在Nacos中创建多环境配置。</strong>按照图示在Nacos中配置多环境，这里配置了三个环境：默认、TEST和PROD：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-a1df275f09bcc5d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-a1df275f09bcc5d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中PROD环境的envythink值与之保持一致，且端口号为8021：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-61dc703ec325e88d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-61dc703ec325e88d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>而TEST环境的envythink值也与之保持一致，且端口号为8022：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-99bd8b010781c2f1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-99bd8b010781c2f1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第二步，指定使用环境。</strong>在config-client客户端的<code>bootstrap.properties</code>启动文件中指定要获取的环境，可以通过如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Nacos多环境参数配置</span><br><span class="line">spring.profiles.active=TEST</span><br><span class="line">spring.application.name=config-client</span><br><span class="line"># Nacos配置中心配置</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意这里通过应用名称和使用环境组合来确定应该去Config配置中心查找获取和使用哪个配置文件来使用，其实得到就是<code>config-client-TEST.properties</code>文件中的内容。</p>
<p><strong>第三步，启动项目并测试。</strong>首先确保之前下载的nacos服务已经正常运行，然后启动这里名为config-client的服务，并打开浏览器访问<code>http://localhost:8022/hello</code>，如果返回TEST也就是之前在Nacos中配置的信息，说明已经可以获取到配置信息，且config-client服务是以<code>config-client-TEST.properties</code>文件来启动的：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-e96cda839b511afa.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-e96cda839b511afa.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>开发者甚至可以使用<code>netstat -aon|findstr 8022</code>来查看端口的使用情况，这一点会更加证实上述结果。</p>
<p>当然也可以通过观察config-client项目的输出台信息来进行验证：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-9383f92e5d208ea8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-9383f92e5d208ea8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<h5 id="使用Group实现"><a href="#使用Group实现" class="headerlink" title="使用Group实现"></a>使用<code>Group</code>实现</h5><p>在前面我们提到过使用Group可以很容易解决<code>Data ID</code>冲突的问题，其实如果把一个环境的配置看成一个组，那么对于多环境的配置管理不就转变成了对于组的管理么，这不就是<code>Group</code>干的事么？其实这个<code>Group</code>用起来非常灵活，针对不同的应用场景可以实现不同的目的，从架构运维角度可以认为是对多环境的管理；从业务角度可以认为是对不同模块的参数管理。不过这样容易产生冲突，因此在最初架构设计的时候，需要进行一定的规划和设计，不过这里先来学习如何使用<code>Group</code>来实现从运维角度的多环境管理。</p>
<p>Group在官方文档中是配置分组，它也是组织配置的维度之一。开发者可以通过一个有意义的字符串来对配置集进行分组，从而区分<code>Data ID</code>相同的配置集。前面也说了如果开发者未填写配置分组的名称，则配置分组的名称默认采用DEFAULT_GROUP，一般是在不同应用或组件使用了相同的配置类型的情况下才使用配置分组，如<code>database_url</code>配置和<code>MQ_topic</code>配置。</p>
<p><strong>第一步，在Nacos中创建多GROUP组配置。</strong>按照图示在Nacos中配置多GROUP组，这里配置了三个GROUP组：DEFAULT_GROUP、TEST_GROUP和PROD_GROUP，请注意这三者的<code>Data ID</code>完全是一样的，如下所示：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-85aa2ebfd9865a90.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-85aa2ebfd9865a90.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中TEST_GROUP组的envythink值为<code>test-group</code>，且端口号为8023：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-00770a536aa8caee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-00770a536aa8caee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中PROD_GROUP组的envythink值为<code>prod-group</code>，且端口号为8024：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-016283f9266fdd53.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-016283f9266fdd53.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第二步，指定使用环境。</strong>在config-client客户端的<code>bootstrap.properties</code>启动文件中指定要获取的环境，可以通过如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Nacos多环境参数配置</span><br><span class="line"># 使用GROUP来实现</span><br><span class="line">spring.cloud.nacos.config.group=PROD_GROUP</span><br><span class="line">spring.application.name=config-client</span><br><span class="line"># Nacos配置中心配置</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意这里通过应用名称和组名组合来确定应该去Config配置中心查找获取和使用哪个配置文件来使用，其实得到就是PROD_GROUP分组下的<code>config-client.properties</code>文件中的内容。</p>
<p><strong>第三步，启动项目并测试。</strong>首先确保之前下载的nacos服务已经正常运行，然后启动这里名为config-client的服务，并打开浏览器访问<code>http://localhost:8024/hello</code>，如果返回prod-group也就是之前在Nacos中配置的信息，说明已经可以获取到配置信息，且config-client服务是以PROD_GROUP分组下的<code>config-client.properties</code>文件来启动的：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-c96992ecbcd7ff6b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-c96992ecbcd7ff6b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>开发者甚至可以使用<code>netstat -aon|findstr 8024</code>来查看端口的使用情况，这一点会更加证实上述结果。</p>
<p>当然也可以通过观察config-client项目的输出台信息来进行验证：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-2237c328f8f11178.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-2237c328f8f11178.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<h5 id="使用Namespace实现"><a href="#使用Namespace实现" class="headerlink" title="使用Namespace实现"></a>使用<code>Namespace</code>实现</h5><p>在前面我们提到了<code>Data ID</code>和<code>GROUP</code>，但是接下来即将学习的<code>Namespace</code>应该是第一次接触的。</p>
<p>官方对于Namespace命名空间的定义是这样的，用于对租户粒度的配置隔离。租户粒度就意味这这个权限粒度很粗，甚至超出了之前两个的权限控制，也就是说在不同的命名空间下，可以存在相同的Group和<code>Data ID</code>。Namespace命名空间的常用场景是针对不同环境的配置的区分隔离，如开发测试环境和生产环境的资源（如配置、服务）隔离等。更多参数的介绍可以点击 <a href="https://nacos.io/zh-cn/docs/concepts.html" target="_blank" rel="noopener">这里</a>进行学习。</p>
<p>也就是说之前的Group尽管可以实现不同环境的管理，但是似乎使用这里的Namespace命名空间是更合适的。</p>
<p><strong>第一步，在Nacos中创建多Namespace命令空间配置。</strong>按照图示在Nacos中配置多Namespace命令空间，这里配置了三个Namespace命令空间：默认的Public、TEST和PROD，如下所示：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-8b503bbb0507b112.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-8b503bbb0507b112.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中Namespace命令空间为TEST的envythink值为test-namespace，且端口号为8025：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-7f5034669f97d89b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-7f5034669f97d89b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-77fd39ae2a4edee9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-77fd39ae2a4edee9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中Namespace命令空间为PROD的envythink值为prod-namespace，且端口号为8026：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-1aa3c6a1b834886b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-1aa3c6a1b834886b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-90e28c72813d9d43.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-90e28c72813d9d43.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第二步，指定使用环境。</strong>在config-client客户端的<code>bootstrap.properties</code>启动文件中指定要获取的环境，可以通过如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Nacos多环境参数配置</span><br><span class="line"># 使用Namespace来实现</span><br><span class="line">spring.cloud.nacos.config.namespace=dde555e6-2539-4d50-be82-1384222324d2</span><br><span class="line">spring.application.name=config-client</span><br><span class="line"># Nacos配置中心配置</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意这里通过应用名称和命名空间组合来确定应该去Config配置中心查找获取和使用哪个配置文件来使用，注意<code>spring.cloud.nacos.config.namespace</code>后面配置的是命名空间对应的ID，而不是命名空间的名称，这样得到就是名为TEST的命名空间下的<code>config-client.properties</code>文件中的内容：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-51016210834d5af4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-51016210834d5af4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第三步，启动项目并测试。</strong>首先确保之前下载的nacos服务已经正常运行，然后启动这里名为config-client的服务，并打开浏览器访问<code>http://localhost:8025/hello</code>，如果返回test-namespace也就是之前在Nacos中配置的信息，说明已经可以获取到配置信息，且config-client服务是以命名空间为TEST下的<code>config-client.properties</code>文件来启动的：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-c7fde33c4e3d11dc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-c7fde33c4e3d11dc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>开发者甚至可以使用<code>netstat -aon|findstr 8025</code>来查看端口的使用情况，这一点会更加证实上述结果。</p>
<p>当然也可以通过观察config-client项目的输出台信息来进行验证：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-bd175e565cfb26af.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-bd175e565cfb26af.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<h3 id="怎么选择"><a href="#怎么选择" class="headerlink" title="怎么选择"></a>怎么选择</h3><p>有时候解决办法多了，对于选择哪种解决办法也是一件非常令人头疼的事，尤其是具有选择困难症的处女座，当然我不是处女座，但是也是很烦的。笔者通过搜寻一些文章，这里将这三种方式实现的优劣势进行了汇总，这样大家可以在选择使用的时候进行参考。</p>
<p><strong>第一种，通过<code>Data ID</code>配合<code>profiles</code>来实现。</strong></p>
<ul>
<li><strong>优点：</strong>很显然与Spring Cloud Config的配置相似，因此熟悉Spring Cloud Config的童鞋可以无缝衔接，无需额外的学习；</li>
<li><strong>缺点：</strong>当项目和环境都很多的时候，此时配置内容就会显得非常混乱，配置列表会显示各种不同类别，不同环境的应用。</li>
<li><strong>使用建议：</strong>当项目和环境不多的时候使用，也可以结合Group来对项目依据业务或者组织架构进行划分管理。</li>
</ul>
<hr>
<p><strong>第二种，通过<code>Group</code>来实现。</strong></p>
<ul>
<li><strong>优点：</strong>可以将各个应用的环境通过分组来进行管理，可以解决同名配置的问题，同时Group和<code>Data ID</code>是比较基础的数据，在创建配置时就可以设置，且后续可以通过Group和<code>Data ID</code>来实现配置搜索功能；</li>
<li><strong>缺点：</strong>需要使用Group，因此前期需要对Group做好较为完善的规划，否则后续会产生比较大的问题。</li>
<li><strong>使用建议：</strong>Group组规划的较为合理，应用分类不会出现重复的情况时可以使用，但是对于这个Group组的规划很难做到合理。</li>
</ul>
<hr>
<p><strong>第三种，通过<code>Namespace</code>命名空间来实现。</strong></p>
<ul>
<li><strong>优点：</strong>这是三者中粒度最粗的控制，也就意味着允许存在相同的<code>Group</code>和<code>Data ID</code>，这无疑更加适合多环境的场景。同时Namespace是分组显示，不需要使用搜索就可以隔离不同的环境配置；</li>
<li><strong>缺点：</strong>应该说目前没发现有什么较为大的缺点，非要说的话就是多了一个概念而已。</li>
<li><strong>使用建议：</strong>优先选择此种方式，可以获得最大的效益。如果是应用和环境较少的情况下，使用前两种似乎也无可厚非，但是这种似乎是面向未来的实现。<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5>现在需要指出一个问题，之前我们都是将指定环境的参数写在了config-client项目的<code>bootstrap.properties</code>启动文件中：<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Nacos多环境参数配置</span><br><span class="line"># 使用Data ID来实现</span><br><span class="line">spring.profiles.active=TEST</span><br><span class="line"></span><br><span class="line"># Nacos多环境参数配置</span><br><span class="line"># 使用GROUP来实现</span><br><span class="line">spring.cloud.nacos.config.group=PROD_GROUP</span><br><span class="line"></span><br><span class="line"># Nacos多环境参数配置</span><br><span class="line"># 使用Namespace来实现</span><br><span class="line">spring.cloud.nacos.config.namespace=dde555e6-2539-4d50-be82-1384222324d2</span><br></pre></td></tr></tbody></table></figure></div>
这是不合理的操作，正确的做法是在发布脚本的启动命令中使用<code>-D</code>参数并配置上述选项参数来动态指定配置，这似乎是更合理的操作。</li>
</ul>
<h3 id="加载多个配置"><a href="#加载多个配置" class="headerlink" title="加载多个配置"></a>加载多个配置</h3><p>前面学习的加载配置都是直接加载一个配置文件，但是在实际开发过程中经常会遇到这么一种情况：一个配置文件内的信息是由多个配置文件组合而成的，这种做法非常常见，根据配置信息的具体作用存储到不同的配置文件中，这样不仅利于识别和归类，也便于共享不同配置信息给不同的应用。</p>
<p>Nacos在设计之初时就考虑到了这一点，通过加载不同的配置文件来实现配置信息的集中使用。</p>
<p>我们知道Nacos配置内容中的三个参数与具体应用的配置对应关系如下所示：<br>（1）<code>Data ID</code>中的config-client其实对应于客户端中<code>spring.cloud.nacos.config.prefix</code>参数，其值默认为<code>${spring.application.name}</code>，也就是服务名称；<br>（2）<code>Data ID</code>中的properties其实对应于客户端中<code>spring.cloud.nacos.config.file-extension</code>参数，其值默认为properties；<br>（3）Group其实对应于客户端中<code>spring.cloud.nacos.config.group</code>参数，其值默认为DEFAULT_GROUP。</p>
<p>也就是说默认情况下，<code>Data ID</code>的值为<code>${spring.application.name}.properties</code>，而Group的值为DEFAULT_GROUP。你可能有些好奇，不是介绍Nacos加载多个配置么，怎么又回到了开头介绍的Nacos配置内容中的三个参数呢？那是因为这三个参数非常重要，接下来就通过一个实际的例子来演示Nacos如何加载多个配置。</p>
<p><strong>例子：</strong>假设目前Nacos已经将所有应用的数据库配置信息和日志输出信息进行统一的配置管理，现在希望将Nacos中集中管理的配置信息进行拆分，分别将这些数据拆分到分开存放的数据库配置文件<code>database.properties</code>和日志输出配置文件<code>log.properties</code>中。此时开发者只需要进行如下三步操作：</p>
<p><strong>第一步，在Nacos中创建多<code>Dada ID</code>环境配置。</strong>按照图示在Nacos中配置多<code>Dada ID</code>环境，这里配置了两个<code>Dada ID</code>环境：<code>database.properties</code>和<code>log.properties</code>，如下所示：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-e48a063d797af4c7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-e48a063d797af4c7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中<code>Data ID</code>为<code>database.properties</code>的端口号为8027，group使用的是默认的DEFAULT_GROUP，同时我们还设置了一个envythink属性，其值为multi-config。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-07e11463990c143e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-07e11463990c143e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>其中<code>Data ID</code>为<code>log.properties</code>的端口号为8027，group使用的是默认的DEFAULT_GROUP：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-6e2ae63d2855c2ae.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-6e2ae63d2855c2ae.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第二步，指定使用环境。</strong>在config-client客户端的<code>bootstrap.properties</code>启动文件中（正常是发布脚本的命令中通过指定参数来动态指定）指定要获取的环境，可以通过如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Nacos配置中心配置</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br><span class="line"># Nacos加载多个配置</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=database.properties</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].data-id=log.properties</span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].refresh=true</span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意这里笔者使用<code>spring.cloud.nacos.config.extension-configs</code>参数来配置要加载的这上述两个配置内容。通过查看其源码可以知道，它是一个<code>NacosConfigProperties.Config</code>类型的数组，然后查看这个<code>NacosConfigProperties.Config</code>类型的源码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static class Config {</span><br><span class="line">        private String dataId;</span><br><span class="line">        private String group;</span><br><span class="line">        private boolean refresh;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>可以看到它有三个参数，dataid就是我们前面介绍的<code>Data ID</code>配置集ID；group就是Group配置分组；refresh比较特殊，之前没有介绍，它用来控制这个配置文件中的内容是否支持自动刷新，默认情况下，只有默认加载的配置才会自动刷新，而对于扩展的配置内容，则必须设置该参数为true时才会自动刷新。</p>
<p>通过这里的配置就可以得到组名为DEFAULT_GROUP下的<code>database.properties</code>和<code>log.properties</code>文件中的内容：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-0e0b3ec5c0b430c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-0e0b3ec5c0b430c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-0b7d1c5ca3cf4cea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-0b7d1c5ca3cf4cea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p><strong>第三步，启动项目并测试。</strong>首先确保之前下载的nacos服务已经正常运行，然后启动这里名为config-client的服务，并打开浏览器访问<code>http://localhost:8027/hello</code>，可以看到结果返回multi-config：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-e354ec87d4c23a1d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-e354ec87d4c23a1d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<h3 id="共享配置"><a href="#共享配置" class="headerlink" title="共享配置"></a>共享配置</h3><p>其实眼尖的童鞋在前面查看extensionConfigs源码的时候就发现了一个名为sharedConfigs的属性，且两者都是一个<code>NacosConfigProperties.Config</code>类型的数组，里面存放的都是同一个<code>NacosConfigProperties.Config</code>对象。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-a38bcac79eebb208.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-a38bcac79eebb208.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>因此两者的使用似乎没有差别，唯一不同的则是体现在config-client客户端的<code>bootstrap.properties</code>启动文件中配置参数：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Nacos配置中心配置</span><br><span class="line">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span><br><span class="line"># Nacos共享配置</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].data-id=database.properties</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].refresh=true</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.shared-configs[1].data-id=log.properties</span><br><span class="line">spring.cloud.nacos.config.shared-configs[1].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.shared-configs[1].refresh=true</span><br></pre></td></tr></tbody></table></figure></div>
<p>仅仅是将前面的extension-configs换成了shared-configs，就实现了从加载多配置到共享配置的实现，也就是说其实这里的加载多配置和共享配置其实是相同的功能。</p>
<h3 id="配置加载的优先级"><a href="#配置加载的优先级" class="headerlink" title="配置加载的优先级"></a>配置加载的优先级</h3><p>前面三种方式都能加载多个配置，那么这样就存在一个问题，当我们同时使用三种配置方式来加载多个配置时，这三者加载的优先级是怎样的。这三种配置方式如下所示：<br>（1）通过使用前面多次提到的三个参数<code>spring.cloud.nacos.config.prefix</code>、<code>spring.cloud.nacos.config.file-extension</code>和<code>spring.cloud.nacos.config.group</code>拼接出来的地址去加载配置文件；<br>（2）通过使用<code>spring.cloud.nacos.config.extension-configs[n]</code>的<code>data-id</code>、<code>group</code>和<code>refresh</code>参数定义的加载多配置文件；<br>（3）通过使用<code>spring.cloud.nacos.config.shared-configs[n]</code>的<code>data-id</code>、<code>group</code>和<code>refresh</code>参数定义的共享多配置文件。</p>
<p>我们可以基于上述例子来进行验证，在config-client客户端的<code>bootstrap.properties</code>启动文件中分别使用三种配置加载方式来指定各自要获取的环境，可以通过如下参数来实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 加载配置优先级</span><br><span class="line">spring.cloud.nacos.config.prefix=config-client</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=database.properties</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].data-id=log.properties</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.shared-configs[0].refresh=true</span><br></pre></td></tr></tbody></table></figure></div>
<p>然后启动项目并查看config-client项目控制台的输出情况，如下所示：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-8ef53a09bd939adb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://upload-images.jianshu.io/upload_images/8964398-8ef53a09bd939adb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload mediumZoom" title></a></p>
<p>由于后面加载的配置会覆盖之前加载的配置，因此我们就可以得出三者的优先级为：拼接配置 > 加载多配置<code>extension-configs</code>  > 共享配置<code>shared-configs</code>。</p>
<p>这样关于Nacos实现配置中心的学习差不多就结束了，虽然对于Nacos系统参数这一部分还没结束，但是开发者完全可以自行点击 <a href="https://nacos.io/zh-cn/docs/system-configurations.html" target="_blank" rel="noopener">这里</a>来进行有选择行的学习。</p>
<p>参考文章：<strong><a href="http://blog.didispace.com/spring-cloud-alibaba-nacos-config-2/" target="_blank" rel="noopener">Nacos配置的多环境管理</a></strong>、 <strong><a href="https://nacos.io/zh-cn/docs/what-is-nacos.html" target="_blank" rel="noopener">Nacos官方文档</a></strong></p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">余思</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://envyzhan.top/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/">http://envyzhan.top/2020/03/04/spring-cloud-alibaba-nacos-2-implement-configuration-center/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://envyzhan.top">余思博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springcloud-alibaba/">springcloud-alibaba    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/06/spring-cloud-alibaba-nacos-3-openapi-store-cluser/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Open API、存储和集群部署</span></div></a></div><div class="next-post pull_right"><a href="/2020/03/02/spring-cloud-alibaba-nacos-1-implement-service-registration-and-discovery/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>实现服务注册与发现</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/03/10/spring-cloud-alibaba-sentinel-2-rule-persistence-storage/" title="规则持久化存储"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">规则持久化存储</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/08/spring-cloud-alibaba-sentinel-1-implement-of-interface-current-limiting/" title="实现接口限流"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">实现接口限流</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/06/spring-cloud-alibaba-nacos-3-openapi-store-cluser/" title="Open API、存储和集群部署"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">Open API、存储和集群部署</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/02/spring-cloud-alibaba-nacos-1-implement-service-registration-and-discovery/" title="实现服务注册与发现"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">实现服务注册与发现</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/01/spring-cloud-alibaba-introdution/" title="Spring Cloud Alibaba介绍"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">Spring Cloud Alibaba介绍</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '9996b44b488f2fc52124',
  clientSecret: '6bec0f8e9c032eeae6211a5d4cffa3c97e2d4a64',
  repo: 'blogcomment',
  owner: 'Envythink',
  admin: 'Envythink',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">Copyright &copy;2017-2021 余思博客, 版权所有</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script src="/js/tw_cn.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>