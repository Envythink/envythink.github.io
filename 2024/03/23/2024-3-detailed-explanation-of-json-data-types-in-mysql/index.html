<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>详解MySQL中的JSON数据类型 | 余思博客</title><meta name="keywords" content="mysql"><meta name="author" content="余思"><meta name="copyright" content="余思"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="写在前面本篇来学习MySQL中的JSON数据类型，这在某些场景下比text类型好用很多。 JSONJSON 是 JavaScript Object Notation（JavaScript 对象表示法）的缩写，是一个轻量级的，基于文本的，跨语言的数据交换格式，易于阅读和编写。 JSON基本数据类型JSON 的基本数据类型如下：（1）数值：十进制数，前面不能有0，可以为负数或小数，也可以为 e 或 E">
<meta property="og:type" content="article">
<meta property="og:title" content="详解MySQL中的JSON数据类型">
<meta property="og:url" content="http://envyzhan.asia/2024/03/23/2024-3-detailed-explanation-of-json-data-types-in-mysql/index.html">
<meta property="og:site_name" content="余思博客">
<meta property="og:description" content="写在前面本篇来学习MySQL中的JSON数据类型，这在某些场景下比text类型好用很多。 JSONJSON 是 JavaScript Object Notation（JavaScript 对象表示法）的缩写，是一个轻量级的，基于文本的，跨语言的数据交换格式，易于阅读和编写。 JSON基本数据类型JSON 的基本数据类型如下：（1）数值：十进制数，前面不能有0，可以为负数或小数，也可以为 e 或 E">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png">
<meta property="article:published_time" content="2024-03-23T10:55:30.000Z">
<meta property="article:modified_time" content="2024-05-22T14:17:58.831Z">
<meta property="article:author" content="余思">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://envyzhan.asia/2024/03/23/2024-3-detailed-explanation-of-json-data-types-in-mysql/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '详解MySQL中的JSON数据类型',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-22 22:17:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="余思博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">263</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 前端</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page child" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page child" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li><li><a class="site-page child" href="/categories/flutter/"><i class="fa-fw fa fa-bullseye"></i><span> Flutter</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page child" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page child" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page child" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page child" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 运维</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page child" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/other/"><i class="fa-fw fa fa-location-arrow"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bell"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 算法结构</span></a></li><li><a class="site-page child" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-address-book"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">余思博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 前端</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page child" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page child" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li><li><a class="site-page child" href="/categories/flutter/"><i class="fa-fw fa fa-bullseye"></i><span> Flutter</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page child" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page child" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page child" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page child" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 运维</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page child" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/other/"><i class="fa-fw fa fa-location-arrow"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bell"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 算法结构</span></a></li><li><a class="site-page child" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-address-book"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">详解MySQL中的JSON数据类型</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-23T10:55:30.000Z" title="发表于 2024-03-23 18:55:30">2024-03-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-22T14:17:58.831Z" title="更新于 2024-05-22 22:17:58">2024-05-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>本篇来学习MySQL中的JSON数据类型，这在某些场景下比text类型好用很多。</p>
<h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><p>JSON 是 JavaScript Object Notation（JavaScript 对象表示法）的缩写，是一个轻量级的，基于文本的，跨语言的数据交换格式，易于阅读和编写。</p>
<h1 id="JSON基本数据类型"><a href="#JSON基本数据类型" class="headerlink" title="JSON基本数据类型"></a>JSON基本数据类型</h1><p>JSON 的基本数据类型如下：<br>（1）数值：十进制数，前面不能有0，可以为负数或小数，也可以为 e 或 E 表示的指数。<br>（2）字符串：字符串必须用双引号括起来。<br>（3）布尔值：true，false。<br>（4）数组：一个由零或多个值组成的有序序列。每个值可以为任意类型。数组使用方括号[] 括起来，元素之间用逗号,分隔。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, &quot;abc&quot;, null, false, &quot;10:29:06.000000&quot;, &#123;&quot;id&quot;: 2&#125;]</span><br></pre></td></tr></table></figure>
<p>（5）对象：一个由零或者多个键值对组成的无序集合。其中键必须是字符串，值可以为任意类型。对象使用花括号{}括起来，键值对之间使用逗号,分隔，键与值之间用冒号:分隔。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;db&quot;: [&quot;mysql&quot;, &quot;oracle&quot;], &quot;id&quot;: 666, &quot;info&quot;: &#123;&quot;age&quot;: 26&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>（6）空值：null。</p>
<h1 id="创建操作"><a href="#创建操作" class="headerlink" title="创建操作"></a>创建操作</h1><p>这里创建一个名为tb_json的表，对应的SQL如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json(t1 json);</span><br></pre></td></tr></table></figure>
<h3 id="直接插入JSON数组"><a href="#直接插入JSON数组" class="headerlink" title="直接插入JSON数组"></a>直接插入JSON数组</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_json values(&#x27;[1, &quot;test&quot;, null, false, &quot;09:10:11.000000&quot;]&#x27;);</span><br></pre></td></tr></table></figure>
<h3 id="直接插入JSON对象"><a href="#直接插入JSON对象" class="headerlink" title="直接插入JSON对象"></a>直接插入JSON对象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_json values(&#x27;&#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;zhangsan&quot;, &quot;age&quot;: 20&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<h3 id="使用-JSON-ARRAY-构造JSON数组"><a href="#使用-JSON-ARRAY-构造JSON数组" class="headerlink" title="使用 JSON_ARRAY 构造JSON数组"></a>使用 JSON_ARRAY 构造JSON数组</h3><p>JSON_ARRAY(val1,val2,val3…)，用于构造JSON数组。该方法可接受0个或者多个值的列表，并返回一个包含这些值的 JSON 数组，开发者可利用该函数实现将List数组存储到数据库中。<br>执行结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692323865019-d5f7f950-36d1-4a4a-9879-43de8b0a73fe.png#averageHue=%231b1b1b&clientId=u35032c6b-3321-4&from=paste&height=143&id=uc7885295&originHeight=214&originWidth=971&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20331&status=done&style=none&taskId=uf77f11f7-6fd3-422b-9706-cbd542abdc3&title=&width=647.3333333333334" alt="image.png"></p>
<h3 id="使用-JSON-OBJECT-构造JSON对象"><a href="#使用-JSON-OBJECT-构造JSON对象" class="headerlink" title="使用 JSON_OBJECT 构造JSON对象"></a>使用 JSON_OBJECT 构造JSON对象</h3><p>JSON_OBJECT(key1,val1,key2,val2…)，用于构造JSON对象。该方法可接受0个或者多个键值对列表，并返回一个包含这些对的 JSON 对象，利用该方法开发者可以很容易的创建一个json对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_object(&#x27;id&#x27;, 2, &#x27;name&#x27;, &#x27;zhangsan&#x27;, &#x27;age&#x27;, 20);</span><br></pre></td></tr></table></figure>
<p>执行结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692323945023-ebbe05f4-c185-4ba2-87a9-a0c6b5281fa4.png#averageHue=%231b1b1b&clientId=u35032c6b-3321-4&from=paste&height=139&id=uc29a17c9&originHeight=208&originWidth=931&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19228&status=done&style=none&taskId=u66f32ec4-b814-4c78-a38a-0933d423930&title=&width=620.6666666666666" alt="image.png"></p>
<h3 id="使用-JSON-QUOTE-将JSON转为字符串"><a href="#使用-JSON-QUOTE-将JSON转为字符串" class="headerlink" title="使用 JSON_QUOTE 将JSON转为字符串"></a>使用 JSON_QUOTE 将JSON转为字符串</h3><p>JSON_QUOTE(json_val)，用于将JSON转为字符串。通常用于生成有效的 JSON 字符串文字以包含在 JSON 文档中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_quote(&#x27;[123456]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692324112765-535db8bd-9255-49f7-b01b-f7074b845084.png#averageHue=%231b1b1b&clientId=u35032c6b-3321-4&from=paste&height=136&id=u1316e3ef&originHeight=204&originWidth=535&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13485&status=done&style=none&taskId=ue8a1af62-5b68-4596-b55c-85d30465da2&title=&width=356.6666666666667" alt="image.png"></p>
<h3 id="JSON对象注意点"><a href="#JSON对象注意点" class="headerlink" title="JSON对象注意点"></a>JSON对象注意点</h3><p>对于 JSON 对象来说，KEY 名不能重复，具体的需要结合 MySQL 版本来进行说明。<br>（1）如果插入的值中存在重复 KEY，在 MySQL 8.0.3 之前，遵循 first duplicate key wins 原则，会保留第一个 KEY，后面的将被丢弃掉。<br>（2）而从 MySQL 8.0.3 开始，遵循的是 last duplicate key wins 原则，只会保留最后一个 KEY。</p>
<p>【MySQL 5.7.32】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select json_object(&#x27;key1&#x27;,10,&#x27;key2&#x27;,20,&#x27;key1&#x27;,30);</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| json_object(&#x27;key1&#x27;,10,&#x27;key2&#x27;,20,&#x27;key1&#x27;,30) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| &#123;&quot;key1&quot;: 10, &quot;key2&quot;: 20&#125;                   |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>【MySQL 8.0.27】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select json_object(&#x27;key1&#x27;,10,&#x27;key2&#x27;,20,&#x27;key1&#x27;,30);</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| json_object(&#x27;key1&#x27;,10,&#x27;key2&#x27;,20,&#x27;key1&#x27;,30) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| &#123;&quot;key1&quot;: 30, &quot;key2&quot;: 20&#125;                   |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h1 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h1><h3 id="JSON-CONTAINS"><a href="#JSON-CONTAINS" class="headerlink" title="JSON_CONTAINS"></a><strong>JSON_CONTAINS</strong></h3><p>JSON_CONTAINS(json_doc, val[, path])，用于查询JSON格式数据中是否包含指定对象，如果包含则返回1，否则返回0。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692324751008-59d14e7f-1dc9-4cf5-88f0-0203c3c30142.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=298&id=u619d238a&originHeight=447&originWidth=812&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=31042&status=done&style=none&taskId=u732492bb-16ac-4750-b3ee-ab31eccfc8c&title=&width=541.3333333333334" alt="image.png"></p>
<h3 id="JSON-CONTAINS-PATH"><a href="#JSON-CONTAINS-PATH" class="headerlink" title="JSON_CONTAINS_PATH"></a><strong>JSON_CONTAINS_PATH</strong></h3><p>JSON_CONTAINS_PATH(json_doc, one_or_all, path[, path] …)，用于查询JSON格式数据中是否存在指定类型的key，如果包含则返回1，否则返回0。</p>
<p>如果有参数为NULL，那么返回NULL。请注意one_or_all的值只能为”one”或”all”，one表示只要有一个存在即可，all表示所有的都存在才行。</p>
<p>使用如下命令来创建一个测试表并插入一条记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json2(t2 json);</span><br><span class="line">insert into tb_json2 values(&#x27;&#123;&quot;empno&quot;: 1001, &quot;ename&quot;: &quot;jack&quot;&#125;&#x27;), (&#x27;&#123;&quot;empno&quot;: 1002, &quot;ename&quot;: &quot;mark&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>接着我们尝试使用 JSON_CONTAINS_PATH 来查询t2中是否包含 ename 这个key：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_contains_path(t2,&#x27;one&#x27;,&#x27;$.ename&#x27;) from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692328836836-4d124f59-66cc-4e1f-83d5-644231021b67.png#averageHue=%23161616&clientId=u35032c6b-3321-4&from=paste&height=163&id=ucde6db02&originHeight=244&originWidth=954&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18508&status=done&style=none&taskId=u928297c5-b4ba-49a5-b93b-dccd83ac56e&title=&width=636" alt="image.png"></p>
<h3 id="JSON-EXTRACT"><a href="#JSON-EXTRACT" class="headerlink" title="JSON_EXTRACT"></a><strong>JSON_EXTRACT</strong></h3><p>JSON_EXTRACT(json_doc, path[, path] …)，用于从JSON中抽取指定数据。其中，json_doc 是 JSON 文档，path 是路径。该函数会从 JSON 文档提取指定路径（path）的元素。如果指定 path 不存在，会返回 NULL。注意，可指定多个 path，那么匹配到的多个值会以数组形式返回。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(t2,&#x27;$.ename&#x27;) from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692335483883-266ba718-d5f1-449c-880c-e657a7390271.png#averageHue=%23161616&clientId=u35032c6b-3321-4&from=paste&height=163&id=u5d4861cf&originHeight=244&originWidth=779&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17082&status=done&style=none&taskId=u30678b04-0466-4dac-b1d0-256db851153&title=&width=519.3333333333334" alt="image.png"></p>
<h5 id="JSON-EXTRACT在数组中的使用"><a href="#JSON-EXTRACT在数组中的使用" class="headerlink" title="JSON_EXTRACT在数组中的使用"></a>JSON_EXTRACT在数组中的使用</h5><p>我们知道数组的路径是通过下标来表示的，而且第一个元素的下标是 0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;[10, 20, [30, 40, 50]]&#x27;, &#x27;$[0]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692336159121-97956765-5ee3-4f46-8d6b-a33f80ee6c57.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=145&id=u79c6d2c7&originHeight=217&originWidth=873&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17385&status=done&style=none&taskId=ubb7dd4dc-9a2f-4d11-b4f9-2c2b41c335b&title=&width=582" alt="image.png"><br>再来看个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;[10, 20, [30, 40, 50]]&#x27;, &#x27;$[0]&#x27;,&#x27;$[1]&#x27;,&#x27;$[2][2]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692336245648-ff3ac220-a33d-4741-81df-675f0c9a0702.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=139&id=ue8cf8993&originHeight=209&originWidth=1105&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20751&status=done&style=none&taskId=u89932fad-0271-47ea-9cbe-15cd5223abf&title=&width=736.6666666666666" alt="image.png"><br>当然，我么还可以使用 [M to N] 来获取数组的子集：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;[10, 20, [30, 40, 50]]&#x27;, &#x27;$[0 to 1]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692336338518-c85f36ce-c7be-4ef7-bcab-4cbb88615fb5.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=145&id=u1b1ae785&originHeight=217&originWidth=939&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18789&status=done&style=none&taskId=u430ea725-9423-462f-ac36-2eca7a23b04&title=&width=626" alt="image.png"><br>也可以使用last来代表最后一个元素的下标，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;[10, 20, [30, 40, 50]]&#x27;, &#x27;$[last-1 to last]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692336438352-8dfe5df4-a373-48c6-88a6-47aa02ddb166.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=142&id=u2a40a4cb&originHeight=213&originWidth=1048&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20758&status=done&style=none&taskId=ue930ae36-b5ad-4732-add4-d2afca58a4d&title=&width=698.6666666666666" alt="image.png"><br>也可通过 [*] 来获取数组中的所有元素，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;[10, 20, [30, 40, 50]]&#x27;, &#x27;$[*]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692336508314-bbad0f73-17b5-4ead-872d-8a1df1925ff1.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=138&id=ub2e34c6e&originHeight=207&originWidth=870&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18366&status=done&style=none&taskId=u8dbaf399-be64-4316-8dc8-b04f9026b06&title=&width=580" alt="image.png"></p>
<h5 id="JSON-EXTRACT在对象中的使用"><a href="#JSON-EXTRACT在对象中的使用" class="headerlink" title="JSON_EXTRACT在对象中的使用"></a>JSON_EXTRACT在对象中的使用</h5><p>我们知道对象的路径是通过 KEY 来表示的。首先往数据表中定义一个变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @j=&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: [2, 3], &quot;a c&quot;: 4&#125;&#x27;;</span><br></pre></td></tr></table></figure>
<p>之后我们尝试从中获取key为a的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(@j, &#x27;$.a&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692337859006-9525f7d2-6430-473a-9e97-c30c19668265.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=145&id=u774ec65e&originHeight=218&originWidth=544&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12281&status=done&style=none&taskId=u934f6a6f-b9d0-4d5b-addb-66a848662ba&title=&width=362.6666666666667" alt="image.png"><br>再来获取key为b，且数组下标为1的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(@j, &#x27;$.b[1]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692337920555-f1011e67-eccd-44e1-bb48-5830f590bd86.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=143&id=u1437f46e&originHeight=215&originWidth=586&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13456&status=done&style=none&taskId=u0f7de5ae-5bdf-41fe-9b15-42054956a27&title=&width=390.6666666666667" alt="image.png"><br>请注意，如果 KEY 在路径表达式中不合法（如存在空格），那么在引用这个 KEY 时，需用双引号括起来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(@j, &#x27;$.&quot;a c&quot;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692337980197-7b761f25-cf46-4163-a751-bba4224964a2.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=141&id=ue5f56c5b&originHeight=212&originWidth=603&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12972&status=done&style=none&taskId=u811d815d-996d-4866-9d0e-74308b1f4e5&title=&width=402" alt="image.png"><br>此外，开发者还可以通过 .*  来获取对象中的所有元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: [2, 3], &quot;a c&quot;: 4&#125;&#x27;, &#x27;$.*&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692338068263-9462510c-4dc7-419a-8fd9-a9f6049fce2d.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=138&id=u45698e38&originHeight=207&originWidth=981&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18850&status=done&style=none&taskId=u9deda8f5-500c-489b-9f2a-9ff1148387a&title=&width=654" alt="image.png"><br>再来看一个通配符的情况，可以看到这里的 $**.b 会匹配 $.a.b 和 $.c.b 这两种情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_extract(&#x27;&#123;&quot;a&quot;: &#123;&quot;b&quot;: 1&#125;, &quot;c&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;, &#x27;$**.b&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692338196223-306ca6cf-215a-433c-b515-bb7a3d8571ae.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=139&id=ud287d3a1&originHeight=209&originWidth=986&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18072&status=done&style=none&taskId=u1ae788a8-6843-4d6b-8da0-35caac860c5&title=&width=657.3333333333334" alt="image.png"></p>
<h3 id="column-gt-path"><a href="#column-gt-path" class="headerlink" title="column-&gt;path"></a><strong>column-&gt;path</strong></h3><p>column-&gt;path 以及后面提到的 column-&gt;&gt;path，它们都是语法糖，在实际使用的时候都会转化为 JSON_EXTRACT。</p>
<p>column-&gt;path 等同于 JSON_EXTRACT(column, path) ，注意里面只能指定一个path。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json2(t2 json);</span><br><span class="line">insert into tb_json2 values(&#x27;&#123;&quot;empno&quot;: 1001, &quot;ename&quot;: &quot;jack&quot;&#125;&#x27;), (&#x27;&#123;&quot;empno&quot;: 1002, &quot;ename&quot;: &quot;mark&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>查看一下t2以及其中ename的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t2 ,t2 -&gt; &#x27;$.ename&#x27; from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692338461799-f5f7e715-f449-41f9-a3a8-c9eccd9fad4b.png#averageHue=%231b1b1b&clientId=u35032c6b-3321-4&from=paste&height=161&id=ub813f5c9&originHeight=241&originWidth=780&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19917&status=done&style=none&taskId=uc3e58f9f-6cd8-41a7-9bfd-6a557e7b2f5&title=&width=520" alt="image.png"><br>查看一下empno为1001的用户的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_json2 where t2 -&gt; &#x27;$.empno&#x27; = 1001;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692338620358-aa7093c9-bd6b-45ee-8e35-8afb2bfc967f.png#averageHue=%23171717&clientId=u35032c6b-3321-4&from=paste&height=140&id=ue7c5d3b1&originHeight=210&originWidth=840&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15629&status=done&style=none&taskId=ufba36d5e-ee32-48fc-a112-6603aaf672f&title=&width=560" alt="image.png"></p>
<h3 id="column-gt-gt-path"><a href="#column-gt-gt-path" class="headerlink" title="column-&gt;&gt;path"></a><strong>column-&gt;&gt;path</strong></h3><p>和 column-&gt;path 类似，只不过它返回的是字符串，请注意，下面三者是等价的：</p>
<ul>
<li><p>JSON_UNQUOTE( JSON_EXTRACT(column, path) )</p>
</li>
<li><p>JSON_UNQUOTE(column -&gt; path)</p>
</li>
<li><p>column-&gt;&gt;path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t2-&gt;&#x27;$.ename&#x27;,json_extract(t2, &quot;$.ename&quot;),json_unquote(t2-&gt;&#x27;$.ename&#x27;),t2-&gt;&gt;&#x27;$.ename&#x27; from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692338778806-d962b960-eb1d-4f5f-854c-8669a8bc54e0.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=160&id=u4c428175&originHeight=240&originWidth=1593&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=29171&status=done&style=none&taskId=uf2a40b73-9949-4f36-9580-31e6e4a888d&title=&width=1062" alt="image.png"></p>
<h3 id="JSON-SEARCH"><a href="#JSON-SEARCH" class="headerlink" title="JSON_SEARCH"></a><strong>JSON_SEARCH</strong></h3><p>JSON_SEARCH(json_doc, one_or_all, search_str[, escape_char[, path] …])，该方法用于返回某个字符串（search_str）在 JSON 文档中的位置。其中：</p>
</li>
<li><p>one_or_all：匹配的次数，one 是只匹配一次，all 是匹配所有。如果匹配到多个，结果会以数组的形式返回。</p>
</li>
<li><p>search_str：子串，支持模糊匹配：% 和 _ 。</p>
</li>
<li><p>escape_char：转义符，如果该参数不填或为 NULL，则取默认转义符 \ 。</p>
</li>
<li><p>path：查找路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_search(&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;1&quot;&#125;, &quot;job&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;, &#x27;one&#x27;, &#x27;abc&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692341861120-d716b263-cb2b-4515-8e41-e31721a9bc49.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=145&id=ud46d07b1&originHeight=217&originWidth=1392&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23747&status=done&style=none&taskId=u2255355c-2d5f-4eb3-aa0f-f1408b100c4&title=&width=928" alt="image.png"><br>再来将one修改为all试试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_search(&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;1&quot;&#125;, &quot;job&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;, &#x27;all&#x27;, &#x27;abc&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692341911889-e7dc5f0c-15bb-461d-94f0-d9ecb28cc535.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=137&id=u87572faf&originHeight=206&originWidth=1374&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24124&status=done&style=none&taskId=u3464de8a-ebcb-4a68-a581-5157f7a1990&title=&width=916" alt="image.png"><br>再来尝试寻找一个不存在的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_search(&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;1&quot;&#125;, &quot;job&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;, &#x27;all&#x27;, &#x27;ddd&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692341970434-83060a2a-6905-47ce-af86-96958ffbf5f5.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=137&id=u53518f7b&originHeight=205&originWidth=1393&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23127&status=done&style=none&taskId=u95d6906e-6c7f-49be-87d1-c123ef8dc08&title=&width=928.6666666666666" alt="image.png"><br>再来看一个例子，这里我们设置转义符为NULL，查找路径path指定为$[1]，此时代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_search(&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;1&quot;&#125;, &quot;job&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;, &#x27;all&#x27;, &#x27;%b%&#x27;, NULL, &#x27;$[1]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692342393098-3c0cdff1-55bd-4b3b-a751-313d540ee4f2.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=138&id=u2022898b&originHeight=207&originWidth=1580&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27519&status=done&style=none&taskId=u83f164a3-6f9f-4ab2-b483-b11f53eea69&title=&width=1053.3333333333333" alt="image.png"><br>再来看个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_search(&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;1&quot;&#125;, &quot;job&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;, &#x27;all&#x27;, &#x27;%b%&#x27;, NULL, &#x27;$[3]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692342525743-3296886e-cb83-4539-9b75-ccbded7e5f0d.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=147&id=ue7824b1d&originHeight=220&originWidth=1580&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=28290&status=done&style=none&taskId=ua7d08ff6-56d4-4b48-aef7-d549eba5f1b&title=&width=1053.3333333333333" alt="image.png"></p>
<h3 id="JSON-KEYS"><a href="#JSON-KEYS" class="headerlink" title="JSON_KEYS"></a><strong>JSON_KEYS</strong></h3><p>JSON_KEYS(json_doc[, path])，用于返回 JSON 文档最外层的 key，如果指定了 path，那么返回该 path 对应元素最外层的 key。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_keys(&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 6&#125;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692342653491-9ab83fff-8f45-4944-bcbe-cb7b58a5b24d.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=143&id=ubc107274&originHeight=214&originWidth=730&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=14997&status=done&style=none&taskId=u408aefbe-cefb-4ab9-894f-8d554189414&title=&width=486.6666666666667" alt="image.png"><br>再来看一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_keys(&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 6&#125;&#125;&#x27;, &#x27;$.b&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692342719716-7b89e4e2-3ddd-449c-9dc3-22a82880da55.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=141&id=u146bd41d&originHeight=212&originWidth=822&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16105&status=done&style=none&taskId=u93190263-d3ea-40a1-a300-f5e76967cb8&title=&width=548" alt="image.png"></p>
<h3 id="JSON-VALUE"><a href="#JSON-VALUE" class="headerlink" title="JSON_VALUE"></a><strong>JSON_VALUE</strong></h3><p>JSON_VALUE(json_doc, path)，它是MySQL 8.0.21 版本引入的，用于从 JSON 文档提取指定路径（path）的元素。该函数的完整语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JSON_VALUE(json_doc, path [RETURNING type] [on_empty] [on_error])</span><br><span class="line"></span><br><span class="line">on_empty:</span><br><span class="line">    &#123;NULL | ERROR | DEFAULT value&#125; ON EMPTY</span><br><span class="line"></span><br><span class="line">on_error:</span><br><span class="line">    &#123;NULL | ERROR | DEFAULT value&#125; ON ERROR</span><br></pre></td></tr></table></figure>
<p>上述命令中各参数的含义如下：</p>
</li>
<li><p>RETURNING type：返回值的类型，不指定，则默认是 VARCHAR(512)。不指定字符集，则默认是 utf8mb4，且区分大小写。</p>
</li>
<li><p>on_empty：如果指定路径没有值，会触发 on_empty 子句， 默认是返回 NULL，也可指定 ERROR 抛出错误，或者通过 DEFAULT value 返回默认值。</p>
</li>
<li><p>on_error：三种情况下会触发 on_error 子句：从数组或对象中提取元素时，会解析到多个值；类型转换错误，比如将 “abc” 转换为 unsigned 类型；值被 truncate 了。默认是返回 NULL。</p>
</li>
</ul>
<p>看一个简单的案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_value(&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;age&quot;: &quot;26&quot;&#125;&#x27;, &#x27;$.name&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692342932116-e1e94e9b-79dd-4d2b-8508-5bba057532b9.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=139&id=u5e6d6dd6&originHeight=208&originWidth=1020&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19010&status=done&style=none&taskId=ue0d11c29-862f-4b70-9b35-5a4d7e1857b&title=&width=680" alt="image.png"><br>再来看一个指定RETURNING type的案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_value(&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;weight&quot;: &quot;132.82&quot;&#125;&#x27;, &#x27;$.weight&#x27; returning decimal(5,2)) as weight;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343141729-9bc7ba22-e87c-4274-bcad-87a6cac11125.png#averageHue=%23121212&clientId=u35032c6b-3321-4&from=paste&height=142&id=u16894e28&originHeight=213&originWidth=1610&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21501&status=done&style=none&taskId=ue6552d18-130c-4e91-bf70-9b3b1356c1e&title=&width=1073.3333333333333" alt="image.png"><br>再看一个指定on_empty的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_value(&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;weight&quot;: &quot;132.82&quot;&#125;&#x27;, &#x27;$.weight1&#x27; error on empty);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343271714-6ec28591-b059-49d2-b0a1-c0d6339abb7f.png#averageHue=%23252525&clientId=u35032c6b-3321-4&from=paste&height=40&id=ueff83c5d&originHeight=60&originWidth=1375&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15339&status=done&style=none&taskId=u11f5e095-a924-433c-a7d8-4db39802a01&title=&width=916.6666666666666" alt="image.png"><br>再看一个指定on_error的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_value(&#x27;[1, 2, 3, 4]&#x27;, &#x27;$[1 to 2]&#x27; error on error);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343361168-b9e05a72-b9b1-427a-96be-7accd256e46b.png#averageHue=%23222222&clientId=u35032c6b-3321-4&from=paste&height=43&id=u2f0227d3&originHeight=65&originWidth=1244&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13959&status=done&style=none&taskId=u02e84174-e4a0-4504-afc8-8cb0de77247&title=&width=829.3333333333334" alt="image.png"><br>再来看一个指定on_error的例子，是因为类型转换错误而导致的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_value(&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;weight&quot;: &quot;132.82&quot;&#125;&#x27;, &#x27;$.name&#x27; returning unsigned error on error) as weight;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343669694-1ad8d804-d809-444c-8c84-15f4262182c2.png#averageHue=%23212121&clientId=u35032c6b-3321-4&from=paste&height=42&id=u8fdbd69c&originHeight=63&originWidth=1737&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16681&status=done&style=none&taskId=u7fe53ace-5727-471a-b05a-93394623a05&title=&width=1158" alt="image.png"></p>
<h3 id="MEMBER-OF"><a href="#MEMBER-OF" class="headerlink" title="MEMBER OF"></a><strong>MEMBER OF</strong></h3><p>value MEMBER OF(json_array)，用于判断 value 是否是 JSON 数组的一个元素，如果是，则返回 1；否则返回0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 18 member of(&#x27;[23, &quot;ad&quot;, 18, &quot;abc&quot;, 16]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343800781-34296a34-bd93-40f5-bd27-6cf2b7786564.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=136&id=uf820cc5e&originHeight=204&originWidth=797&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15655&status=done&style=none&taskId=u3779c79b-92b6-4436-8236-1699ad9437f&title=&width=531.3333333333334" alt="image.png"><br>再来看一个vaue为JOSN数组时的情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select cast(&#x27;[1,2]&#x27; as json) member of(&#x27;[[1,2],[3,4]]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692343881895-3b094579-b587-45ab-917f-2fa16ae68fa2.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=136&id=ufb8790b6&originHeight=204&originWidth=892&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16893&status=done&style=none&taskId=ue9c282b4-f0c5-48f8-a486-17525c5a69c&title=&width=594.6666666666666" alt="image.png"></p>
<h3 id="JSON-OVERLAPS"><a href="#JSON-OVERLAPS" class="headerlink" title="JSON_OVERLAPS"></a><strong>JSON_OVERLAPS</strong></h3><p>JSON_OVERLAPS(json_doc1, json_doc2)，它是 MySQL 8.0.17版本 引入的，用于比较两个 JSON 文档是否有相同的键值对或数组元素，如果有，则返回 1，否则返回0。如果两个参数都是标量，那么判断这两个标量是否相等。<br>首先看一下两个JOSN数组是否有相同元素的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_overlaps(&#x27;[1,3,5,7,9]&#x27;, &#x27;[3,5,7]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692344368505-f4c3da2a-1efa-4aa8-8e31-b0e54fb6efbb.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=145&id=u63eac0f4&originHeight=217&originWidth=767&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15320&status=done&style=none&taskId=u59e43344-67e9-4cf2-802f-477a57c5f6f&title=&width=511.3333333333333" alt="image.png"><br>看一个两个JOSN数组中没有相同元素的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_overlaps(&#x27;[1,3,5,7,9]&#x27;, &#x27;[2,4,6]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692344424376-067ba9a5-01ff-4696-84f6-bdec4c25e6a5.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=137&id=u527f7731&originHeight=205&originWidth=770&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16100&status=done&style=none&taskId=udb995371-c541-4421-bd45-704784ca120&title=&width=513.3333333333334" alt="image.png"><br>再来看一个两个JOSN对象是否有相同元素的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_overlaps(&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;, &#x27;&#123;&quot;c&quot;:3,&quot;d&quot;:4,&quot;b&quot;:2&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692344554055-aaaefc2a-4ce9-4656-99a9-1f43bc945baf.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=138&id=u81d5d322&originHeight=207&originWidth=966&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17667&status=done&style=none&taskId=u6780bf9a-3e37-4709-9f80-90369473175&title=&width=644" alt="image.png"><br>再来一个比较简单的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_overlaps(&#x27;1&#x27;, &#x27;1&#x27;),json_overlaps(&#x27;1&#x27;, &#x27;2&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692345248986-faa90e61-16d1-4765-97c7-5fd3aec3bedf.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=138&id=u19436e90&originHeight=207&originWidth=878&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15372&status=done&style=none&taskId=u04a463bd-dfde-4082-9bbe-b991d1eb358&title=&width=585.3333333333334" alt="image.png"><br>自 MySQL 8.0.17版本开始，InnoDB 支持多值索引，可用在 JSON 数组中。当开发者使用 JSON_CONTAINS、MEMBER OF、JSON_OVERLAPS 进行数组相关的操作时，可使用多值索引来加快查询。</p>
<h1 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h1><h3 id="JSON-INSERT"><a href="#JSON-INSERT" class="headerlink" title="JSON_INSERT"></a><strong>JSON_INSERT</strong></h3><p>JSON_INSERT(json_doc, path, val[, path, val] …)，该方法用于插入新值，注意仅当指定位置或指定 KEY 的值不存在时，才执行插入操作。此外，如果指定的 path 是数组下标，且 json_doc 不是数组，那么该函数首先会将 json_doc 转化为数组，然后再插入新值。</p>
<p>下面通过几个案例来学习如何使用JSON_INSERT这个函数，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_insert(&#x27;1&#x27;,&#x27;$[0]&#x27;,&quot;6&quot;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339122210-55f80d8b-9e54-4d0b-8e12-1d79f00da72a.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=139&id=u99cad776&originHeight=208&originWidth=600&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13009&status=done&style=none&taskId=u94f90d9a-5be0-4efb-8304-79904ec6fad&title=&width=400" alt="image.png"><br>接着我们通过path指定数组下标为1，此时执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_insert(&#x27;1&#x27;,&#x27;$[1]&#x27;,&quot;6&quot;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339185145-9f6b08a0-597f-40cd-898e-ddb1b6f22aef.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=143&id=ue9314c1c&originHeight=215&originWidth=608&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13529&status=done&style=none&taskId=ueabaaaf9-791c-4965-8bad-9088559f2a9&title=&width=405.3333333333333" alt="image.png"><br>再来看一个数组的情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_insert(&#x27;[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]&#x27;,&#x27;$[3]&#x27;,&quot;8&quot;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339271760-2f0a20be-a20b-4157-88c1-bd61ee36620c.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=139&id=u91178613&originHeight=209&originWidth=770&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16341&status=done&style=none&taskId=u633bdb45-7c4e-4a26-a2e4-016cc6991c5&title=&width=513.3333333333334" alt="image.png"><br>再来看一下比较综合的案例，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_insert(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3]&#125;&#x27;, &#x27;$.a&#x27;, 6, &#x27;$.d&#x27;, &#x27;[true, false]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339388328-693d7407-0425-4a3a-9025-3e8ae3360060.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=142&id=u7cb77c1b&originHeight=213&originWidth=1215&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24629&status=done&style=none&taskId=u247c84fe-d8e0-497f-8beb-c9628744014&title=&width=810" alt="image.png"></p>
<h3 id="JSON-SET"><a href="#JSON-SET" class="headerlink" title="JSON_SET"></a><strong>JSON_SET</strong></h3><p>JSON_SET(json_doc, path, val[, path, val] …)，该方法用于插入新值，并替换已经存在的值。也就是说，如果指定位置或指定 KEY 的值不存在，那么将执行插入操作；如果存在，则执行更新操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_set(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3, 4]&#125;&#x27;, &#x27;$.a&#x27;, 8, &#x27;$.c&#x27;, &#x27;[true, false]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339568779-34be3fd8-e4ed-4d7c-b725-eabc180eb90f.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=145&id=u4c57a675&originHeight=218&originWidth=1212&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24840&status=done&style=none&taskId=u400a4f06-e0e4-404a-9d56-b076f100089&title=&width=808" alt="image.png"></p>
<h3 id="JSON-REPLACE"><a href="#JSON-REPLACE" class="headerlink" title="JSON_REPLACE"></a><strong>JSON_REPLACE</strong></h3><p>JSON_REPLACE(json_doc, path, val[, path, val] …)，该方法用于替换已经存在的值，如果该值不存在那么不会进行替换。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_replace(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3, 4]&#125;&#x27;, &#x27;$.a&#x27;, 6, &#x27;$.c&#x27;, &#x27;[true, false]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339733503-924ed095-bccf-4557-9ab7-df4e268b2d28.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=139&id=ud7187169&originHeight=209&originWidth=1275&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24113&status=done&style=none&taskId=ufef2c797-2f54-4cf1-bafb-090d6a9cacf&title=&width=850" alt="image.png"></p>
<h3 id="JSON-ARRAY-APPEND"><a href="#JSON-ARRAY-APPEND" class="headerlink" title="JSON_ARRAY_APPEND"></a><strong>JSON_ARRAY_APPEND</strong></h3><p>JSON_ARRAY_APPEND(json_doc, path, val[, path, val] …)，用于向数组的指定位置追加元素，请注意，如果指定的 path 不存在，那么将不会添加。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_append(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;]&#x27;, &#x27;$[0]&#x27;, 1);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692345664066-ac5a7a83-406a-44c1-a559-7f5637d884b1.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=142&id=u5a937e88&originHeight=213&originWidth=979&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19658&status=done&style=none&taskId=uab0421bb-3f3a-439e-a710-f111f85e77e&title=&width=652.6666666666666" alt="image.png"><br>再来看一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_append(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;]&#x27;, &#x27;$[1][0]&#x27;, 2);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692345710645-3568c0c7-19cf-465d-bcfb-473ea3bb41f5.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=140&id=u27f0a147&originHeight=210&originWidth=1011&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20280&status=done&style=none&taskId=u6d880c30-e69b-4cc4-9fda-3629d50301f&title=&width=674" alt="image.png"><br>现在我们尝试修改一个不存在的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_append(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;]&#x27;, &#x27;$[3]&#x27;, 3);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692345746637-12505391-8bb7-41c2-8993-4d6098d21d9d.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=137&id=ub88f6388&originHeight=206&originWidth=978&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18946&status=done&style=none&taskId=u64c21c13-ed75-4b12-905d-d7208b0470c&title=&width=652" alt="image.png"><br>前面提到的都是JSON数组，接下来我们看一下JSON对象，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_append(&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: [2, 3], &quot;c&quot;: 4&#125;&#x27;, &#x27;$.b&#x27;, &#x27;x&#x27;, &#x27;$&#x27;, &#x27;z&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692346023296-dd896e22-0100-427e-ab8f-3c767fd47fa5.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=138&id=u13ad2a4a&originHeight=207&originWidth=1234&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23876&status=done&style=none&taskId=u0ed68f36-0614-4206-bcf6-34600a16527&title=&width=822.6666666666666" alt="image.png"></p>
<h3 id="JSON-ARRAY-INSERT"><a href="#JSON-ARRAY-INSERT" class="headerlink" title="JSON_ARRAY_INSERT"></a><strong>JSON_ARRAY_INSERT</strong></h3><p>JSON_ARRAY_INSERT(json_doc, path, val[, path, val] …)，用于向数组的指定位置插入元素。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_insert(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;],&#123;&quot;d&quot;:&quot;e&quot;&#125;]&#x27;, &#x27;$[0]&#x27;, 1);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692346205592-a066b414-9425-4c56-93a2-0ebe9f59f641.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=139&id=u078d1649&originHeight=208&originWidth=1058&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21498&status=done&style=none&taskId=ubed87693-0a5e-44c3-8e49-22d2dcb6da6&title=&width=705.3333333333334" alt="image.png"><br>再来看一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_insert(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;],&#123;&quot;d&quot;:&quot;e&quot;&#125;]&#x27;, &#x27;$[1]&#x27;, cast(&#x27;[1,2,3]&#x27; as json));</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692346311046-86b0334a-0ccc-417b-a3b2-939294be46c3.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=139&id=u632adfca&originHeight=209&originWidth=1370&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=26359&status=done&style=none&taskId=u25b793a8-c0a1-482c-ab1c-06057d7a8ae&title=&width=913.3333333333334" alt="image.png"><br>接下来我们尝试往数组中不存在的索引位置处插入一个元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_array_insert(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;],&#123;&quot;d&quot;:&quot;e&quot;&#125;]&#x27;, &#x27;$[8]&#x27;, 2);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692346416270-1026a48d-0248-4e89-bd30-716523dd20e6.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=135&id=u14e9c78b&originHeight=203&originWidth=1042&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21352&status=done&style=none&taskId=u7c933517-d0e9-4a6b-91e3-a697237429b&title=&width=694.6666666666666" alt="image.png"><br>可以看到此时即使用户传入的下标超出了数组的索引，但是依旧能插入元素，只是在数组末尾进行了插入。</p>
<h3 id="JSON-MERGE-PATCH"><a href="#JSON-MERGE-PATCH" class="headerlink" title="JSON_MERGE_PATCH"></a><strong>JSON_MERGE_PATCH</strong></h3><p>JSON_MERGE_PATCH(json_doc, json_doc[, json_doc] …)，它是MySQL 8.0.3版本 引入的，用于合并多个 JSON 文档。合并规则如下：<br>（1）如果两个文档不全是 JSON 对象，那么合并后的结果是第二个文档。<br>（2）如果两个文档都是 JSON 对象，且不存在同名 KEY，那么合并后的文档包括两个文档的所有元素；如果存在同名 KEY，那么第二个文档的值会覆盖第一个。<br>首先看第一点，这里我们尝试合并两个JSON数组，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_patch(&#x27;[1, 2]&#x27;, &#x27;[3, 4]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692346915784-8081947d-9f96-44f3-a024-aac1b2fca1ee.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=145&id=ucd346278&originHeight=218&originWidth=721&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15479&status=done&style=none&taskId=ufd3bdab3-0bcf-417f-86de-b35fd358231&title=&width=480.6666666666667" alt="image.png"><br>接着我们尝试将一个JOSN数组和一个JSON对象进行合并：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_patch(&#x27;[1, 2]&#x27;, &#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347000216-9177fb63-ae94-4b23-9456-d898049713a0.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=141&id=u1c60e98f&originHeight=212&originWidth=924&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19436&status=done&style=none&taskId=u7ce1ab6c-55ce-4ff4-b608-2c2962f6a67&title=&width=616" alt="image.png"><br>然后我们尝试合并两个JSON对象，这两个JSON对象不存在同名的Key：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_patch(&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;, &#x27;&#123;&quot;b&quot;: 2&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347172411-a430c420-4f6a-4af6-bab0-d183adbf9025.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=144&id=ud130e65f&originHeight=216&originWidth=784&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=16907&status=done&style=none&taskId=u09b8fa88-3b67-4bbc-95fb-904d2cab7e6&title=&width=522.6666666666666" alt="image.png"><br>接着我们尝试合并两个JSON对象，注意这两个JSON对象存在同名的Key：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_patch(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;,&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347291515-bf8293d3-6fa6-4ec2-946e-68d02fc10df9.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=140&id=u962229bf&originHeight=210&originWidth=1019&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19831&status=done&style=none&taskId=u18d35517-21ed-4957-b83d-2c4103baf6c&title=&width=679.3333333333334" alt="image.png"><br>请注意，如果第二个文档中存在 null 值，那么文档合并后不会输出对应的 KEY，这一点需要引起注意：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_patch(&#x27;&#123;&quot;a&quot;:1, &quot;b&quot;:2&#125;&#x27;, &#x27;&#123;&quot;a&quot;:3, &quot;b&quot;:null&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347411910-197ae876-b9d8-4d33-9ab3-6e3ce60030ac.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=136&id=u6affd741&originHeight=204&originWidth=993&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18930&status=done&style=none&taskId=uc6ec4f57-ff87-4541-94aa-f7963cefe6e&title=&width=662" alt="image.png"></p>
<h3 id="JSON-MERGE-PRESERVE"><a href="#JSON-MERGE-PRESERVE" class="headerlink" title="JSON_MERGE_PRESERVE"></a><strong>JSON_MERGE_PRESERVE</strong></h3><p>JSON_MERGE_PRESERVE(json_doc, json_doc[, json_doc] …)，它是自MySQL 8.0.3版本 引入的，用于代替 JSON_MERGE。它也是用来合并文档，但合并规则与 JSON_MERGE_PATCH 有所不同，具体如下：<br>（1）两个文档中，只要有一个文档是数组，那么就会将另一个文档合并到该数组中；<br>（2）两个文档都是 JSON 对象，如果存在同名 KEY ，那么第二个文档并不会覆盖第一个，而是会将值 append 到第一个文档中。<br>先看第一点，如下所示的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_preserve(&#x27;1&#x27;,&#x27;2&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347913733-162e1c2b-f622-44bb-b289-1d86b05b85d7.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=137&id=u16b8f1bd&originHeight=206&originWidth=598&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12633&status=done&style=none&taskId=ue20702ff-23e6-4297-84b6-60ca46ead5b&title=&width=398.6666666666667" alt="image.png"><br>再来看个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_preserve(&#x27;[1, 2]&#x27;, &#x27;[3, 4]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692347981109-eb6e32c1-217e-4ae5-be76-348631bb5dd6.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=140&id=u4055182c&originHeight=210&originWidth=767&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15682&status=done&style=none&taskId=u32a06f02-60d5-45ee-8f00-be81d3adbc2&title=&width=511.3333333333333" alt="image.png"><br>再来看一个例子，这个例子看起来更清晰一点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_preserve(&#x27;[1, 2]&#x27;, &#x27;&#123;&quot;a&quot;: 1234&#125;&#x27;), json_merge_preserve(&#x27;&#123;&quot;a&quot;: 1234&#125;&#x27;, &#x27;[3,4]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692348086960-605750c4-30b2-4f13-8766-6ef3f2c35cc4.png#averageHue=%231a1a1a&clientId=u35032c6b-3321-4&from=paste&height=141&id=u5385a835&originHeight=212&originWidth=1466&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=26424&status=done&style=none&taskId=u37dd13b5-2f65-4bce-96c6-c072d25920f&title=&width=977.3333333333334" alt="image.png"><br>再来看一个比较复杂的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_merge_preserve(&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;, &#x27;&#123;&quot;b&quot;: 2&#125;&#x27;), json_merge_preserve(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;,&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692348180174-8c4d57d2-168c-4b06-880b-ee75aba068eb.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=139&id=ub0e52592&originHeight=208&originWidth=1690&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=28264&status=done&style=none&taskId=uebc5b683-cecf-4c16-94f9-0d40d6b1721&title=&width=1126.6666666666667" alt="image.png"></p>
<h3 id="JSON-MERGE"><a href="#JSON-MERGE" class="headerlink" title="JSON_MERGE"></a>JSON_MERGE</h3><p>JSON_MERGE(json_doc, json_doc[, json_doc] …)，与 JSON_MERGE_PRESERVE 作用一样，不过自 MySQL 8.0.3版本开始就不建议使用，后续会移除。</p>
<h1 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h1><h3 id="JSON-REMOVE"><a href="#JSON-REMOVE" class="headerlink" title="JSON_REMOVE"></a><strong>JSON_REMOVE</strong></h3><p>JSON_REMOVE(json_doc, path[, path] …)，该方法用于删除 JSON 文档中指定位置的元素。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_remove(&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3, 4]&#125;&#x27;, &#x27;$.a&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692339891455-9e6363ee-6f39-4e07-84c4-5dbf32dc2d1e.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=141&id=u7b55d02b&originHeight=212&originWidth=879&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18186&status=done&style=none&taskId=ufc22c531-d718-4d42-a319-e41dff9d945&title=&width=586" alt="image.png"><br>再来一个删除数组中指定位置元素的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_remove(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;, &quot;e&quot;]&#x27;, &#x27;$[1]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692340892323-9c8f16ee-5215-4d60-a05d-39382bdc91d9.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=144&id=ua9df5050&originHeight=216&originWidth=925&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17855&status=done&style=none&taskId=ub723ef8a-5c3c-4413-b340-6e17a53ad68&title=&width=616.6666666666666" alt="image.png"><br>再来看一个同时删除对象和数组中指定位置元素的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_remove(&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;, &quot;e&quot;]&#x27;, &#x27;$[1]&#x27;, &#x27;$[2]&#x27;);</span><br></pre></td></tr></table></figure>
<p>请注意，这里指定删除两个位置的元素，相对应的元素索引是在前面操作后结果的基础上，不是在原始JSON文档的索引基础上进行的操作，执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692341094925-8e223504-4cf3-41bc-87ec-53edc5930227.png#averageHue=%23181818&clientId=u35032c6b-3321-4&from=paste&height=143&id=u46442776&originHeight=214&originWidth=1043&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19062&status=done&style=none&taskId=u95170264-b078-475d-bda7-092e74dac8d&title=&width=695.3333333333334" alt="image.png"></p>
<h1 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h1><h3 id="JSON-QUOTE"><a href="#JSON-QUOTE" class="headerlink" title="JSON_QUOTE"></a><strong>JSON_QUOTE</strong></h3><p>JSON_QUOTE(string)，用于生成有效的 JSON 字符串，主要是对一些特殊字符（如双引号）进行转义。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_quote(&#x27;null&#x27;), json_quote(&#x27;&quot;null&quot;&#x27;), json_quote(&#x27;[1, 2, 3]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692348491206-41c5a161-c952-41ac-9543-149116ff719b.png#averageHue=%23191919&clientId=u35032c6b-3321-4&from=paste&height=147&id=ucdfe8513&originHeight=220&originWidth=1146&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20698&status=done&style=none&taskId=ud060081b-d772-4027-9e8e-020df6427a5&title=&width=764" alt="image.png"><br>当然了，还可以通过 CAST(value AS JSON) 来进行类型转换。</p>
<h3 id="JSON-UNQUOTE"><a href="#JSON-UNQUOTE" class="headerlink" title="JSON_UNQUOTE"></a><strong>JSON_UNQUOTE</strong></h3><p>JSON_UNQUOTE(json_val)，用于将 JSON 转义成字符串输出。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t2-&gt;&#x27;$.ename&#x27;,json_unquote(t2-&gt;&#x27;$.ename&#x27;),json_valid(t2-&gt;&#x27;$.ename&#x27;),json_valid(json_unquote(t2-&gt;&#x27;$.ename&#x27;)) from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692580154218-0c05e45a-e405-414e-b5dc-adf85c065372.png#averageHue=%23171717&clientId=u79b58c88-76cc-4&from=paste&height=179&id=u49e085e0&originHeight=268&originWidth=1917&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=34153&status=done&style=none&taskId=u9a5d7783-b124-483c-8da6-170a57df4c6&title=&width=1278" alt="image.png"><br>从执行结果中看，没使用 JSON_UNQUOTE 函数，那么字符串会用双引号引起来。而加了 JSON_UNQUOTE 函数，字符串就没有用双引号括起来。但本质上，前者是 JSON 中的 STRING 类型，后者是 MySQL 中的字符类型，这一点可通过 JSON_VALID 函数来进行判断。</p>
<h3 id="JSON-OBJECTAGG"><a href="#JSON-OBJECTAGG" class="headerlink" title="JSON_OBJECTAGG"></a><strong>JSON_OBJECTAGG</strong></h3><p>JSON_OBJECTAGG(key, value)方法，用于取表中的两列作为参数，其中第一列是 key，第二列是 value，并以JSON 对象进行返回。举个例子，如下所示的数据表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from tb_json2;</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">| t2                               | name | age  |</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">| &#123;&quot;empno&quot;: 1001, &quot;ename&quot;: &quot;jack&quot;&#125; | jack |   20 |</span><br><span class="line">| &#123;&quot;empno&quot;: 1002, &quot;ename&quot;: &quot;mark&quot;&#125; | mark |   19 |</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>之后我们尝试使用 json_objectagg() 方法，将name和age组成一个JOSN对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_objectagg(name, age) from tb_json2;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692580712946-dad69137-51f5-4750-af3a-1f48721b11ab.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=135&id=uab645cb8&originHeight=202&originWidth=758&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15891&status=done&style=none&taskId=u0488156a-6350-4f3d-bcfa-554115d7b0c&title=&width=505.3333333333333" alt="image.png"></p>
<h3 id="JSON-ARRAYAGG"><a href="#JSON-ARRAYAGG" class="headerlink" title="JSON_ARRAYAGG"></a><strong>JSON_ARRAYAGG</strong></h3><p>JSON_ARRAYAGG(col_or_expr)方法，用于将列的值聚合成 JSON 数组，请注意 JSON 数组中元素的顺序是随机的。</p>
<p>举个例子，如下所示的数据表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from tb_json2;</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">| t2                               | name | age  |</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">| &#123;&quot;empno&quot;: 1001, &quot;ename&quot;: &quot;jack&quot;&#125; | jack |   20 |</span><br><span class="line">| &#123;&quot;empno&quot;: 1002, &quot;ename&quot;: &quot;mark&quot;&#125; | mark |   19 |</span><br><span class="line">| &#123;&quot;empno&quot;: 1003, &quot;ename&quot;: &quot;book&quot;&#125; | book |   22 |</span><br><span class="line">| &#123;&quot;empno&quot;: 1004, &quot;ename&quot;: &quot;yook&quot;&#125; | yook |   25 |</span><br><span class="line">+----------------------------------+------+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>之后我们尝试使用 json_arrayagg() 方法，将 age 列的值聚合为一个JOSN数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name ,json_arrayagg(age) from tb_json2 group by name;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692581144794-0614391d-0c27-41ee-b353-2639be0236fb.png#averageHue=%23151515&clientId=u79b58c88-76cc-4&from=paste&height=196&id=u43f1cbe2&originHeight=294&originWidth=950&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23359&status=done&style=none&taskId=uc273fecd-8264-4127-9495-e1a975cfd10&title=&width=633.3333333333334" alt="image.png"></p>
<h3 id="JSON-PRETTY"><a href="#JSON-PRETTY" class="headerlink" title="JSON_PRETTY"></a><strong>JSON_PRETTY</strong></h3><p>JSON_PRETTY(json_val)方法，用于格式化 JSON 。首先看一个格式化JSON数组的例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_pretty(&#x27;[1,2,3,4,5]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692581319413-3e864613-ad61-4bf2-b207-6dfed6848002.png#averageHue=%23131313&clientId=u79b58c88-76cc-4&from=paste&height=258&id=u438e3226&originHeight=387&originWidth=590&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17421&status=done&style=none&taskId=ud6780927-47eb-4432-b831-4a9282de08d&title=&width=393.3333333333333" alt="image.png"><br>再来看一个格式化JSON对象的例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_pretty(&#x27;&#123;&quot;a&quot;: 1,&quot;b&quot;: 2,&quot;c&quot;:3&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692581447956-d48747ff-3c44-400e-a55d-4aebec4ea710.png#averageHue=%23141414&clientId=u79b58c88-76cc-4&from=paste&height=216&id=u38f102fb&originHeight=324&originWidth=728&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19288&status=done&style=none&taskId=u108cffc0-dc1e-4148-a601-b9811d8be31&title=&width=485.3333333333333" alt="image.png"></p>
<h3 id="JSON-STORAGE-FREE"><a href="#JSON-STORAGE-FREE" class="headerlink" title="JSON_STORAGE_FREE"></a><strong>JSON_STORAGE_FREE</strong></h3><p>JSON_STORAGE_FREE(json_val)，该方法是MySQL 8.0 新增的，与 Partial Updates 有关，用于计算 JSON 文档在进行部分更新后的剩余空间。</p>
<h3 id="JSON-STORAGE-SIZE"><a href="#JSON-STORAGE-SIZE" class="headerlink" title="JSON_STORAGE_SIZE"></a><strong>JSON_STORAGE_SIZE</strong></h3><p>JSON_STORAGE_SIZE(json_val)，该方法是MySQL 5.7.22 引入的，用于计算 JSON 文档的空间使用情况。</p>
<h3 id="JSON-DEPTH"><a href="#JSON-DEPTH" class="headerlink" title="JSON_DEPTH"></a><strong>JSON_DEPTH</strong></h3><p>JSON_DEPTH(json_doc)，该方法用于返回 JSON 文档的最大深度。请注意，对于空数组，空对象，标量值，其深度为 1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_depth(&#x27;&#123;&#125;&#x27;), json_depth(&#x27;[1,2,3]&#x27;), josn_depth(&#x27;[1,&#123;&quot;a&quot;: 2&#125;]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692581778951-609ae0fa-06f0-4d37-ad2f-d9534580475e.png#averageHue=%231a1a1a&clientId=u79b58c88-76cc-4&from=paste&height=137&id=u2dd097f6&originHeight=206&originWidth=1153&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20263&status=done&style=none&taskId=u960b7de1-3af1-4792-aea2-edd1a2e59ac&title=&width=768.6666666666666" alt="image.png"></p>
<h3 id="JSON-LENGTH"><a href="#JSON-LENGTH" class="headerlink" title="JSON_LENGTH"></a><strong>JSON_LENGTH</strong></h3><p>JSON_LENGTH(json_doc[, path])，该方法用于返回 JSON 文档的长度，计算规则如下：<br>（1）如果是标量值，其长度为 1；<br>（2）如果是数组，其长度为数组元素的个数；<br>（3）如果是对象，其长度为对象元素的个数；<br>（4）不包括嵌套数据和嵌套对象的长度。<br>接下来我们通过案例来演示上述计算规则的使用。首先是标量值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;&quot;abcd&quot;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692582089291-856a250e-8cf2-4f35-aa3d-8c8a27fbb0b7.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=139&id=ud0068afe&originHeight=208&originWidth=512&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11277&status=done&style=none&taskId=ub493d140-26c1-4a2f-b897-1b27d658102&title=&width=341.3333333333333" alt="image.png"><br>看一个纯数组的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;[1,2,3]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692582523263-931e5d62-b255-4c1c-9441-ea64ce2f95e1.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=142&id=u77670965&originHeight=213&originWidth=535&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=12025&status=done&style=none&taskId=u2d820909-c2e6-4ac1-b3e9-1b8152155b7&title=&width=356.6666666666667" alt="image.png"><br>看一个纯对象的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;, &quot;sex&quot;: &quot;female&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692582620978-a7359073-5592-4f8f-870a-1c0f12bff045.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=141&id=ua9c62b1b&originHeight=212&originWidth=951&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17321&status=done&style=none&taskId=u6fb56b42-42a7-40af-8fe8-ed3fa24d1b1&title=&width=634" alt="image.png"><br>来看一个数组和对象混用的例子，注意它不包括嵌套数据和嵌套对象的长度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;[1,2,3,&#123;&quot;name&quot;: &quot;wanger&quot;, &quot;sex&quot;: &quot;male&quot;&#125;]&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692582768400-9e6cf437-78a9-47d2-bee2-d0d983dedf8c.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=135&id=u1a127da5&originHeight=203&originWidth=994&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=18743&status=done&style=none&taskId=u25969ded-4f3f-492d-8b1f-79cab3ac7f3&title=&width=662.6666666666666" alt="image.png"><br>再看一个对象和对象混用的例子，注意它同样不包括嵌套数据和嵌套对象的长度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;hobby&quot;:&#123;&quot;language&quot;: &quot;english&quot;,&quot;boll&quot;:&quot;footboll&quot;&#125;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692582951088-fbf5ec4b-ef9a-4522-9cbc-64e6b482fc1e.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=144&id=ud744c117&originHeight=216&originWidth=1391&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24111&status=done&style=none&taskId=u762334fe-06e8-4935-8e0e-7aa8385af2e&title=&width=927.3333333333334" alt="image.png"><br>我们尝试输出hobby这个对象的长度，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_length(&#x27;&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;hobby&quot;:&#123;&quot;language&quot;: &quot;english&quot;,&quot;boll&quot;:&quot;footboll&quot;&#125;&#125;&#x27;,&#x27;$.hobby&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583139153-0023cd5f-8a9b-4743-82a9-d5b4098b389c.png#averageHue=%231a1a1a&clientId=u79b58c88-76cc-4&from=paste&height=137&id=u07999bba&originHeight=206&originWidth=1539&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=25966&status=done&style=none&taskId=u994018e9-6c7e-4402-98b2-7c162ee44c9&title=&width=1026" alt="image.png"></p>
<h3 id="JSON-TYPE"><a href="#JSON-TYPE" class="headerlink" title="JSON_TYPE"></a><strong>JSON_TYPE</strong></h3><p>JSON_TYPE(json_val)，该方法用于返回 JSON 值的类型。首先看一个JSON整型的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_type(&#x27;12345&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583417931-9854fce7-049b-48e7-a4c9-159660635190.png#averageHue=%231a1a1a&clientId=u79b58c88-76cc-4&from=paste&height=142&id=u8e6c7f99&originHeight=213&originWidth=489&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11986&status=done&style=none&taskId=u4ffe10ba-d1e2-4150-b220-326548a7fe1&title=&width=326" alt="image.png"><br>再看一个JSON字符串类型的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_type(&#x27;&quot;abcd&quot;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583545781-30ae4848-5860-4f9a-bb7e-89d8c46b8c55.png#averageHue=%231a1a1a&clientId=u79b58c88-76cc-4&from=paste&height=139&id=u89b81e93&originHeight=209&originWidth=473&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11577&status=done&style=none&taskId=u9bd95972-1d0d-49d0-8e32-0db106491b8&title=&width=315.3333333333333" alt="image.png"><br>再看一个JOSN时间类型的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_type(cast(now() as json));</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583596058-972bc826-7790-455f-9735-84e8c3ae5aa7.png#averageHue=%231b1b1b&clientId=u79b58c88-76cc-4&from=paste&height=137&id=u3cf30eb9&originHeight=205&originWidth=642&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=13849&status=done&style=none&taskId=u779c3404-fb0d-4a31-a878-2e0b7f2c2da&title=&width=428" alt="image.png"><br>再看一个JOSN数组类型的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_type(json_extract(&#x27;&#123;&quot;a&quot;: [1234, false, &quot;1234&quot;]&#125;&#x27;, &#x27;$.a&#x27;));</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583671242-fedddf22-f1ce-4b3d-9839-51562a7071cd.png#averageHue=%231a1a1a&clientId=u79b58c88-76cc-4&from=paste&height=135&id=u3d156918&originHeight=203&originWidth=1082&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=20518&status=done&style=none&taskId=u1f588aac-0fe9-4d6c-8150-53ab496abb9&title=&width=721.3333333333334" alt="image.png"></p>
<h3 id="JSON-VALID"><a href="#JSON-VALID" class="headerlink" title="JSON_VALID"></a><strong>JSON_VALID</strong></h3><p>JSON_VALID(val)，该方法用于判断给定值是否为有效的 JSON 文档。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select json_valid(&#x27;hello&#x27;), json_valid(&#x27;&quot;hello&quot;&#x27;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692583793642-42a978b7-6514-4144-bb82-fad5e573ba70.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=140&id=u0353df04&originHeight=210&originWidth=813&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=14873&status=done&style=none&taskId=u904b1330-310c-4334-9d45-ea18aeb79fa&title=&width=542" alt="image.png"></p>
<h3 id="JSON-TABLE"><a href="#JSON-TABLE" class="headerlink" title="JSON_TABLE"></a><strong>JSON_TABLE</strong></h3><p>JSON_TABLE(expr, path COLUMNS (column_list) [AS] alias)，该方法用于从 JSON 文档中提取数据并以表格形式返回。</p>
<p>该方法的完整语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">JSON_TABLE(</span><br><span class="line">    expr,</span><br><span class="line">    path COLUMNS (column_list)</span><br><span class="line">)   [AS] alias</span><br><span class="line"></span><br><span class="line">column_list:</span><br><span class="line">    column[, column][, ...]</span><br><span class="line"></span><br><span class="line">column:</span><br><span class="line">    name FOR ORDINALITY</span><br><span class="line">    |  name type PATH string_path [on_empty] [on_error]</span><br><span class="line">    |  name type EXISTS PATH string_path</span><br><span class="line">    |  NESTED [PATH] path COLUMNS (column_list)</span><br><span class="line"></span><br><span class="line">on_empty:</span><br><span class="line">    &#123;NULL | DEFAULT json_string | ERROR&#125; ON EMPTY</span><br><span class="line"></span><br><span class="line">on_error:</span><br><span class="line">    &#123;NULL | DEFAULT json_string | ERROR&#125; ON ERROR</span><br></pre></td></tr></table></figure>
<p>解释一下上述各个参数的含义：</p>
<ul>
<li>expr：可返回 JSON 文档的表达式。它可以是一个标量（ JSON 文档 ），列名或者一个函数调用（ JSON_EXTRACT(t1.json_data,’$.post.comments’) ）。</li>
<li>path：JSON 的路径表达式。</li>
<li>column：列的类型，支持以下四种类型：<ul>
<li>name FOR ORDINALITY：序号。name 是列名。</li>
<li>name type PATH string_path [on_empty] [on_error]：提取指定路径（ string_path ）的元素。name 是列名，type 是 MySQL 中的数据类型。</li>
<li>name type EXISTS PATH string_path：指定路径（ string_path ）的元素是否存在。</li>
<li>NESTED [PATH] path COLUMNS (column_list)：将嵌套对象或数组与来自父对象或数组的 JSON 值扁平化为一行输出。</li>
</ul>
</li>
</ul>
<p>举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	* </span><br><span class="line">FROM</span><br><span class="line">	json_table (</span><br><span class="line">		&#x27;[&#123;&quot;x&quot;:2, &quot;y&quot;:&quot;8&quot;, &quot;z&quot;:9, &quot;b&quot;:[1,2,3]&#125;, &#123;&quot;x&quot;:&quot;3&quot;, &quot;y&quot;:&quot;7&quot;&#125;, &#123;&quot;x&quot;:&quot;4&quot;, &quot;y&quot;:6, &quot;z&quot;:10&#125;]&#x27;,</span><br><span class="line">		&quot;$[*]&quot; COLUMNS (</span><br><span class="line">			id FOR ordinality,</span><br><span class="line">			xval VARCHAR ( 100 ) path &quot;$.x&quot;,</span><br><span class="line">			yval VARCHAR ( 100 ) path &quot;$.y&quot;,</span><br><span class="line">			z_exist INT EXISTS path &quot;$.z&quot;,</span><br><span class="line">			nested path &#x27;$.b[*]&#x27; COLUMNS ( b INT PATH &#x27;$&#x27; ) </span><br><span class="line">		) </span><br><span class="line">	) AS t;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692584362428-64ceaaaa-d934-4c64-9517-e692107eb301.png#averageHue=%23121212&clientId=u79b58c88-76cc-4&from=paste&height=430&id=u04282bb6&originHeight=645&originWidth=1401&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=63070&status=done&style=none&taskId=u758fe789-a9e1-466e-809e-117c6f21e29&title=&width=934" alt="image.png"></p>
<h3 id="JSON-SCHEMA-VALID"><a href="#JSON-SCHEMA-VALID" class="headerlink" title="JSON_SCHEMA_VALID"></a><strong>JSON_SCHEMA_VALID</strong></h3><p>JSON_SCHEMA_VALID(schema,document)，该方法用于判断 document （ JSON 文档 ）是否满足 schema （ JSON 对象）定义的规范要求。完整的规范要求可参考 <a target="_blank" rel="noopener" href="https://json-schema.org/specification-links.html#draft-4">Draft 4 of the JSON Schema specification</a>。如果不满足，可通过 JSON_SCHEMA_VALIDATION_REPORT() 方法来获取具体的原因。</p>
<p>举个例子，如下所示的 schema 信息如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">set @schema = &#x27;&#123;</span><br><span class="line">   &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">   &quot;properties&quot;: &#123;</span><br><span class="line">     &quot;latitude&quot;: &#123;</span><br><span class="line">       &quot;type&quot;: &quot;number&quot;,</span><br><span class="line">       &quot;minimum&quot;: -90,</span><br><span class="line">       &quot;maximum&quot;: 90</span><br><span class="line">     &#125;,</span><br><span class="line">     &quot;longitude&quot;: &#123;</span><br><span class="line">       &quot;type&quot;: &quot;number&quot;,</span><br><span class="line">       &quot;minimum&quot;: -180,</span><br><span class="line">       &quot;maximum&quot;: 180</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;required&quot;: [&quot;latitude&quot;, &quot;longitude&quot;]</span><br><span class="line">&#125;&#x27;;</span><br></pre></td></tr></table></figure>
<p>从 schema 中可以看出如下信息：<br>（1）document 必须是 JSON 对象；<br>（2）JSON 对象必须有 latitude 和 longitude 这两个属性；<br>（3）latitude 和 longitude 必须是数值类型，且两者的大小分别在 -90 ～ 90，-180 ～ 180 之间。<br>那么接下来我们就通过定义一个document，并通过 json_schema_valid() 方法来验证document 是否满足 schema 定义的规范要求，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @schema = &#x27;&#123;</span><br><span class="line">    &#x27;&gt;    &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">    &#x27;&gt;    &quot;properties&quot;: &#123;</span><br><span class="line">    &#x27;&gt;      &quot;latitude&quot;: &#123;</span><br><span class="line">    &#x27;&gt;        &quot;type&quot;: &quot;number&quot;,</span><br><span class="line">    &#x27;&gt;        &quot;minimum&quot;: -90,</span><br><span class="line">    &#x27;&gt;        &quot;maximum&quot;: 90</span><br><span class="line">    &#x27;&gt;      &#125;,</span><br><span class="line">    &#x27;&gt;      &quot;longitude&quot;: &#123;</span><br><span class="line">    &#x27;&gt;        &quot;type&quot;: &quot;number&quot;,</span><br><span class="line">    &#x27;&gt;        &quot;minimum&quot;: -180,</span><br><span class="line">    &#x27;&gt;        &quot;maximum&quot;: 180</span><br><span class="line">    &#x27;&gt;      &#125;</span><br><span class="line">    &#x27;&gt;    &#125;,</span><br><span class="line">    &#x27;&gt;    &quot;required&quot;: [&quot;latitude&quot;, &quot;longitude&quot;]</span><br><span class="line">    &#x27;&gt; &#125;&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set @document = &#x27;&#123;&quot;latitude&quot;: 63.564456,&quot;longitude&quot;: 10.237812&#125;&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_schema_valid(@schema, @document);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| json_schema_valid(@schema, @document) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     1 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>从上面执行结果中可以看出，验证是通过的。接下来我们尝试定义一个 document ，它只传入latitude这一个参数，可以看到验证是不通过的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @document = &#x27;&#123;&quot;latitude&quot;: 63.564456&#125;&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_schema_valid(@schema, @document);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| json_schema_valid(@schema, @document) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     0 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>之后我们尝试输出一下错误信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select json_pretty(json_schema_validation_report(@schema, @document))\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">json_pretty(json_schema_validation_report(@schema, @document)): &#123;</span><br><span class="line">  &quot;valid&quot;: false,</span><br><span class="line">  &quot;reason&quot;: &quot;The JSON document location &#x27;#&#x27; failed requirement &#x27;required&#x27; at JSON Schema location &#x27;#&#x27;&quot;,</span><br><span class="line">  &quot;schema-location&quot;: &quot;#&quot;,</span><br><span class="line">  &quot;document-location&quot;: &quot;#&quot;,</span><br><span class="line">  &quot;schema-failed-keyword&quot;: &quot;required&quot;</span><br><span class="line">&#125;</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure>
<p>可以看到这里的原因就是缺少longitude参数，那么接下来我们尝试传入longitude参数，但是取值我们又取错误的值，然后再来测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @document = &#x27;&#123;&quot;latitude&quot;: 96, &quot;longitude&quot;: 0&#125;&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_schema_valid(@schema, @document);</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| json_schema_valid(@schema, @document) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     0 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_pretty(json_schema_validation_report(@schema, @document))\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">json_pretty(json_schema_validation_report(@schema, @document)): &#123;</span><br><span class="line">  &quot;valid&quot;: false,</span><br><span class="line">  &quot;reason&quot;: &quot;The JSON document location &#x27;#/latitude&#x27; failed requirement &#x27;maximum&#x27; at JSON Schema location &#x27;#/properties/latitude&#x27;&quot;,</span><br><span class="line">  &quot;schema-location&quot;: &quot;#/properties/latitude&quot;,</span><br><span class="line">  &quot;document-location&quot;: &quot;#/latitude&quot;,</span><br><span class="line">  &quot;schema-failed-keyword&quot;: &quot;maximum&quot;</span><br><span class="line">&#125;</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure>
<p>从执行结果中也可以看到，验证不通过的原因就是取值超出了属性的可允许取值范围。</p>
<h1 id="对JSON字段创建索引"><a href="#对JSON字段创建索引" class="headerlink" title="对JSON字段创建索引"></a>对JSON字段创建索引</h1><p>实际上，和 TEXT，BLOB 字段一样，JSON 字段是不允许直接创建索引的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table tb_json3(t1 json, index(t1));</span><br><span class="line">ERROR 3152 (42000): JSON column &#x27;t1&#x27; supports indexing only via generated columns on a specified JSON path.</span><br></pre></td></tr></table></figure>
<p>实际上即使支持直接创建索引，其意义也不大，一般来说我们都是基于文档中的元素进行查询，很少会基于整个  JSON 文档。如果需要对文档中的元素进行查询，那么就需要使用到 MySQL 5.7 引入的虚拟列及函数索引。</p>
<p>如下所示，我们新建一个数据表tb_json3，其中t1类型为JOSN，然后t2是虚拟列，之后使用 index (t2) 来对虚拟列t2添加索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json3(t1 json, t2 varchar(100) as (JSON_UNQUOTE(t1 -&gt; &#x27;$.name&#x27;)), index (t2));</span><br></pre></td></tr></table></figure>
<p>之后我们往该数据表中插入5条测试数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO tb_json3 ( t1 )</span><br><span class="line">VALUES</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;zhangsan&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;lisi&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 3, &quot;name&quot;: &quot;wanger&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 4, &quot;name&quot;: &quot;mazi&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 5, &quot;name&quot;: &quot;zhangsanfeng&quot;&#125;&#x27; )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>可以看到此时数据库中的数据如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692586568144-6ceee757-ef57-4520-923a-b774bdf73ca7.png#averageHue=%23daad66&clientId=u79b58c88-76cc-4&from=paste&height=115&id=u196a299b&originHeight=173&originWidth=1084&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=14014&status=done&style=none&taskId=u9a802a78-9b6b-4522-a919-61d52151d63&title=&width=722.6666666666666" alt="image.png"><br>接下来我们尝试查询姓名为lisi的用户，首先使用虚拟列来进行查询，查看一下执行计划：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_json3 where t2 = &#x27;lisi&#x27;;</span><br></pre></td></tr></table></figure>
<p>执行一下该执行计划，结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692586726584-a95d611a-543d-4dfc-8863-c36f0f992862.png#averageHue=%23e7e5e4&clientId=u79b58c88-76cc-4&from=paste&height=43&id=u11f04775&originHeight=65&originWidth=1423&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=11212&status=done&style=none&taskId=u78c47c55-e77d-4210-ab41-3294ed8cc5a&title=&width=948.6666666666666" alt="image.png"><br>接着我们尝试使用文档中的元素来查询，同样也是先看一下执行计划：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_json3 where t1 -&gt; &#x27;$.name&#x27; = &#x27;lisi&#x27;;</span><br></pre></td></tr></table></figure>
<p>执行一下该执行计划，结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692586726584-a95d611a-543d-4dfc-8863-c36f0f992862.png#averageHue=%23e7e5e4&from=url&id=I8nlI&originHeight=65&originWidth=1423&originalType=binary&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&title="><br>从上述输出结果中可以看到，无论是使用虚拟列，还是文档中的元素来进行查询，它们都会用到索引。<strong>请注意，在创建虚拟列时，需要使用 JSON_UNQUOTE方法，来将 t1 -&gt; “$.name” 的返回值转换为字符串。</strong></p>
<h1 id="将存储-JSON-字符串的字符字段升级为-JSON-字段"><a href="#将存储-JSON-字符串的字符字段升级为-JSON-字段" class="headerlink" title="将存储 JSON 字符串的字符字段升级为 JSON 字段"></a>将存储 JSON 字符串的字符字段升级为 JSON 字段</h1><p>在 MySQL 支持 JSON 类型之前，对于 JSON 文档，一般是以字符串的形式存储在字符类型中（VARCHAR 或 TEXT）。</p>
<p>现在问题来了，在 JSON 类型出来后，如何将这些字符字段升级为 JSON 字段呢？为了学习的需要，这里先构建测试表和数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">create table tb_json4 (id int auto_increment primary key, t1 text);</span><br><span class="line"></span><br><span class="line">insert into tb_json4 (t1) values (&#x27;&#123;&quot;id&quot;: &quot;1&quot;, &quot;name&quot;: &quot;a&quot;&#125;&#x27;),</span><br><span class="line">(&#x27;&#123;&quot;id&quot;: &quot;2&quot;, &quot;name&quot;: &quot;b&quot;&#125;&#x27;), </span><br><span class="line">(&#x27;&#123;&quot;id&quot;: &quot;3&quot;, &quot;name&quot;: &quot;c&quot;&#125;&#x27;), </span><br><span class="line">(&#x27;&#123;&quot;id&quot;, &quot;name&quot;: &quot;d&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>注意，第4条记录的json数据是有问题的，不符合JSON格式的要求，这里先不管，后面会进行修改，此时数据库中的数据如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587376783-6e20adef-3bb1-4d15-b01a-e02d22ca5a9a.png#averageHue=%23d7aa63&clientId=u79b58c88-76cc-4&from=paste&height=97&id=uf90650c6&originHeight=146&originWidth=326&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=6336&status=done&style=none&taskId=udba0c808-d0fa-433b-adf7-387d82d0bdb&title=&width=217.33333333333334" alt="image.png"><br>接着，修改t1字段的类型。如果我们直接使用 DDL语句来修改字段的数据类型，那么它会报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_json4 modify t1 json;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587501344-bcad7f89-50b3-4131-9929-3e0700dab460.png#averageHue=%231e1e1e&clientId=u79b58c88-76cc-4&from=paste&height=42&id=u64da4e51&originHeight=63&originWidth=1967&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17188&status=done&style=none&taskId=u4ed803c8-7e60-4186-b984-e193fa36e23&title=&width=1311.3333333333333" alt="image.png"><br>所以我们需要另一种方式来修改t1字段的类型，对应的修改步骤如下所示：<br>第一步，使用 json_valid 方法找出不满足 JSON 格式要求的文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_json4 where json_valid(t1) = 0;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587645354-6af19a3f-6c69-4a18-ac1a-c827fbd33aa8.png#averageHue=%23171717&clientId=u79b58c88-76cc-4&from=paste&height=137&id=ubf6140ce&originHeight=206&originWidth=777&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=14531&status=done&style=none&taskId=ud2e56a09-ca4d-478e-99e9-f4a593191be&title=&width=518" alt="image.png"><br>第二步，处理不满足 JSON 格式要求的文档。接着我们就需要使用DDL语句来修改不满足JSON格式要求的文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json4 set t1 = &#x27;&#123;&quot;id&quot;: &quot;4&quot;, &quot;name&quot;: &quot;d&quot;&#125;&#x27; where id = 4;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587815313-7c36a49c-e1a8-4a53-b08d-130c0c96a059.png#averageHue=%231e1e1e&clientId=u79b58c88-76cc-4&from=paste&height=82&id=u261c52d8&originHeight=123&originWidth=1017&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=19320&status=done&style=none&taskId=u56267011-364f-4215-af6b-e16644b4c03&title=&width=678" alt="image.png"><br>第三步，将 TEXT 字段修改为 JSON 字段。现在我们再次检查是否存在不符合JSON格式要求的文档，执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587923081-d20ed51b-2aee-459c-b1a3-4a2d49658bed.png#averageHue=%231f1f1f&clientId=u79b58c88-76cc-4&from=paste&height=40&id=uc5c9ea84&originHeight=60&originWidth=777&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=7690&status=done&style=none&taskId=u783248f9-4b9c-40b9-9df3-986aee622db&title=&width=518" alt="image.png"><br>之后我们就可以修改t1字段的类型了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_json4 modify t1 json;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692587999908-c26ec33d-e133-4f1f-98f0-876163a4fea0.png#averageHue=%23191919&clientId=u79b58c88-76cc-4&from=paste&height=339&id=u4df7d335&originHeight=509&originWidth=609&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=36418&status=done&style=none&taskId=u6db2b8fe-bc98-4a7b-bcfd-1e46fe377c9&title=&width=406" alt="image.png"></p>
<h1 id="使用JSON时的注意事项"><a href="#使用JSON时的注意事项" class="headerlink" title="使用JSON时的注意事项"></a>使用JSON时的注意事项</h1><p>在使用JSON类型时，有如下四个注意事项：<br>（1）在 MySQL 8.0.13 之前，不允许对 BLOB，TEXT，GEOMETRY，JSON 字段设置默认值。而从 MySQL 8.0.13 开始，取则消了这个限制。</p>
<p>请注意，在设置默认值时，默认值需要由小括号 () 括起来，否则会抛出 JSON 字段不允许设置默认值的提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table tb_json5(t1 json not null default &#x27;&#x27;);</span><br><span class="line">ERROR 1101 (42000): BLOB, TEXT, GEOMETRY or JSON column &#x27;t1&#x27; can&#x27;t have a default value</span><br><span class="line"></span><br><span class="line">mysql&gt; create table tb_json5(t1 json not null default (&#x27;&#x27;));</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>（2）不允许直接给JSON类型字段创建索引，但可创建函数索引；<br>（3）JSON 列的最大大小和 LONGBLOB（LONGTEXT）一样，都是 4G；<br>（4）插入时，单个文档的大小受到 max_allowed_packet 的限制，该参数最大是 1G。</p>
<h1 id="Partial-Updates"><a href="#Partial-Updates" class="headerlink" title="Partial Updates"></a>Partial Updates</h1><p>在 MySQL 5.7 中，对于JSON 文档进行更新的策略：先删除旧的文档，再插入新的文档。这种方式效率非常低下，即使这个修改很微小，只涉及几个字节，也会替换掉整个文档。<br>在<br>而在 MySQL 8.0 中，针对 JSON 文档，引入了一项新的特性—Partial Updates（部分更新），它支持 JSON 文档的原地更新。得益于这个特性，JSON 文档的处理性能得到了极大提升。</p>
<p>如下所示，我们新建一个数据表tb_json6，其中id类型为int，而t1为JSON类型，对应的建表语句如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json6(id int auto_increment primary key, t1 json);</span><br></pre></td></tr></table></figure>
<p>之后我们往该数据表中插入5条测试数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO tb_json6 ( t1 )</span><br><span class="line">VALUES</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;zhangsan&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;lisi&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 3, &quot;name&quot;: &quot;wanger&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 4, &quot;name&quot;: &quot;mazi&quot;&#125;&#x27; ),</span><br><span class="line">	( &#x27;&#123;&quot;id&quot;: 5, &quot;name&quot;: &quot;zhangsanfeng&quot;&#125;&#x27; )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>可以看到此时数据库中的数据如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692595548155-e6c04598-f311-499a-8073-4a05ca661ec2.png#averageHue=%23f6f4f2&clientId=u79b58c88-76cc-4&from=paste&height=118&id=ua6bae6d6&originHeight=177&originWidth=514&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=10416&status=done&style=none&taskId=u0f4fbdf9-5944-433a-8658-64ecd90c435&title=&width=342.6666666666667" alt="image.png"></p>
<h3 id="使用-Partial-Updates-的条件"><a href="#使用-Partial-Updates-的条件" class="headerlink" title="使用 Partial Updates 的条件"></a>使用 Partial Updates 的条件</h3><p>（1）被更新的列是 JSON 类型。<br>（2）使用 JSON_SET，JSON_REPLACE，JSON_REMOVE 这三个函数进行 UPDATE 操作。举个例子，如下所示更新语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1=json_remove(t1,&#x27;$.id&#x27;) where id=1;</span><br></pre></td></tr></table></figure>
<p>执行该语句后，我们查询一下数据表，结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1692595783650-78015db6-687d-493f-a857-7ac5ee0182b8.png#averageHue=%231c1c1c&clientId=u79b58c88-76cc-4&from=paste&height=221&id=u50e44b81&originHeight=331&originWidth=603&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24384&status=done&style=none&taskId=uced3a7b2-50e6-496e-832e-9c09a060b8e&title=&width=402" alt="image.png"><br>请注意，如果开发者不使用上述三个函数赋值，而采用手动显式赋值，那么就不会进行部分更新。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1=&#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;a&quot;&#125;&#x27; where id=1;</span><br></pre></td></tr></table></figure>
<p>执行该语句后，我们查询一下数据表，结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693187345536-3898cb52-bcd3-46e7-b015-3475f744fcf8.png#averageHue=%231b1b1b&clientId=u6cd2691a-9d9f-4&from=paste&height=220&id=ub19d4dd9&originHeight=330&originWidth=613&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24316&status=done&style=none&taskId=u13a560a3-1218-4ef4-9d54-9671b05989e&title=&width=408.6666666666667" alt="image.png"><br>实际上此时它并不是进行部分更新，而是先删除旧的记录，然后再插入了新的记录，这个操作在数据量大的情况下会影响系统性能。<br>（3）输入列和目标列必须是同一列，否则也不会进行部分更新。举个例子，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1 = json_replace(t1,&#x27;$.id&#x27;,10) where id=1;</span><br></pre></td></tr></table></figure>
<p>执行该语句后，我们查询一下数据表，结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693187681967-fbcbc51c-0afc-499d-b53c-7ed1e836e29e.png#averageHue=%231c1c1c&clientId=u6cd2691a-9d9f-4&from=paste&height=218&id=u97dbb472&originHeight=327&originWidth=604&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24488&status=done&style=none&taskId=udd608f00-5d62-4dd6-8eb0-0405b331a41&title=&width=402.6666666666667" alt="image.png"><br>如果我们使用的是下面的语句，那么就不是部分更新了，这里的t2列实际上是不存在的，这里只是为了演示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1 = json_replace(t2,&#x27;$.id&#x27;,10) where id=1;</span><br></pre></td></tr></table></figure>
<p>（4）变更前后，JSON 文档的空间使用不会增加。举个例子，首先我们查看一下id为1的记录所占用的空间大小：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,json_storage_size(t1),json_storage_free(t1) from tb_json6 where id=1;</span><br></pre></td></tr></table></figure>
<p>执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693188017872-df1d0bdf-471c-4706-8932-87dfb3aaf074.png#averageHue=%231b1b1b&clientId=u6cd2691a-9d9f-4&from=paste&height=135&id=u778fcb6c&originHeight=203&originWidth=1193&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=22083&status=done&style=none&taskId=u1ac1389d-05aa-4d6e-838f-c9881e988e0&title=&width=795.3333333333334" alt="image.png"><br>接着我们尝试修改id为1的记录，将id为1的记录中的id属性给去除，对应的SQL如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1=json_remove(t1,&#x27;$.id&#x27;) where id=1;</span><br></pre></td></tr></table></figure>
<p>之后我们再次执行查询语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,json_storage_size(t1),json_storage_free(t1) from tb_json6 where id=1;</span><br></pre></td></tr></table></figure>
<p>可以看到执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693188165598-36f8a9f0-a672-48b1-a46b-6afb491345f0.png#averageHue=%231a1a1a&clientId=u6cd2691a-9d9f-4&from=paste&height=139&id=u9a538d41&originHeight=208&originWidth=1200&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21752&status=done&style=none&taskId=ube40082d-fce0-4b08-bc39-c8c37d8667f&title=&width=800" alt="image.png"><br>接下来我们使用json_set函数来更新JSON文档，对应的SQL如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1=json_set(t1,&#x27;$.id&#x27;,10086) where id=1;</span><br></pre></td></tr></table></figure>
<p>之后我们再次执行查询语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,json_storage_size(t1),json_storage_free(t1) from tb_json6 where id=1;</span><br></pre></td></tr></table></figure>
<p>可以看到执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693188346984-51df017f-f4a6-4d74-97b1-ff04666a3c72.png#averageHue=%231b1b1b&clientId=u6cd2691a-9d9f-4&from=paste&height=135&id=u7e7dbc3f&originHeight=203&originWidth=1206&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=22636&status=done&style=none&taskId=u752486d4-3892-4759-a7f6-97c54a71714&title=&width=804" alt="image.png"><br>接这我们再次使用json_set函数来更新JSON文档，对应的SQL如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1=json_set(t1,&#x27;$.id&#x27;,&#x27;helloworld&#x27;) where id=1;</span><br></pre></td></tr></table></figure>
<p>之后再次执行查询语句，可以看到执行结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693188486922-90c1348c-8928-4b2d-939a-cfd8cf0edbc2.png#averageHue=%231a1a1a&clientId=u6cd2691a-9d9f-4&from=paste&height=143&id=u216f73ba&originHeight=215&originWidth=1281&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23839&status=done&style=none&taskId=u760d749e-fcf3-4b22-9f09-462c7bbcf70&title=&width=854" alt="image.png"><br>怎么两次使用json_set函数查询出来的数据有些不一样呢？下面我们将对这些现象进行详细学习。</p>
<p>在上面的例子中，我们使用了json_storage_size和json_storage_free这两个函数，其中json_storage_size用于获取JSON文档的空间使用情况，而json_storage_free则是用于获取JSON文档在执行原地更新后的空间释放情况。</p>
<p>从例子中可以看出，我们一共执行了三次更新操作（两次json_set，一次json_remove），其中前两次是原地更新，而第三次不是。那么问题来了，同样使用了json_set方法，为什么第一次是原地更新，而第二次却不是呢？那是因为第一次的json_set复用了json_remove释放的空间，而第二次的json_set执行的是更新操作，且 ‘helloworld’ 比 10086 需要更多的存储空间，因此两次查询获取到的空间使用情况就不一样了。</p>
<h3 id="如何在-binlog-中开启-Partial-Updates"><a href="#如何在-binlog-中开启-Partial-Updates" class="headerlink" title="如何在 binlog 中开启 Partial Updates"></a>如何在 binlog 中开启 Partial Updates</h3><p>Partial Updates 不仅适用于存储引擎层，还可用于主从复制。主从复制场景下，开启 Partial Updates，只需将binlog_row_value_options参数设置为 PARTIAL_JSON，注意这个参数默认为空。</p>
<p>下面我们将通过一个案例来学习，同一个 UPDATE 操作，在开启和不开启 Partial Updates情况下，在 binlog 中的记录有什么区别。</p>
<p>这是UPDATE操作所使用的语句，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json6 set t1 = json_replace(t1,&#x27;$.id&#x27;,10) where id = 1;</span><br></pre></td></tr></table></figure>
<p>以下是未开启Partial Updates时的binlog记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">### UPDATE `slowtech`.`tb_json6`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=1</span><br><span class="line">###   @2=&#x27;&#123;&quot;id&quot;: &quot;1&quot;, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span><br><span class="line">### SET</span><br><span class="line">###   @1=1</span><br><span class="line">###   @2=&#x27;&#123;&quot;id&quot;: 10, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>下面是开启了Partial Updates时的binlog记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">### UPDATE `slowtech`.`tb_json6`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=1</span><br><span class="line">###   @2=&#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span><br><span class="line">### SET</span><br><span class="line">###   @1=1</span><br><span class="line">###   @2=JSON_REPLACE(@2, &#x27;$.id&#x27;, 10)</span><br></pre></td></tr></table></figure>
<p>通过对上述两条binlog记录的对比，可以看出在不开启Partial Updates时，无论是修改前的镜像（before_image）还是修改后的镜像（after_image），记录的都是完整文档。而开启Partial Updates后，对于修改后的镜像，记录的是命令，而不是完整文档，这样可节省近一半的空间。</p>
<p>开发者在将 binlog_row_value_options 参数设置为 PARTIAL_JSON 后，对于可使用 Partial Updates 的操作，在 binlog 中，不再通过 ROWS_EVENT 来记录，而是新增了一个 PARTIAL_UPDATE_ROWS_EVENT 的事件类型。</p>
<p><strong>请注意，binlog 中使用 Partial Updates，只需满足存储引擎层使用 Partial Updates 的前三个条件，无需考虑变更前后，JSON 文档的空间使用是否会增加。</strong></p>
<h3 id="关于-Partial-Updates-的性能测试"><a href="#关于-Partial-Updates-的性能测试" class="headerlink" title="关于 Partial Updates 的性能测试"></a>关于 Partial Updates 的性能测试</h3><p>首先我们构造数据表和数据，假设tb_json7表一共有 16 个文档，每个文档近 10 MB，对应SQL语句如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create table tb_json7(id int auto_increment primary key,</span><br><span class="line">               t1 json,</span><br><span class="line">               name varchar(100) as (t1-&gt;&gt;&#x27;$.name&#x27;),</span><br><span class="line">               age int as (t1-&gt;&#x27;$.age&#x27;));</span><br><span class="line"></span><br><span class="line">insert into tb_json7(t1) values</span><br><span class="line">(json_object(&#x27;name&#x27;, &#x27;Joe&#x27;, &#x27;age&#x27;, 24,</span><br><span class="line">             &#x27;data&#x27;, repeat(&#x27;x&#x27;, 10 * 1000 * 1000))),</span><br><span class="line">(json_object(&#x27;name&#x27;, &#x27;Sue&#x27;, &#x27;age&#x27;, 32,</span><br><span class="line">             &#x27;data&#x27;, repeat(&#x27;y&#x27;, 10 * 1000 * 1000))),</span><br><span class="line">(json_object(&#x27;name&#x27;, &#x27;Pete&#x27;, &#x27;age&#x27;, 40,</span><br><span class="line">             &#x27;data&#x27;, repeat(&#x27;z&#x27;, 10 * 1000 * 1000))),</span><br><span class="line">(json_object(&#x27;name&#x27;, &#x27;Jenny&#x27;, &#x27;age&#x27;, 27,</span><br><span class="line">             &#x27;data&#x27;, repeat(&#x27;w&#x27;, 10 * 1000 * 1000)));</span><br><span class="line"></span><br><span class="line">insert into tb_json7(t1) select t1 from tb_json7;</span><br><span class="line">insert into tb_json7(t1) select t1 from tb_json7;</span><br></pre></td></tr></table></figure>
<p>接着我们尝试测试如下SQL语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_json7 set t1 = json_set(t1, &#x27;$.age&#x27;, age + 1);</span><br></pre></td></tr></table></figure>
<p>然后在如下四种场景进行执行，并统计对应的执行时间：<br>（1）MySQL 5.7.36；<br>（2）MySQL 8.0.27<br>（3）MySQL 8.0.27，binlog_row_value_options=PARTIAL_JSON<br>（4）MySQL 8.0.27，binlog_row_value_options=PARTIAL_JSON + binlog_row_image=MINIMAL<br>这里我们选择分别执行 10 次，然后去掉最大值和最小值，最后求平均值，得到的结果如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12555354/1693190440934-bb38d69a-8d19-4405-b483-7942d9cc96c3.png#averageHue=%2312133a&clientId=u6cd2691a-9d9f-4&from=paste&height=499&id=u2f8c004e&originHeight=749&originWidth=965&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=54229&status=done&style=none&taskId=u98fb6391-a999-4738-b96c-69cb585187a&title=&width=643.3333333333334" alt="image.png"><br>请注意，这里我们以 MySQL 5.7.36 的查询时间作为基准：<br>（1）MySQL 8.0 只开启存储引擎层的 Partial Updates，查询时间比 MySQL 5.7 快 1.94 倍。<br>（2）MySQL 8.0 同时开启存储引擎层和 binlog 中的 Partial Updates，查询时间比 MySQL 5.7 快 4.87 倍。<br>（3）如果在 （2）的基础上，同时将 binlog_row_image 设置为 MINIMAL，查询时间更是比 MySQL 5.7 快 102.22 倍。<br>当然，在生产环境，我们一般很少将 binlog_row_image 设置为 MINIMAL。但即便如此，<strong>只开启存储引擎层和 binlog 中的 Partial Updates，查询时间也比 MySQL 5.7 快 4.87 倍，这样看性能提升还是比较明显</strong>。</p>
<p>参考文章：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/JSON">JSON官网</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/json.html">The JSON Data Type</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/json-functions.html">JSON Functions</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/upgrading-json-data-stored-in-text-columns/">Upgrading JSON data stored in TEXT columns</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/indexing-json-documents-via-virtual-columns/">Indexing JSON documents via Virtual Columns</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/partial-update-of-json-values/">Partial update of JSON values</a>；</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/blog-archive/mysql-8-0-innodb-introduces-lob-index-for-faster-updates/">MySQL 8.0: InnoDB Introduces LOB Index For Faster Updates</a>。</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://envyzhan.asia">余思</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://envyzhan.asia/2024/03/23/2024-3-detailed-explanation-of-json-data-types-in-mysql/">http://envyzhan.asia/2024/03/23/2024-3-detailed-explanation-of-json-data-types-in-mysql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://envyzhan.asia" target="_blank">余思博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mysql/">mysql</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/27/2024-6-mult-tenant-architecture-design-and-practice/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">多租户架构设计与实践</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/02/2024-2-six-common-configuration-methods-for-reading-properties/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">聊一聊六种常用的属性配置读取方式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/11/1-druid-database-connection-pool-experience/" title="Druid数据库连接池使用体验"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-11</div><div class="title">Druid数据库连接池使用体验</div></div></a></div><div><a href="/2020/05/01/mysql-1-introduction/" title="MySQL概述"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-01</div><div class="title">MySQL概述</div></div></a></div><div><a href="/2020/05/10/mysql-10-authroize-management/" title="MySQL用户权限管理"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-10</div><div class="title">MySQL用户权限管理</div></div></a></div><div><a href="/2020/05/15/mysql-12-dql-in/" title="数据查询语言（DQL）---连接查询"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-15</div><div class="title">数据查询语言（DQL）---连接查询</div></div></a></div><div><a href="/2020/05/19/mysql-13-dql-sub-select/" title="数据查询语言（DQL）---子查询"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-19</div><div class="title">数据查询语言（DQL）---子查询</div></div></a></div><div><a href="/2020/05/22/mysql-14-how-to-use-null/" title="NULL使用记录"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-22</div><div class="title">NULL使用记录</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">余思</div><div class="author-info__description">记录成长路上的点滴</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">263</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:envyzhan@aliyun.com" target="_blank" title=""><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问余思博客，一个技术博主的成长试验田！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON"><span class="toc-number">2.</span> <span class="toc-text">JSON</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">JSON基本数据类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">创建操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5JSON%E6%95%B0%E7%BB%84"><span class="toc-number">4.0.1.</span> <span class="toc-text">直接插入JSON数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%8F%92%E5%85%A5JSON%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.0.2.</span> <span class="toc-text">直接插入JSON对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSON-ARRAY-%E6%9E%84%E9%80%A0JSON%E6%95%B0%E7%BB%84"><span class="toc-number">4.0.3.</span> <span class="toc-text">使用 JSON_ARRAY 构造JSON数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSON-OBJECT-%E6%9E%84%E9%80%A0JSON%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.0.4.</span> <span class="toc-text">使用 JSON_OBJECT 构造JSON对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSON-QUOTE-%E5%B0%86JSON%E8%BD%AC%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.0.5.</span> <span class="toc-text">使用 JSON_QUOTE 将JSON转为字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON%E5%AF%B9%E8%B1%A1%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">4.0.6.</span> <span class="toc-text">JSON对象注意点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">查询操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-CONTAINS"><span class="toc-number">5.0.1.</span> <span class="toc-text">JSON_CONTAINS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-CONTAINS-PATH"><span class="toc-number">5.0.2.</span> <span class="toc-text">JSON_CONTAINS_PATH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-EXTRACT"><span class="toc-number">5.0.3.</span> <span class="toc-text">JSON_EXTRACT</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-EXTRACT%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.0.3.0.1.</span> <span class="toc-text">JSON_EXTRACT在数组中的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-EXTRACT%E5%9C%A8%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.0.3.0.2.</span> <span class="toc-text">JSON_EXTRACT在对象中的使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#column-gt-path"><span class="toc-number">5.0.4.</span> <span class="toc-text">column-&gt;path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#column-gt-gt-path"><span class="toc-number">5.0.5.</span> <span class="toc-text">column-&gt;&gt;path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-SEARCH"><span class="toc-number">5.0.6.</span> <span class="toc-text">JSON_SEARCH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-KEYS"><span class="toc-number">5.0.7.</span> <span class="toc-text">JSON_KEYS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-VALUE"><span class="toc-number">5.0.8.</span> <span class="toc-text">JSON_VALUE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MEMBER-OF"><span class="toc-number">5.0.9.</span> <span class="toc-text">MEMBER OF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-OVERLAPS"><span class="toc-number">5.0.10.</span> <span class="toc-text">JSON_OVERLAPS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">修改操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-INSERT"><span class="toc-number">6.0.1.</span> <span class="toc-text">JSON_INSERT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-SET"><span class="toc-number">6.0.2.</span> <span class="toc-text">JSON_SET</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-REPLACE"><span class="toc-number">6.0.3.</span> <span class="toc-text">JSON_REPLACE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-ARRAY-APPEND"><span class="toc-number">6.0.4.</span> <span class="toc-text">JSON_ARRAY_APPEND</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-ARRAY-INSERT"><span class="toc-number">6.0.5.</span> <span class="toc-text">JSON_ARRAY_INSERT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-MERGE-PATCH"><span class="toc-number">6.0.6.</span> <span class="toc-text">JSON_MERGE_PATCH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-MERGE-PRESERVE"><span class="toc-number">6.0.7.</span> <span class="toc-text">JSON_MERGE_PRESERVE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-MERGE"><span class="toc-number">6.0.8.</span> <span class="toc-text">JSON_MERGE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">删除操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-REMOVE"><span class="toc-number">7.0.1.</span> <span class="toc-text">JSON_REMOVE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">辅助函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-QUOTE"><span class="toc-number">8.0.1.</span> <span class="toc-text">JSON_QUOTE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-UNQUOTE"><span class="toc-number">8.0.2.</span> <span class="toc-text">JSON_UNQUOTE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-OBJECTAGG"><span class="toc-number">8.0.3.</span> <span class="toc-text">JSON_OBJECTAGG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-ARRAYAGG"><span class="toc-number">8.0.4.</span> <span class="toc-text">JSON_ARRAYAGG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-PRETTY"><span class="toc-number">8.0.5.</span> <span class="toc-text">JSON_PRETTY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-STORAGE-FREE"><span class="toc-number">8.0.6.</span> <span class="toc-text">JSON_STORAGE_FREE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-STORAGE-SIZE"><span class="toc-number">8.0.7.</span> <span class="toc-text">JSON_STORAGE_SIZE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-DEPTH"><span class="toc-number">8.0.8.</span> <span class="toc-text">JSON_DEPTH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-LENGTH"><span class="toc-number">8.0.9.</span> <span class="toc-text">JSON_LENGTH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-TYPE"><span class="toc-number">8.0.10.</span> <span class="toc-text">JSON_TYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-VALID"><span class="toc-number">8.0.11.</span> <span class="toc-text">JSON_VALID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-TABLE"><span class="toc-number">8.0.12.</span> <span class="toc-text">JSON_TABLE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON-SCHEMA-VALID"><span class="toc-number">8.0.13.</span> <span class="toc-text">JSON_SCHEMA_VALID</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9JSON%E5%AD%97%E6%AE%B5%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">9.</span> <span class="toc-text">对JSON字段创建索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%86%E5%AD%98%E5%82%A8-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%AD%97%E7%AC%A6%E5%AD%97%E6%AE%B5%E5%8D%87%E7%BA%A7%E4%B8%BA-JSON-%E5%AD%97%E6%AE%B5"><span class="toc-number">10.</span> <span class="toc-text">将存储 JSON 字符串的字符字段升级为 JSON 字段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8JSON%E6%97%B6%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">11.</span> <span class="toc-text">使用JSON时的注意事项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Partial-Updates"><span class="toc-number">12.</span> <span class="toc-text">Partial Updates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Partial-Updates-%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">12.0.1.</span> <span class="toc-text">使用 Partial Updates 的条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8-binlog-%E4%B8%AD%E5%BC%80%E5%90%AF-Partial-Updates"><span class="toc-number">12.0.2.</span> <span class="toc-text">如何在 binlog 中开启 Partial Updates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-Partial-Updates-%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">12.0.3.</span> <span class="toc-text">关于 Partial Updates 的性能测试</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/06/2025-4-practical-implementation-of-local-tool-call-using-springboot-MCP/" title="SpringBoot+MCP实现本地工具调用实战"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot+MCP实现本地工具调用实战"/></a><div class="content"><a class="title" href="/2025/04/06/2025-4-practical-implementation-of-local-tool-call-using-springboot-MCP/" title="SpringBoot+MCP实现本地工具调用实战">SpringBoot+MCP实现本地工具调用实战</a><time datetime="2025-04-06T10:03:01.000Z" title="发表于 2025-04-06 18:03:01">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/01/2025-3-let's-talk-about-the-recently-popular-MCP-protocol/" title="聊一聊最近很火的MCP协议"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="聊一聊最近很火的MCP协议"/></a><div class="content"><a class="title" href="/2025/03/01/2025-3-let's-talk-about-the-recently-popular-MCP-protocol/" title="聊一聊最近很火的MCP协议">聊一聊最近很火的MCP协议</a><time datetime="2025-03-01T11:05:08.000Z" title="发表于 2025-03-01 19:05:08">2025-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/23/2025-2-how-to-set-up-LLM-locally-and-use-it/" title="如何在本地搭建LLM并使用"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在本地搭建LLM并使用"/></a><div class="content"><a class="title" href="/2025/02/23/2025-2-how-to-set-up-LLM-locally-and-use-it/" title="如何在本地搭建LLM并使用">如何在本地搭建LLM并使用</a><time datetime="2025-02-23T09:03:01.000Z" title="发表于 2025-02-23 17:03:01">2025-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/11/2025-1-let's-talk-about-three-commonly-used-real-time-technologies/" title="聊一聊常用的3种实时技术"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="聊一聊常用的3种实时技术"/></a><div class="content"><a class="title" href="/2025/01/11/2025-1-let's-talk-about-three-commonly-used-real-time-technologies/" title="聊一聊常用的3种实时技术">聊一聊常用的3种实时技术</a><time datetime="2025-01-11T10:03:01.000Z" title="发表于 2025-01-11 18:03:01">2025-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/21/2024-11-6-ways-to-synchronize-es-with-mysql/" title="MySQL同步ES的6种方式"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL同步ES的6种方式"/></a><div class="content"><a class="title" href="/2024/12/21/2024-11-6-ways-to-synchronize-es-with-mysql/" title="MySQL同步ES的6种方式">MySQL同步ES的6种方式</a><time datetime="2024-12-21T10:23:04.000Z" title="发表于 2024-12-21 18:23:04">2024-12-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2025  余思博客,记录成长</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '9996b44b488f2fc52124',
      clientSecret: '6bec0f8e9c032eeae6211a5d4cffa3c97e2d4a64',
      repo: 'blogcomment',
      owner: 'Envythink',
      admin: ['Envythink'],
      id: '517ee8e754d96035e3e37d88a6daa835',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div></div></body></html>