<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>整合NoSQL---Redis | 余思博客</title><meta name="keywords" content="springboot"><meta name="author" content="余思"><meta name="copyright" content="余思"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在前面学习了SpringBoot如何整合关系型数据库，接下来开始学习如何整合非关系型数据库(NoSQL)，本篇主要介绍Redis的整合，具体包括Redis介绍、Redis集群搭建，SpringBoot整合单机版Redis和SpringBoot整合Redis集群等。 非关系型数据库非关系型数据库(NoSQL)和关系型数据库两者存在许多的显著不同点，其中最重要的是NoSQL不使用SQL作为查询语言。其">
<meta property="og:type" content="article">
<meta property="og:title" content="整合NoSQL---Redis">
<meta property="og:url" content="http://envyzhan.asia/2019/08/22/springboot-9-makeup-no-sql-redis/index.html">
<meta property="og:site_name" content="余思博客">
<meta property="og:description" content="在前面学习了SpringBoot如何整合关系型数据库，接下来开始学习如何整合非关系型数据库(NoSQL)，本篇主要介绍Redis的整合，具体包括Redis介绍、Redis集群搭建，SpringBoot整合单机版Redis和SpringBoot整合Redis集群等。 非关系型数据库非关系型数据库(NoSQL)和关系型数据库两者存在许多的显著不同点，其中最重要的是NoSQL不使用SQL作为查询语言。其">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png">
<meta property="article:published_time" content="2019-08-22T11:23:04.000Z">
<meta property="article:modified_time" content="2020-11-03T11:56:18.070Z">
<meta property="article:author" content="余思">
<meta property="article:tag" content="springboot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://envyzhan.asia/2019/08/22/springboot-9-makeup-no-sql-redis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '整合NoSQL---Redis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-03 19:56:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="余思博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">235</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 前端</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page child" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page child" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li><li><a class="site-page child" href="/categories/flutter/"><i class="fa-fw fa fa-bullseye"></i><span> Flutter</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page child" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page child" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page child" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page child" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 运维</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page child" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/other/"><i class="fa-fw fa fa-location-arrow"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bell"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 算法结构</span></a></li><li><a class="site-page child" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-address-book"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">余思博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 前端</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page child" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page child" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li><li><a class="site-page child" href="/categories/flutter/"><i class="fa-fw fa fa-bullseye"></i><span> Flutter</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page child" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page child" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page child" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page child" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 运维</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page child" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/other/"><i class="fa-fw fa fa-location-arrow"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bell"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 算法结构</span></a></li><li><a class="site-page child" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-address-book"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">整合NoSQL---Redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-08-22T11:23:04.000Z" title="发表于 2019-08-22 19:23:04">2019-08-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-03T11:56:18.070Z" title="更新于 2020-11-03 19:56:18">2020-11-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/springboot/">springboot</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>在前面学习了SpringBoot如何整合关系型数据库，接下来开始学习如何整合非关系型数据库(NoSQL)，本篇主要介绍Redis的整合，具体包括Redis介绍、Redis集群搭建，SpringBoot整合单机版Redis和SpringBoot整合Redis集群等。</p>
<h1 id="非关系型数据库"><a href="#非关系型数据库" class="headerlink" title="非关系型数据库"></a>非关系型数据库</h1><p>非关系型数据库(NoSQL)和关系型数据库两者存在许多的显著不同点，其中最重要的是NoSQL不使用SQL作为查询语言。其数据存储可以不需要固定的表格模式，一般都有水平可扩展的特征。NoSQL主要有如下几种不同的分类：</p>
<ul>
<li><strong>Key/Value键值存储。</strong>这种数据存储通常都是无数据结构的，一般被当作字符串或者二进制数据，但是数据加载速度快，典型的使用场景就是处理高并发或者用于日志系统等，这一类的数据库有Redis、Tokyo Cabinet等。</li>
<li><strong>列存储数据库。</strong>列存储数据库功能相对局限，但是查找速度快，容易进行分布式扩展，一般用于分布式文件系统中，这一类的数据库有HBase、Cassandra等。</li>
<li><strong>文档型数据库。</strong>和Key/Value键值存储类似，文档型数据库也没有严格的数据格式，这既是缺点也是优点，因为不需要预先创建表结构，数据格式更加灵活，一般可用在Web应用中，这一类的数据库有MongoDB、CouchDB等。</li>
<li><strong>图形数据库。</strong>图形数据库专注于构建关系图谱，例如社交网络，推荐系统等，这一类的数据库有Neo4J、MongoDB等。</li>
</ul>
<p>NoSQL种类繁多，SpringBoot对大多数NoSQL都提供了配置支持，本篇主要介绍两个常见的：Redis和MongoDB。</p>
<h1 id="Redis相关介绍"><a href="#Redis相关介绍" class="headerlink" title="Redis相关介绍"></a>Redis相关介绍</h1><h3 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h3><p>Redis是一个使用C编写的基于内存的NoSQL数据库，它是目前最流行的键值对存储数据库。Redis由一个Key、Value映射的字典构成，与其他NoSQL不同的是，Redis中的Value类型不局限于字符串，还支持列表、集合、有序集合、散列等。Redis不仅可以当做缓存使用，也可以配置数据持久化后当做NoSQL数据库使用，目前支持两种持久化方式：快照持久化和AOF持久化。另一方面，Redis也可以搭建集群或者主从复制结构，在高并发环境下具有高可用性。</p>
<h3 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h3><p>笔者在学习时，Redis最新版本为6.0.1，但是考虑到一些版本的依赖，依旧采用较为流行的Redis4.0版本，安装环境选择CentOS7。其中安装步骤如下：</p>
<p><strong>第一步，下载Redis。</strong>启动虚拟机，进入<code>home</code>目录，并在终端输入以下命令下载Redis：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.10.tar.gz</span><br></pre></td></tr></table></figure>
<p>若提示未找到wget命令，则先执行如下命令安装wget，再下载Redis：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br></pre></td></tr></table></figure>
<p><strong>第二步，安装Redis。</strong>首先解压下载的文件，然后进入解压目录中进行编译，请按照顺序执行如下4条命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-4.0.10.tar.gz</span><br><span class="line">cd redis-4.0.10</span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>若在执行<code>make MALLOC=libc</code>命令时提示<code>gcc：未找到命令</code>，则先执行如下命令安装gcc，等安装成功后再进行编译安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br></pre></td></tr></table></figure>
<p>请注意Redis新版本的安装方式和之前有所不同，可以点击 <a target="_blank" rel="noopener" href="https://redis.io/download">这里</a>进行查看。也可以参看这篇文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/marvinn/p/11081106.html">Linux下Redis的安装和部署</a></p>
<p><strong>第三步，配置Redis。</strong>Redis安装成功后，接下来进行配置，打开Redis解压目录下的<code>redis.conf</code>文件，主要修改如下几个地方（请注意这是修改后的配置情况）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">#bind 127.0.0.1</span><br><span class="line">requirepass 123@456</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>
<p>简单解释一下上述配置的含义：daemonize设置为yes，表示运行Redis在后台启动；第二行表示允许连接该Redis实例的地址，默认情况下只允许本地连接，因此需要将默认配置注释掉，这样外网就可以连接Redis了。requirepass表示设置了登录该Redis实例所需的密码。由于有了第三行配置的密码登录，因此protected-mode表示的保护模式就可以关闭了。</p>
<p><strong>第四步，配置CentOS防火墙。</strong>为了远程能连接上Redis，还需要关闭该虚拟机的防护墙，执行命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>
<p>第一行表示关闭防火墙，第二行表示禁止防火墙开机自启动。最后可以使用<code>firewall-cmd --state</code>命令检测一下防火墙是否已经关闭，当输出<code>not running</code>字样时表示防火墙已经成功被关闭。</p>
<p><strong>第五步，Redis启动与关闭。</strong><br>使用<code> redis-server redis.conf</code>命令来启动Redis。Redis启动成功后，再执行如下命令进入Redis的控制台，其中<code>-a</code>表示Redis的登录密码选项：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123@456</span><br></pre></td></tr></table></figure>
<p>进入控制台后执行ping命令，若能看到输出结果为PONG，则表明Redis安装成功，如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-3c35718d7acbb9a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>如果你想关闭Redis实例，可以在Redis命令行终端内执行<code>SHUTDOWN</code>停止Redis的运行，然后使用exit退出Redis命令行终端。当然也可以直接在CentOS终端下执行如下命令直接停止Redis服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379 -a 123@456 shutdown</span><br></pre></td></tr></table></figure>
<p>其中<code>-p</code>表示要关闭的Redis实例的端口，<code>-a</code>表示Redis的登录密码。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-66a7c5ae237e3d84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>这样单机版的Redis就安装完成并启动成功了，为什么说是单机版，那是因为这里只有一个Redis，后续会介绍Redis集群。</p>
<h1 id="SpringBoot整合Redis单机版"><a href="#SpringBoot整合Redis单机版" class="headerlink" title="SpringBoot整合Redis单机版"></a>SpringBoot整合Redis单机版</h1><p>Redis的Java客户端有很多，如Jedis、JRedis、<code>Spring Data Redis</code>等，SpringBoot借助于<code>Spring Data Redis</code>为Redis提供了开箱即用的自动化配置，开发者只需要添加相关依赖并配置Redis连接信息即可，具体的整合步骤如下：</p>
<p><strong>第一步，创建SpringBoot Web项目并添加依赖。</strong>使用<code>spring Initializr</code>构建工具构建一个SpringBoot的Web应用，名称为<code>redisspringboot</code>，然后在pom.xml文件中添加如下依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--web配置依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--data-redis依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>默认情况下<code>spring-boot-starter-data-redis</code>中使用的Redis工具是Lettuce，考虑到有的开发者习惯使用Jedis，因此可以从<code>spring-boot-starter-data-redis</code>中排除Lettuce并引入Jedis，只需将上述依赖修改如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--web配置依赖--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;!--data-redis依赖中移除Lettuce，使用Jedis--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">     &lt;exclusions&gt;</span><br><span class="line">         &lt;exclusion&gt;</span><br><span class="line">             &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">             &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">         &lt;/exclusion&gt;</span><br><span class="line">     &lt;/exclusions&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;!--使用Jedis依赖--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>第二步，配置Redis。</strong>在<code>application.properties</code>文件中添加Redis的链接信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 基本连接信息配置</span><br><span class="line"># 使用Redis库的编号，Redis中提供了16个database，编号从0-15</span><br><span class="line">spring.redis.database=0</span><br><span class="line"># Redis实例的IP地址</span><br><span class="line">spring.redis.host=192.168.2.132</span><br><span class="line"># Redis端口号，默认6379</span><br><span class="line">spring.redis.port=6379</span><br><span class="line"># Redis登录密码</span><br><span class="line">spring.redis.password=123@456</span><br><span class="line"></span><br><span class="line"># 连接池基本信息配置</span><br><span class="line"># Redis连接池的最大连接数</span><br><span class="line">spring.redis.jedis.pool.max-active=8</span><br><span class="line"># Redis连接池的最大空闲连接数</span><br><span class="line">spring.redis.jedis.pool.max-idle=8</span><br><span class="line"># Redis连接池的最大阻塞等待时间，默认为-1,表示没有限制</span><br><span class="line">spring.redis.jedis.pool.max-wait=-1ms</span><br><span class="line"># Redis连接池的最小空闲连接数</span><br><span class="line">spring.redis.jedis.pool.min-idle=0</span><br></pre></td></tr></table></figure>
<p>请注意如果项目使用了Lettuce，只需将连接池的基本信息中的jedis修改为lettuce即可，而前面的基本连接信息配置不用修改。</p>
<p>在前面整合关系型数据库中，开发者之所以可以轻松实现零配置，是因为SpringBoot在用户未提供对应的配置类，如JdbcOperations缺失情况下会自动提供<code>JdbcTemplate</code>，那么SpringBoot对于Redis的零配置是否也是类似的支持呢？可以发现的确如此，在SpringBoot的自动配置类中提供了<code>RedisAutoConfiguration</code>类用于进行Redis的配置，这里贴出对应的源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span><br><span class="line">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span><br><span class="line">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span><br><span class="line">public class RedisAutoConfiguration &#123;</span><br><span class="line">    public RedisAutoConfiguration() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean(</span><br><span class="line">        name = &#123;&quot;redisTemplate&quot;&#125;</span><br><span class="line">    )</span><br><span class="line">    public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123;</span><br><span class="line">        StringRedisTemplate template = new StringRedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从源码中可以看出，<code>application.properties</code>文件中配置的信息将被注入到<code>RedisProperties</code>中，如果开发者自己没有提供<code>RedisTemplate</code>或者<code>StringRedisTemplate</code>实例，则SpringBoot默认会提供这两个实例，<code>RedisTemplate</code>和<code>StringRedisTemplate</code>实例则提供了Redis的基本操作方法。</p>
<p><strong>第三步，创建实体类</strong>。新建pojo包，并在其中新建Book类，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Book implements Serializable &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String author;</span><br><span class="line">    //getter、setter和toString方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意必须让这个实体类实现<code>Serializable</code>这个序列化接口，记住实现了<code>Serializable</code>接口的类可以被<code>ObjectOutputStream</code>转换为字节流，同时也可以通过<code>ObjectInputStream</code>再将其解析为对象，这样便于数据的传输。</p>
<p><strong>第四步，创建Controller类。</strong>新建controller包，并在其中新建BookController类，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class BookController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line">    @Autowired</span><br><span class="line">    private StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/test&quot;)</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        ValueOperations&lt;String,String&gt; ops1 = stringRedisTemplate.opsForValue();</span><br><span class="line">        ops1.set(&quot;name&quot;,&quot;红楼梦&quot;);</span><br><span class="line">        String name = ops1.get(&quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        </span><br><span class="line">        ValueOperations ops2 = redisTemplate.opsForValue();</span><br><span class="line">        Book book = new Book();</span><br><span class="line">        book.setId(1);</span><br><span class="line">        book.setName(&quot;西游记&quot;);</span><br><span class="line">        book.setAuthor(&quot;吴承恩&quot;);</span><br><span class="line">        ops2.set(&quot;book&quot;,book);</span><br><span class="line">        Book result = (Book) ops2.get(&quot;book&quot;);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下上述代码的含义：</p>
<ul>
<li><code>StringRedisTemplate</code>是<code>RedisTemplate</code>的子类，<code>StringRedisTemplate</code>中的key和value都是字符串，采用的序列化方案是<code>StringRedisSerializer</code>，而<code>RedisTemplate</code>则可以用来操作对象，<code>RedisTemplate</code>采用的序列化方案是<code>JdkSerializationRedisSerializer</code>。无论是<code>StringRedisTemplate</code>还是<code>RedisTemplate</code>，它们操作Redis的方法都是一致的。</li>
<li><code>StringRedisTemplate</code>和<code>RedisTemplate</code>都是通过<code>opsForValue</code>、<code>opsForZSet</code>或者<code>opsForSet</code>等方法首先获取一个操作对象，再使用该操作对象来完成数据的读写。</li>
<li><code>ops.set()</code>方法用于向Redis中存储一条记录，而<code>ops.get()</code>方法则是将其读取出来。</li>
</ul>
<p><strong>第五步，测试。</strong>运行项目，在浏览器地址栏中输入<code>http://localhost:8080/test</code>，可以看到控制台打印日志信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">红楼梦</span><br><span class="line">Book&#123;id=1, name=&#x27;西游记&#x27;, author=&#x27;吴承恩&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>还可以去Redis数据库中查找相关信息：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-1e8559e563f27a5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>这样就实现了单机版Redis整合SpringBoot的目标。</p>
<h1 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h1><p>前面介绍的都是单个Redis实例整合SpringBoot，在实际项目中，开发者为了提高Redis的扩展性，往往需要搭建Redis集群，这样就会涉及到Redis集群整合SpringBoot，接下来就来学习Redis集群的搭建和SpringBoot如何整合Redis集群。</p>
<h1 id="Redis集群搭建"><a href="#Redis集群搭建" class="headerlink" title="Redis集群搭建"></a>Redis集群搭建</h1><h3 id="1-集群原理"><a href="#1-集群原理" class="headerlink" title="(1)集群原理"></a>(1)集群原理</h3><p>在Redis集群中，所有的Redis节点彼此互联，节点内部使用二进制协议优化传输速度和带宽。当一个节点挂掉后，集群中超过半数的节点检测失效时才认为该节点已失效。不同于Tomcat集群需要使用反向代理服务器，Redis集群中的任意节点都可以直接和Java客户端连接。Redis集群上的数据分配则是采用哈希槽(HASH SLOT)，Redis集群中内置了16384个哈希槽，当有数据需要存储时，Redis会首先使用CRC16算法对key进行计算，将计算获得的结果对16384取余，这样每一个key都会对应一个取值在0~16383之间的哈希槽，Redis则根据这个余数将该条数据存储到对应的Redis节点上，开发者可根据每个Redis实例的性能来调整每个Redis实例上哈希槽的分布范围。</p>
<h3 id="2-集群规划"><a href="#2-集群规划" class="headerlink" title="(2)集群规划"></a>(2)集群规划</h3><p>本案例在同一台服务器上使用不同的端口表示不同的Redis服务器(伪分布式集群)。其中主节点有：47.100.175.12:8001，47.100.175.12:8002，47.100.175.12:8003。从节点有：47.100.175.12:8004，47.100.175.12:8005，47.100.175.12:8006。</p>
<h3 id="3-集群配置"><a href="#3-集群配置" class="headerlink" title="(3)集群配置"></a>(3)集群配置</h3><p>Redis集群管理工具<code>redis-trib.rb</code>依赖Ruby环境，首先需要安装Ruby环境，由于CentOS7 yum库中默认的Ruby版本较低，因此建议采用如下步骤进行安装。</p>
<p>首先安装RVM，RVM是一个命令行工具，可以提供一个便捷的多版本Ruby环境的管理和切换，安装命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3</span><br><span class="line">curl -L get.rvm.io | bash -s stable</span><br><span class="line">source /usr/local/rvm/scripts/rvm</span><br></pre></td></tr></table></figure>
<p>如果在执行过程中出现下面的错误，那是因为某些原因导致GitHub的<code>raw.githubusercontent.com</code>域名被屏蔽了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl: (7) Failed connect to raw.githubusercontent.com:443; Connection refused</span><br></pre></td></tr></table></figure>
<p>正确的做法是首先点击 <a target="_blank" rel="noopener" href="https://www.ipaddress.com/">这里</a>，然后在搜索框内填写<code>raw.githubusercontent.com</code>域名后开始搜索：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-b4d8705293a78299.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-532c1cac046036fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>介绍使用<code>vim /etc/hosts</code>，在里面添加一条DNS解析记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">199.232.68.133  raw.githubusercontent.com</span><br></pre></td></tr></table></figure>
<p>然后再重新执行上述命令即可。<code>source /usr/local/rvm/scripts/rvm</code>命令表示使RVM生效，RVM安装成功后，可以使用下面的命令来查看RVM中有哪些Ruby：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm list known</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-e4d7dbde31f59f73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>选择最新的稳定版本2.7.0进行安装，使用的命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm install 2.7.0</span><br></pre></td></tr></table></figure>
<p>可以使用<code>ruby -v</code>命令来检查Ruby是否安装成功。最后使用如下命令来安装Redis依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install redis</span><br></pre></td></tr></table></figure>
<p>接下来在home目录下创建<code>redisCluster</code>文件夹，然后进入到该文件夹中，使用如下命令下载redis安装包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.10.tar.gz</span><br></pre></td></tr></table></figure>
<p>接着依次执行如下命令安装redis：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-4.0.10.tar.gz</span><br><span class="line">cd redis-4.0.10</span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装成功后，将<code>redis-4.0.10/src</code>目录下的<code>redis-trib.rb</code>文件复制到<code>redisCluster</code>目录下，使用的命令为：（请注意执行此命令时，当前终端处于<code>redisCluster</code>目录下）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r ./redis-4.0.10/src/redis-trib.rb ./</span><br></pre></td></tr></table></figure>
<p>确认一下是否真的复制成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZthsx5glu6ohyZ redisCluster]# ls</span><br><span class="line">redis-4.0.10  redis-4.0.10.tar.gz  redis-trib.rb</span><br></pre></td></tr></table></figure>
<p>接着在<code>redisCluster</code>目录下创建6个文件夹，分别命令为8001、8002、8003、8004、8005、8006，然后将<code>redis-4.0.10</code>目录下的<code>redis.conf</code>文件分别往这个6个目录中复制一份，然后对每个目录中的<code>redis.conf</code>文件进行修改。这里以8001目录中的<code>redis.conf</code>文件为例进行说明，主要修改如下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port 8001</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-8001.conf</span><br><span class="line">protected-mode no</span><br><span class="line">daemonize yes</span><br><span class="line">requirepass 123@456</span><br><span class="line">masterauth 123@456</span><br></pre></td></tr></table></figure>
<p>可以发现这里的配置在前面单机版安装配置的基础上增加了几条。其中端口修改为8001，<code>cluster-enabled yes</code>表示开启集群，<code>cluster-config-file</code>表示集群节点的配置文件，由于每个节点都开启了密码认证，因此又增加了<code>masterauth</code>配置，使得从机可以登录到主机上。按照这里的配置，对8002-8006目录中的<code>redis.conf</code>文件依次进行修改，注意修改时每个文件的port和<code>cluster-config-file</code>都是不一样的。全部修改完成后，进入<code>redis-4.0.10</code>目录下，分别启动6个Redis实例，相应的命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-server ../8001/redis.conf</span><br><span class="line">redis-server ../8002/redis.conf</span><br><span class="line">redis-server ../8003/redis.conf</span><br><span class="line">redis-server ../8004/redis.conf</span><br><span class="line">redis-server ../8005/redis.conf</span><br><span class="line">redis-server ../8006/redis.conf</span><br></pre></td></tr></table></figure>
<p>可以使用<code>ps -ef|grep redis</code>命令检查一下是否都成功启动了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZthsx5glu6ohyZ redis-4.0.10]# ps -ef|grep redis</span><br><span class="line">root     19007     1  0 14:26 ?        00:00:00 redis-server *:8001 [cluster]</span><br><span class="line">root     19022     1  0 14:26 ?        00:00:00 redis-server *:8002 [cluster]</span><br><span class="line">root     19027     1  0 14:27 ?        00:00:00 redis-server *:8003 [cluster]</span><br><span class="line">root     19032     1  0 14:27 ?        00:00:00 redis-server *:8004 [cluster]</span><br><span class="line">root     19037     1  0 14:27 ?        00:00:00 redis-server *:8005 [cluster]</span><br><span class="line">root     19042     1  0 14:27 ?        00:00:00 redis-server *:8006 [cluster]</span><br><span class="line">root     19047  3722  0 14:27 pts/2    00:00:00 grep --color=auto redis</span><br></pre></td></tr></table></figure>
<p>在确认6个Redis实例都启动成功后，回到<code>redisCluster</code>目录下，首先对<code>redis-trib.rb</code>文件进行修改，由于配置了密码登录，而该命令在执行时默认没有密码，因此将等不上各个Redis实例，此时用vi编辑器打开<code>redis-trib.rb</code>文件，搜索<code>Redis.new</code>找到如下一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@r = Redis.new(:host =&gt; @info[:host], :port =&gt; @info[:port], :timeout =&gt; 60)</span><br></pre></td></tr></table></figure>
<p>位置可能就在这里附近：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-d80ec16c12b5d65e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>修改这一行，在末尾添加密码参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@r = Redis.new(:host =&gt; @info[:host], :port =&gt; @info[:port], :timeout =&gt; 60, :password =&gt; &quot;123@456&quot;)</span><br></pre></td></tr></table></figure>
<p>这里设置的”123@456”就是各个Redis实例的登录密码。这些配置都完成后，接下来就可以创建Redis集群了。</p>
<h3 id="4-创建集群"><a href="#4-创建集群" class="headerlink" title="(4)创建集群"></a>(4)创建集群</h3><p>接下来使用如下命令来创建Redis集群（请确保当前终端处于<code>redisCluster</code>目录下）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 47.100.175.12:8001 47.100.175.12:8002 47.100.175.12:8003 47.100.175.12:8004 47.100.175.12:8005 47.100.175.12:8006</span><br></pre></td></tr></table></figure>
<p><strong>特别说明，如果你正在阿里云或者腾讯云服务器创建该集群，那么你不仅需要注释掉<code>bind 127.0.0.1</code>，且上面必须使用<code>127.0.0.1</code>来代替服务器的公网或者内网IP，否则无法创建集群。</strong>此时应使用的命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003 127.0.0.1:8004 127.0.0.1:8005 127.0.0.1:8006</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-b9bc6c25b8bb0b91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-62534640bdea8eac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>  其中，replicas表示每个主节点的slave数量。在集群的创建过程中会分配主机和从机，每个集群在创建过程中都将分配到一个唯一的id并分配到一段slot。</p>
<p>  当集群创建成功后，进入<code>redis-4.0.10</code>目录中，登录任意一个Redis实例，使用的命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 8006 -a 123@456 -c</span><br></pre></td></tr></table></figure>
<p>简单解释一些上述代码中各参数的含义：<code>-p</code>表示要登录的集群的端口，<code>-a</code>表示要登录的集群的密码，<code>-c</code>表示以集群的方式进行登录。登录成功后，通过<code>cluster info</code>命令可以查询集群状态信息：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-353bb45a7124c08c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>还可以通过<code>cluster nodes</code>命令查询集群节点信息。在集群节点信息中，可以看到每一个节点的id，该节点是slave还是master，如果是slave，那么它的master的id是什么；如果是master，那么每一个master的slot范围是多少，这些信息都会被显示出来：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-c22195d797aed4e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h3 id="5-添加主节点"><a href="#5-添加主节点" class="headerlink" title="(5)添加主节点"></a>(5)添加主节点</h3><p>当集群创建成功后，随着业务的增长，有可能需要添加主节点，添加主节点需要先构建主节点实例，将<code>redisCluster</code>目录下的8001目录再复制一份，名为8007，然后根据第三步中集群配置来修改8007目录下的<code>redis.conf</code>文件，修改完成后，在<code>redis-4.0.10</code>目录下运行如下命令来启动该节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server ../8007/redis.conf</span><br></pre></td></tr></table></figure>
<p>启动成功后，进入<code>redisCluster</code>目录下，执行如下命令将该节点添加到集群中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb add-node 47.100.175.12:8007 47.100.175.12:8001</span><br></pre></td></tr></table></figure>
<p><strong>如果是阿里云或者腾讯云服务器创建该集群，则使用的命令为：<code>./redis-trib.rb add-node 127.0.0.1:8007 127.0.0.1:8001</code></strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-cbc92a4279e54178.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>中间的参数是要添加的Redis实例地址，最后的参数是集群中的实例。添加成功后，使用如下命令登录任意一个Redis实例，查看集群节点信息，就可以看到该实例已经被添加进集群了：（确保此时终端处于<code>redis-4.0.10</code>目录中）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 8001 -a 123@456 -c</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-99fb4c421989aa49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>可以看到新实例的确被添加到集群中，但是由于slot已经被之前的三个实例分配完了，因此新添加的实例没有slot，也就意味着新添加的实例没有存储数据的机会，此时需要从另外三个实例中拿出一部分的slot来分配给新实例，具体的操作如下：<br>  首先，在<code>redisCluster</code>目录下执行如下命令对slot重新分配：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb reshard 47.100.175.12:8001</span><br></pre></td></tr></table></figure>
<p><strong>如果是阿里云或者腾讯云服务器创建该集群，则使用的命令为：<code>./redis-trib.rb reshard 127.0.0.1:8001</code></strong><br>上述一行代码中的第二个参数表示连接集群中的任意一个实例。在执行命令的过程中有三个核心配置需要手动配置：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-516ab3d34ac1f96a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>第一个配置是要拿出多少个slot分配给新实例，此处拿出了1000个。第二个配置是把拿出来的1000个slot分配给谁，输入接收这1000个slot的Redis实例的id，这个id在节点添加成功后就能看到，也可以进入集群控制台后使用<code>cluster nodes</code>命令进行查看。第三个配置是这1000个slot由哪个实例出，如从端口为8001的实例中拿出1000个slot分配给端口8007的实例，那么这里就输入8001的id后按回车键，再输入done按回车键即可；如果你想将这1000个slot均摊到原有的所有实例中，那么这里输入all按回车即可。</p>
<p>slot分配成功后，再查看节点信息，就可以看到新实例也有slot了，如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-00fce470e715a277.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h3 id="6-添加从节点"><a href="#6-添加从节点" class="headerlink" title="(6)添加从节点"></a>(6)添加从节点</h3><p>第五步中介绍的是添加主节点，接下来介绍添加从节点，添加从节点相对来说要容易一些。同样添加从节点也需要先构建从节点实例，将<code>redisCluster</code>目录下的8001目录再复制一份，名为8008，然后根据第三步中集群配置来修改8008目录下的<code>redis.conf</code>文件，修改完成后，在<code>redis-4.0.10</code>目录下运行如下命令来启动该节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server ../8008/redis.conf</span><br></pre></td></tr></table></figure>
<p>启动成功后，进入<code>redisCluster</code>目录下，执行如下命令将该节点添加到集群中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb add-node --slave --master-id 3097ef4b2f84f3d29476094e76bee6564020ab56 47.100.175.12:8008 47.100.175.12:8001</span><br></pre></td></tr></table></figure>
<p><strong>如果是阿里云或者腾讯云服务器创建该集群，则使用的命令为：<code>./redis-trib.rb add-node --slave --master-id 3097ef4b2f84f3d29476094e76bee6564020ab56 127.0.0.1:8008 127.0.0.1:8001</code></strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-31a7b712e4993741.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>添加从节点需要指定该从节点的masterid，<code>--master-id</code>后面的参数即表示该从节点master的id，此处以节点7的id为其masterid（节点7也是master节点），而后<code>127.0.0.1:8008</code>表示从节点的地址，<code>127.0.0.1:8001</code>则表示集群中任意一个实例的地址。当从节点添加成后，登录集群中的任意一个Redis实例，通过<code>cluster nodes</code>命令就可以查看到从节点的信息：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-0fe636b9623fcfb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h3 id="7-删除节点"><a href="#7-删除节点" class="headerlink" title="(7)删除节点"></a>(7)删除节点</h3><p>如果删除的是一个从节点，直接运行下面的命令即可删除：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb del-node 47.100.175.12:8001 be68432a3a33aa4bc5329e43c5bbae328d593b69</span><br></pre></td></tr></table></figure>
<p><strong>如果是阿里云或者腾讯云服务器创建该集群，则使用的命令为：<code>./redis-trib.rb del-node 127.0.0.1:8001 be68432a3a33aa4bc5329e43c5bbae328d593b69</code></strong><br>中间的实例地址表示集群中任意一个实例，最后的参数表示要删除的节点的id。但若删除的节点是主节点，它会占有slot，会导致删除失败，此时可以按照前面的步骤，先将要删除主节点的slot全部都分配出去，然后运行如上的命令就可以成功的删除一个占有slot的主节点了。</p>
<h1 id="SpringBoot整合Redis集群"><a href="#SpringBoot整合Redis集群" class="headerlink" title="SpringBoot整合Redis集群"></a>SpringBoot整合Redis集群</h1><p>不同于单机版的Redis整合SpringBoot，Redis集群整合SpringBoot需要开发者手动配置，配置步骤如下：</p>
<p><strong>第一步，创建SpringBoot Web项目并添加依赖。</strong>使用<code>spring Initializr</code>构建工具构建一个SpringBoot的Web应用，名称为<code>redisclusterspringboot</code>，然后在pom.xml文件中添加如下依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--web配置依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--添加jedis依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;!--添加数据库连接池依赖--&gt;</span><br><span class="line">   &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--添加spring-boot-configuration-processor依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>特别注意<code>jedis</code>和<code>spring-data-redis</code>的版本问题，这个很容易出错，建议按照上述版本进行操作。<br><strong>第二步，配置集群信息。</strong>由于集群节点有多个，可以保存在一个集合中，因此这里的配置文件使用YAML格式较为方便，删除resources目录下的<code>application.properties</code>文件，创建<code>application.yml</code>配置文件，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    cluster:</span><br><span class="line">      ports:</span><br><span class="line">        - 8001</span><br><span class="line">        - 8002</span><br><span class="line">        - 8003</span><br><span class="line">        - 8004</span><br><span class="line">        - 8005</span><br><span class="line">        - 8006</span><br><span class="line">        - 8007</span><br><span class="line">        - 8008</span><br><span class="line">      host: 47.100.175.12</span><br><span class="line">      poolConfig:</span><br><span class="line">        max-total: 8</span><br><span class="line">        max-idle: 8</span><br><span class="line">        max-wait-millis: -1</span><br><span class="line">        min-idle: 0</span><br></pre></td></tr></table></figure>
<p>由于本案例是一个伪集群，因此ports代表实际的nodes节点，且这里的Redis实例的host都是一样的，因此这里配置了一个host，而port配置成了一个集合，这些port将被注入到一个集合中。poolConfig则是基本的连接池信息配置，和单机版的基本上没什么大的区别。</p>
<p><strong>第三步，配置Redis。</strong>新建config包，并在包中创建<code>RedisConfig</code>类，用于返回<code>RedisTemplate</code>和<code>StringRedisTemplate</code>对象，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ConfigurationProperties(&quot;spring.redis.cluster&quot;)</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line">    List&lt;Integer&gt; ports;</span><br><span class="line">    String host;</span><br><span class="line">    JedisPoolConfig jedisPoolConfig;</span><br><span class="line">    //getter和setter方法</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    RedisClusterConfiguration redisClusterConfiguration()&#123;</span><br><span class="line">        RedisClusterConfiguration configuration = new RedisClusterConfiguration();</span><br><span class="line">        List&lt;RedisNode&gt; nodes = new ArrayList&lt;&gt;();</span><br><span class="line">        for(Integer port:ports)&#123;</span><br><span class="line">            nodes.add(new RedisNode(host,port));</span><br><span class="line">        &#125;</span><br><span class="line">        configuration.setPassword(RedisPassword.of(&quot;123@456&quot;));</span><br><span class="line">        configuration.setClusterNodes(nodes);</span><br><span class="line">        return configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    JedisConnectionFactory jedisConnectionFactory()&#123;</span><br><span class="line">        JedisConnectionFactory factory = new JedisConnectionFactory(redisClusterConfiguration(),jedisPoolConfig);</span><br><span class="line">        return factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    RedisTemplate redisTemplate()&#123;</span><br><span class="line">        RedisTemplate redisTemplate = new RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(jedisConnectionFactory());</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new JdkSerializationRedisSerializer());</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    StringRedisTemplate stringRedisTemplate()&#123;</span><br><span class="line">        StringRedisTemplate stringRedisTemplate = new StringRedisTemplate(jedisConnectionFactory());</span><br><span class="line">        stringRedisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        stringRedisTemplate.setValueSerializer(new StringRedisSerializer());</span><br><span class="line">        return stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下上述代码的含义：</p>
<ul>
<li>首先使用<code>@Configuration</code>注解表示这是一个配置类，接着使用<code>@ConfigurationProperties(&quot;spring.redis.cluster&quot;)</code>注解来声明配置文件前缀，配置文件中定义的ports数组，host及连接池配置信息都将被注入port，host、poolConfig这三个属性中。</li>
<li>接着定义一个<code>redisClusterConfiguration</code>方法，该方法用于返回一个<code>RedisClusterConfiguration</code>对象，为什么需要定义这个方法呢，那是因为在前面介绍<code>RedisAutoConfiguration</code>类的时候提到过自己定义需要提供<code>StringRedisTemplate</code>和<code>RedisTemplate</code>这两个对象，而这两个对象中均需要传入<code>redisConnectionFactory</code>对象，而这个<code>redisConnectionFactory</code>对象的构造方法红需要传入<code>RedisClusterConfiguration</code>对象，最重要的是这个<code>RedisClusterConfiguration</code>对象实例化需要port，host、poolConfig这三个属性，正好就将配置文件中的信息都给注入进去：</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/8964398-5a15ab9caf977ead.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>所以通过上面的分析就知道为什么需要定义这个方法，而不是直接复制即可。<code>RedisClusterConfiguration</code>对象用于设置Redis登录密码及Redis节点信息。</p>
<ul>
<li>那自然而然<code>jedisConnectionFactory</code>方法是根据前面的<code>RedisClusterConfiguration</code>对象以及连接池配置信息来创建Jedis连接工厂，即<code>JedisConnectionFactory</code>对象。</li>
<li>接着根据<code>JedisConnectionFactory</code>对象来创建<code>RedisTemplate</code>和<code>StringRedisTemplate</code>，请注意需要在对应的template中配置key和value的序列化方式，前面也说过字符串的序列化采用<code>StringRedisSerializer</code>，而对象的序列化采用的是<code>JdkSerializationRedisSerializer</code>，这一点需要明白。有了<code>RedisTemplate</code>和<code>StringRedisTemplate</code>对象，接下来的使用就和单实例的用法完全一致了。</li>
</ul>
<p><strong>第四步，创建实体类</strong>。新建pojo包，并在其中新建Book类，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Book implements Serializable &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String author;</span><br><span class="line">    //getter、setter和toString方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意必须让这个实体类实现<code>Serializable</code>这个序列化接口，记住实现了<code>Serializable</code>接口的类可以被<code>ObjectOutputStream</code>转换为字节流，同时也可以通过<code>ObjectInputStream</code>再将其解析为对象，这样便于数据的传输。</p>
<p><strong>第五步，创建Controller类。</strong>新建controller包，并在其中新建BookController类，里面的代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class BookController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line">    @Autowired</span><br><span class="line">    private StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/test&quot;)</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        ValueOperations&lt;String,String&gt; ops1 = stringRedisTemplate.opsForValue();</span><br><span class="line">        ops1.set(&quot;name&quot;,&quot;红楼梦&quot;);</span><br><span class="line">        String name = ops1.get(&quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        </span><br><span class="line">        ValueOperations ops2 = redisTemplate.opsForValue();</span><br><span class="line">        Book book = new Book();</span><br><span class="line">        book.setId(1);</span><br><span class="line">        book.setName(&quot;西游记&quot;);</span><br><span class="line">        book.setAuthor(&quot;吴承恩&quot;);</span><br><span class="line">        ops2.set(&quot;book&quot;,book);</span><br><span class="line">        Book result = (Book) ops2.get(&quot;book&quot;);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下上述代码的含义：</p>
<ul>
<li><code>StringRedisTemplate</code>是<code>RedisTemplate</code>的子类，<code>StringRedisTemplate</code>中的key和value都是字符串，采用的序列化方案是<code>StringRedisSerializer</code>，而<code>RedisTemplate</code>则可以用来操作对象，<code>RedisTemplate</code>采用的序列化方案是<code>JdkSerializationRedisSerializer</code>。无论是<code>StringRedisTemplate</code>还是<code>RedisTemplate</code>，它们操作Redis的方法都是一致的。</li>
<li><code>StringRedisTemplate</code>和<code>RedisTemplate</code>都是通过<code>opsForValue</code>、<code>opsForZSet</code>或者<code>opsForSet</code>等方法首先获取一个操作对象，再使用该操作对象来完成数据的读写。</li>
<li><code>ops.set()</code>方法用于向Redis中存储一条记录，而<code>ops.get()</code>方法则是将其读取出来。</li>
</ul>
<p><strong>第六步，测试。</strong>运行项目，在浏览器地址栏中输入<code>http://localhost:8080/test</code>，可以看到控制台打印日志信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">红楼梦</span><br><span class="line">Book&#123;id=1, name=&#x27;西游记&#x27;, author=&#x27;吴承恩&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>开发者此时可以登录任意一个Redis实例，查询数据，请注意查询时只需要登录任意一个Redis实例即可，<code>RedisCluster</code>会负责将查询请求Redirect到相应的实例上去。</p>
<p>这样就实现了Redis集群整合SpringBoot的目标。当然不仅仅可以使用<code>jedis</code>和<code>spring-data-redis</code>组合形式，其实还可以直接使用<code>spring-boot-starter-data-redis</code>依赖来完成Redis操作。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://envyzhan.asia">余思</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://envyzhan.asia/2019/08/22/springboot-9-makeup-no-sql-redis/">http://envyzhan.asia/2019/08/22/springboot-9-makeup-no-sql-redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://envyzhan.asia" target="_blank">余思博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/08/25/springboot-10-makeup-no-sql-mongodb-and-session-shared/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">整合NoSQL---MongoDB及Session共享</div></div></a></div><div class="next-post pull-right"><a href="/2019/08/19/springboot-8-configure-many-datasources/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">配置多数据源</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/26/12-springboot-realizes-the-repeated-reading-of-json-data/" title="SpringBoot实现JSON数据重复读取"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-26</div><div class="title">SpringBoot实现JSON数据重复读取</div></div></a></div><div><a href="/2022/05/26/11-springboot-implements-timed-tasks/" title="SpringBoot实现定时任务"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-26</div><div class="title">SpringBoot实现定时任务</div></div></a></div><div><a href="/2022/08/02/15-springboot-integrates-canal-to-realize-data-incremental-synchronization/" title="SpringBoot整合Canal实现数据增量同步"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-02</div><div class="title">SpringBoot整合Canal实现数据增量同步</div></div></a></div><div><a href="/2022/03/20/4-dynamic-switching-of-visual-multiple-data-sources/" title="可视化多数据源动态切换"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-20</div><div class="title">可视化多数据源动态切换</div></div></a></div><div><a href="/2022/03/24/5-an-annotation-cooperates-with-redis-to-realize-interface-current-limition/" title="一个注解配合Redis实现接口限流"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-24</div><div class="title">一个注解配合Redis实现接口限流</div></div></a></div><div><a href="/2019/09/25/springboot-21-project-build-and-development/" title="项目构建与部署"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-25</div><div class="title">项目构建与部署</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">余思</div><div class="author-info__description">记录成长路上的点滴</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">235</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:envyzhan@aliyun.com" target="_blank" title=""><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问啃饼思录！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">非关系型数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E7%9B%B8%E5%85%B3%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">Redis相关介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E7%AE%80%E4%BB%8B"><span class="toc-number">2.0.1.</span> <span class="toc-text">Redis简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%AE%89%E8%A3%85"><span class="toc-number">2.0.2.</span> <span class="toc-text">Redis安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E6%95%B4%E5%90%88Redis%E5%8D%95%E6%9C%BA%E7%89%88"><span class="toc-number">3.</span> <span class="toc-text">SpringBoot整合Redis单机版</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">4.</span> <span class="toc-text">Redis集群</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">5.</span> <span class="toc-text">Redis集群搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86"><span class="toc-number">5.0.1.</span> <span class="toc-text">(1)集群原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92"><span class="toc-number">5.0.2.</span> <span class="toc-text">(2)集群规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">5.0.3.</span> <span class="toc-text">(3)集群配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">5.0.4.</span> <span class="toc-text">(4)创建集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B7%BB%E5%8A%A0%E4%B8%BB%E8%8A%82%E7%82%B9"><span class="toc-number">5.0.5.</span> <span class="toc-text">(5)添加主节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B7%BB%E5%8A%A0%E4%BB%8E%E8%8A%82%E7%82%B9"><span class="toc-number">5.0.6.</span> <span class="toc-text">(6)添加从节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="toc-number">5.0.7.</span> <span class="toc-text">(7)删除节点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E6%95%B4%E5%90%88Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">6.</span> <span class="toc-text">SpringBoot整合Redis集群</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/08/02/15-springboot-integrates-canal-to-realize-data-incremental-synchronization/" title="SpringBoot整合Canal实现数据增量同步"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot整合Canal实现数据增量同步"/></a><div class="content"><a class="title" href="/2022/08/02/15-springboot-integrates-canal-to-realize-data-incremental-synchronization/" title="SpringBoot整合Canal实现数据增量同步">SpringBoot整合Canal实现数据增量同步</a><time datetime="2022-08-02T09:55:30.000Z" title="发表于 2022-08-02 17:55:30">2022-08-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/08/2022-k8s-5-deploy-microservices-on-a-complete-cluster/" title="在完整Kubernetes集群上部署微服务"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在完整Kubernetes集群上部署微服务"/></a><div class="content"><a class="title" href="/2022/07/08/2022-k8s-5-deploy-microservices-on-a-complete-cluster/" title="在完整Kubernetes集群上部署微服务">在完整Kubernetes集群上部署微服务</a><time datetime="2022-07-08T09:55:30.000Z" title="发表于 2022-07-08 17:55:30">2022-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/06/2022-k8s-4-complete-cluster-construction/" title="Kubernetes完整集群搭建"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes完整集群搭建"/></a><div class="content"><a class="title" href="/2022/07/06/2022-k8s-4-complete-cluster-construction/" title="Kubernetes完整集群搭建">Kubernetes完整集群搭建</a><time datetime="2022-07-06T09:55:30.000Z" title="发表于 2022-07-06 17:55:30">2022-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/04/2022-k8s-3-simple-environemnt-use/" title="Kubernetes简易环境使用"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes简易环境使用"/></a><div class="content"><a class="title" href="/2022/07/04/2022-k8s-3-simple-environemnt-use/" title="Kubernetes简易环境使用">Kubernetes简易环境使用</a><time datetime="2022-07-04T09:55:30.000Z" title="发表于 2022-07-04 17:55:30">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/28/2022-k8s-2-simple-environment-construction/" title="Kubernetes基础知识"><img src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes基础知识"/></a><div class="content"><a class="title" href="/2022/06/28/2022-k8s-2-simple-environment-construction/" title="Kubernetes基础知识">Kubernetes基础知识</a><time datetime="2022-06-28T09:55:30.000Z" title="发表于 2022-06-28 17:55:30">2022-06-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2022  余思博客,记录成长</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '9996b44b488f2fc52124',
      clientSecret: '6bec0f8e9c032eeae6211a5d4cffa3c97e2d4a64',
      repo: 'blogcomment',
      owner: 'Envythink',
      admin: ['Envythink'],
      id: 'b2f05f91802c95c1468fa6b217aff7ee',
      updateCountCallback: commentCount
    },))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div></div></body></html>