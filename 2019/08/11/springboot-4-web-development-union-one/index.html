<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>SpringBoot Web开发整合（上） | 余思博客</title><meta name="description" content="SpringBoot Web开发整合（上）"><meta name="keywords" content="springboot"><meta name="author" content="余思"><meta name="copyright" content="余思"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SpringBoot Web开发整合（上）"><meta name="twitter:description" content="SpringBoot Web开发整合（上）"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot Web开发整合（上）"><meta property="og:url" content="http://envyzhan.top/2019/08/11/springboot-4-web-development-union-one/"><meta property="og:site_name" content="余思博客"><meta property="og:description" content="SpringBoot Web开发整合（上）"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://envyzhan.top/2019/08/11/springboot-4-web-development-union-one/"><link rel="prev" title="SpringBoot Web开发整合（中）" href="http://envyzhan.top/2019/08/13/springboot-5-web-development-union-two/"><link rel="next" title="视图层技术整合" href="http://envyzhan.top/2019/08/09/springboot-3-view-layer-union/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://envythink.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: 余思","link":"链接: http://envyzhan.top/2019/08/11/springboot-4-web-development-union-one/","source":"来源: 余思博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">余思博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-html5" aria-hidden="true"></i><span> 前端</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> Java</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 运维</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 中间件</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page" href="/categories/nginx/"><i class="fa-fw fa fa-location-arrow"></i><span> Nginx</span></a></li><li><a class="site-page" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bell" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/categories/algorithm/"><i class="fa-fw fa fa-plane"></i><span> 算法建模</span></a></li><li><a class="site-page" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-address-book" aria-hidden="true"></i><span> 生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">213</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-html5" aria-hidden="true"></i><span> 前端</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/html/"><i class="fa-fw fa fa-cog"></i><span> HTML/CSS</span></a></li><li><a class="site-page" href="/categories/javascript/"><i class="fa-fw fa fa-cogs"></i><span> JavaScript</span></a></li><li><a class="site-page" href="/categories/vuejs/"><i class="fa-fw fa fa-certificate"></i><span> Vue.js</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> Java</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/java/"><i class="fa-fw fa fa-book"></i><span> Java</span></a></li><li><a class="site-page" href="/categories/ssm/"><i class="fa-fw fa fa-cube"></i><span> SSM</span></a></li><li><a class="site-page" href="/categories/springboot/"><i class="fa-fw fa fa-cubes"></i><span> SpringBoot</span></a></li><li><a class="site-page" href="/categories/springcloud/"><i class="fa-fw fa fa-cloud"></i><span> SpringCloud</span></a></li><li><a class="site-page" href="/categories/springsecurity/"><i class="fa-fw fa fa-bullseye"></i><span> SpringSecurity</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 运维</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/pythonbase/"><i class="fa-fw fa fa-book"></i><span> Python</span></a></li><li><a class="site-page" href="/categories/go/"><i class="fa-fw fa fa-google-plus"></i><span> Golang</span></a></li><li><a class="site-page" href="/categories/devops/"><i class="fa-fw fa fa-road"></i><span> DevOps</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 中间件</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/mysql/"><i class="fa-fw fa fa-database"></i><span> MySQL</span></a></li><li><a class="site-page" href="/categories/nginx/"><i class="fa-fw fa fa-location-arrow"></i><span> Nginx</span></a></li><li><a class="site-page" href="/categories/redis/"><i class="fa-fw fa fa-random"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-bell" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/datastructs/"><i class="fa-fw fa fa-plug"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/categories/algorithm/"><i class="fa-fw fa fa-plane"></i><span> 算法建模</span></a></li><li><a class="site-page" href="/categories/tools/"><i class="fa-fw fa fa-hourglass"></i><span> 实用工具</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-address-book" aria-hidden="true"></i><span> 生活</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/onenote/"><i class="fa-fw fa fa-laptop"></i><span> 个人随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#返回JSON数据"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">返回JSON数据</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#默认实现"><span class="toc_mobile_items-number">1.0.1.</span> <span class="toc_mobile_items-text">默认实现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#自定义转换器"><span class="toc_mobile_items-number">1.0.2.</span> <span class="toc_mobile_items-text">自定义转换器</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#静态文件上传"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">静态文件上传</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#默认策略"><span class="toc_mobile_items-number">2.0.1.</span> <span class="toc_mobile_items-text">默认策略</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#自定义策略"><span class="toc_mobile_items-number">2.0.2.</span> <span class="toc_mobile_items-text">自定义策略</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#文件上传"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">文件上传</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#单文件上传"><span class="toc_mobile_items-number">3.0.1.</span> <span class="toc_mobile_items-text">单文件上传</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#多文件上传"><span class="toc_mobile_items-number">3.0.2.</span> <span class="toc_mobile_items-text">多文件上传</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#ControllerAdvice"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">@ControllerAdvice</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#全局异常处理"><span class="toc_mobile_items-number">4.0.1.</span> <span class="toc_mobile_items-text">全局异常处理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#添加全局数据"><span class="toc_mobile_items-number">4.0.2.</span> <span class="toc_mobile_items-text">添加全局数据</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#请求参数预处理"><span class="toc_mobile_items-number">4.0.3.</span> <span class="toc_mobile_items-text">请求参数预处理</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#返回JSON数据"><span class="toc-number">1.</span> <span class="toc-text">返回JSON数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认实现"><span class="toc-number">1.0.1.</span> <span class="toc-text">默认实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义转换器"><span class="toc-number">1.0.2.</span> <span class="toc-text">自定义转换器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#静态文件上传"><span class="toc-number">2.</span> <span class="toc-text">静态文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认策略"><span class="toc-number">2.0.1.</span> <span class="toc-text">默认策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义策略"><span class="toc-number">2.0.2.</span> <span class="toc-text">自定义策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文件上传"><span class="toc-number">3.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单文件上传"><span class="toc-number">3.0.1.</span> <span class="toc-text">单文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多文件上传"><span class="toc-number">3.0.2.</span> <span class="toc-text">多文件上传</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ControllerAdvice"><span class="toc-number">4.</span> <span class="toc-text">@ControllerAdvice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#全局异常处理"><span class="toc-number">4.0.1.</span> <span class="toc-text">全局异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加全局数据"><span class="toc-number">4.0.2.</span> <span class="toc-text">添加全局数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求参数预处理"><span class="toc-number">4.0.3.</span> <span class="toc-text">请求参数预处理</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">SpringBoot Web开发整合（上）</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-08-11</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/springboot/">springboot</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.8k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 10 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2019/08/11/springboot-4-web-development-union-one/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html lang="en" xmlns="http://www.thymeleaf.org"><head></head><body><p>本篇来学习SpringBoot如何整合Web开发，由于其中涉及的内容非常多，因此分为三篇来进行记录。所谓的SpringBoot如何整合Web开发，其实就是对前面的一些具体细节的补充。本篇学习的内容具体包括：返回JSON数据、静态资源访问、文件上传和<code>@ControllerAdvice</code>等相关知识。</p>
<h1 id="返回JSON数据"><a href="#返回JSON数据" class="headerlink" title="返回JSON数据"></a>返回JSON数据</h1><h3 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h3><p>JSON是目前主流的前后端数据传输方式，SpringMVC中使用消息转换器<code>HttpMessageConverter</code>对JSON的转换提供了很好的支持，在SpringBoot中这种支持更进一步得到了提升，也对相关的配置做了进一步的简化。在默认情况下，当开发人员新创建一个SpringBoot项目后，添加Web依赖，也就是web启动器：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><dependency></dependency></span><br><span class="line">       <groupid>org.springframework.boot</groupid></span><br><span class="line">       <artifactid>spring-boot-starter-web</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>这个依赖中默认添加了<code>jackson-databind</code>作为JSON处理器，此时不需要添加额外的JSON处理器就能返回一段JSON。</p>
<p>使用<code>spring Initializr</code>构建工具构建一个SpringBoot的Web应用，名称为<code>webspringboot</code>，然后添加<code>spring-boot-starter-web</code>依赖，也就是上面的代码。在<code>com.envy.webspringboot</code>包内新建一个pojo包，接着在里面新建Book实体类，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.pojo;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class Book {</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @JsonIgnore</span><br><span class="line">    private Integer price;</span><br><span class="line">    @JsonFormat(pattern="yyyy-MM-dd")</span><br><span class="line">    private Date publishDate;</span><br><span class="line"></span><br><span class="line">    //getter和setter方法，包含三个参数的构造方法</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>在上面使用了<code>@JsonIgnore</code>和 <code>@JsonFormat</code>注解。当你不希望某个字段被序列化为JSON字符串时就可以在该字段上使用<code>@JsonIgnore</code>注解；当你需要对某个字段的输出格式进行自定义的时候就可以使用<code>@JsonFormat</code>注解，同时里面传入一个pattern对象作为序列化时的标准样式。</p>
<p>接着在<code>com.envy.webspringboot</code>包内新建一个controller包，然后在里面新建BookController实体类用于序列化字符串，其实就是将前面的对象转换为JSON对象，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.controller;</span><br><span class="line"></span><br><span class="line">import com.envy.webspringboot.pojo.Book;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class BookController {</span><br><span class="line"></span><br><span class="line">    @GetMapping("/book")</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public Book book(){</span><br><span class="line">        Book book = new Book(1,"西游记",128,new Date());</span><br><span class="line">        return book;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>当然如果你需要频繁的使用<code>@ResponseBody</code>注解，那么可以使用<code>@RestController</code>这个组合注解来替换<code>@Controller</code>和<code>@ResponseBody</code>注解。此时代码就变成了：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.controller;</span><br><span class="line"></span><br><span class="line">import com.envy.webspringboot.pojo.Book;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class BookController {</span><br><span class="line"></span><br><span class="line">    @GetMapping("/book")</span><br><span class="line">    public Book book(){</span><br><span class="line">        Book book = new Book(1,"西游记",128,new Date());</span><br><span class="line">        return book;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>运行项目，在浏览器地址栏中输入<code>http://localhost:8080/book</code>，即可看到返回了JSON数据：（使用了JSON Viewer插件后的显示结果，价格不会显示）</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-f495d959d1457768.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-f495d959d1457768.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>这是SpringBoot自带的处理方式。如果采用这种方式，那么对于字段忽略、日期格式化等常见需求都是可以通过注解来实现的。其实这都是Spring中默认提供的<code>MappingJackson2HttpMessageConverter</code>来实现的，因此你可以根据自己的实际需求来自定义JSON转换器。</p>
<h3 id="自定义转换器"><a href="#自定义转换器" class="headerlink" title="自定义转换器"></a>自定义转换器</h3><p>常见的JSON处理器除了<code>jackson-dababind</code>之外，还有GSON和fastjson，这里针对常见的用法分别来进行举例说明。</p>
<p><strong>（1）使用Gson</strong>。Gson是Google开源的一个JSON解析框架，如果你想使用Gson，需要先除去默认的<code>jackson-databind</code>，然后加入Gson依赖，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><!--使用GSON需要先移除默认的jackson-databind--></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line">    <artifactid>spring-boot-starter-web</artifactid></span><br><span class="line">    <exclusions></exclusions></span><br><span class="line">        <exclusion></exclusion></span><br><span class="line">            <groupid>com.fasterxml.jackson.core</groupid></span><br><span class="line">            <artifactid>jackson-databind</artifactid></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.google.code.gson</groupid></span><br><span class="line">    <artifactid>gson</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>由于SpringBoot中默认提供了Gson的自动转换类<code>GsonHttpMessageConverter</code>，因此Gson的依赖添加成功后，可以像使用<code>jackson-databind</code>那样直接使用Gson。但是在Gson进行转换时，如果想对日期数据进行格式化，那么还需要开发者自定义<code>HttpMessageConverter</code>。</p>
<p>你可以通过如下方式来自定义<code>HttpMessageConverter</code>。首先需要阅读<code>GsonHttpMessageConverter</code>中的一段源码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public GsonHttpMessageConverter(Gson gson) {</span><br><span class="line">        Assert.notNull(gson, "A Gson instance is required");</span><br><span class="line">        this.gson = gson;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p>注意此处Gson的版本为2.8.6，使用了断言来保证必须传入Gson对象。它允许用户可以不提供一个<code>GsonHttpMessageConverter</code>对象，如果用户没有提供时，SpringBoot会默认提供一个<code>GsonHttpMessageConverter</code>对象。</p>
<p>在<code>com.envy.webspringboot</code>包内新建一个config包，接着在里面新建GsonConfig类用于返回一个<code>GsonHttpMessageConverter</code>对象，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.config;</span><br><span class="line"></span><br><span class="line">import com.google.gson.Gson;</span><br><span class="line">import com.google.gson.GsonBuilder;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.http.converter.json.GsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Modifier;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class GsonConfig {</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    GsonHttpMessageConverter gsonHttpMessageConverter(){</span><br><span class="line">        GsonHttpMessageConverter converter = new GsonHttpMessageConverter();</span><br><span class="line">        GsonBuilder builder = new GsonBuilder();</span><br><span class="line">        builder.setDateFormat("yyyy-MM-dd");</span><br><span class="line">        builder.excludeFieldsWithModifiers(Modifier.PROTECTED);</span><br><span class="line"></span><br><span class="line">        Gson gson =builder.create();</span><br><span class="line">        converter.setGson(gson);</span><br><span class="line">        return converter;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>接下来介绍一下上述代码的含义，开发人员首先需要定义一个方法用于提供一个<code>GsonHttpMessageConverter</code>的实例。然后设置Gson的解析日期时的解析规则，接着设置Gson解析时，修饰符为protected的字段被过滤掉。（这里的过滤方式和<code>jackson-databind</code>不一样，需要特别注意。），最后就是创建Gson对象，并将其放入到<code>GsonHttpMessageConverter</code>的实例中并返回converter对象即可。</p>
<p>前面说了Gson解析时被过滤的字段前面是通过使用protected修饰符来修饰的，因此可以新建一个GsonBook类，这里仅仅是将原来Book类中的price字段前面的修饰符修改为protected，相应的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class GsonBook {</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    /**通过设置protected标识符来进行字段的过滤**/</span><br><span class="line">    protected Integer price;</span><br><span class="line">    private Date publishDate;</span><br><span class="line">    //getter和setter方法，包含三个参数的构造方法</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>既然这样，那可以在BookController中新建一个gsonBook方法，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping("/gsonbook")</span><br><span class="line">public GsonBook gsonBook(){</span><br><span class="line">    GsonBook gsonBook = new GsonBook(2,"红楼梦",168,new Date());</span><br><span class="line">    return gsonBook;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>运行项目，在浏览器地址栏中输入<code>http://localhost:8080/gsonbook</code>，即可看到返回了JSON数据：（价格被过滤了，依旧不会显示）</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-4e5aca8fb6c44575.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-4e5aca8fb6c44575.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<hr>
<p><strong>（2）使用fastjson</strong>。fastjson是阿里巴巴开源的一个JSON解析框架，是目前JSON解析速度最快的开源框架，该框架也可以集成到SpringBoot中。不同于Gson的地方在于，fastjson集成完后不能立即使用，需要提供一个<code>HttpMessageConverter</code>后才能使用。</p>
<p>同样如果你想使用fastjson，需要先除去默认的<code>jackson-databind</code>，然后加入fastjson依赖，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><!--使用fastjson需要先移除默认的jackson-databind--></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line">    <artifactid>spring-boot-starter-web</artifactid></span><br><span class="line">    <exclusions></exclusions></span><br><span class="line">        <exclusion></exclusion></span><br><span class="line">            <groupid>com.fasterxml.jackson.core</groupid></span><br><span class="line">            <artifactid>jackson-databind</artifactid></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.alibaba</groupid></span><br><span class="line">    <artifactid>fastjson</artifactid></span><br><span class="line">     <version>1.2.47</version></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>接着在config包内新建<code>MyFastJsonConfig</code>类（不能定义为<code>FastJsonConfig</code>类，因为这个就是它内置的配置类）用于返回一个<code>FastJsonHttpMessageConverter</code>对象，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.config;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line">import com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line">import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class MyFastJsonConfig {</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    FastJsonHttpMessageConverter fastJsonHttpMessageConverter(){</span><br><span class="line">        FastJsonHttpMessageConverter converter = new FastJsonHttpMessageConverter();</span><br><span class="line">        FastJsonConfig config = new FastJsonConfig();</span><br><span class="line">        config.setDateFormat("yyyy-MM-dd");</span><br><span class="line">        config.setCharset(Charset.forName("UTF-8"));</span><br><span class="line">        config.setSerializerFeatures(</span><br><span class="line">                SerializerFeature.WriteClassName,</span><br><span class="line">                SerializerFeature.WriteMapNullValue,</span><br><span class="line">                SerializerFeature.PrettyFormat,</span><br><span class="line">                SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">                SerializerFeature.WriteNullStringAsEmpty</span><br><span class="line">        );</span><br><span class="line">        converter.setFastJsonConfig(config);</span><br><span class="line">        return converter;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>首先你需要自定义一个MyFastJsonConfig类，用于返回一个<code>FastJsonHttpMessageConverter</code>实例。接着实例化一个<code>FastJsonConfig</code>对象，并在里面设置fastjson解析JOSN的一些细节，如日期格式、数据编码、是否在生成的JSON中输出类名、是否输出value为null的数据、生成的JSON格式化、空集合输出[]而非null、空字符串输出””，而不是null等基本配置。</p>
<p>请注意MyFastJsonConfig类配置完后，还需要配置一下响应的编码，否则返回的JSON中文会乱码，你只需要在<code>application.properties</code>配置文件中添加如下配置：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.http.encoding.force-response=true</span><br></pre></td></tr></tbody></table></figure></div>
<p>pojo对象可以继续使用前面的GsonBook，自然controller包内的gsonBook方法也是可以使用的。运行一下项目，在浏览器地址栏中输入<code>http://localhost:8080/gsonbook</code>，即可看到返回了JSON数据：（价格没有被过滤，因此会被显示）</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-9a226fd7d64a8e21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-9a226fd7d64a8e21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>对于<code>FastJsonHttpMessageConverter</code>的配置，除了上述这种方式外，还有一种方式。在SpringBoot项目中，当开发者引入<code>spring-boot-starter-web</code>依赖后，该依赖又依赖了<code>spring-boot-autoconfigure</code>，在这个自动化配置中，有一个<code>WebMvcAutoConfiguration</code>类提供了对SpringMVC最基本的配置，如果某一项自动化配置不满足开发需求，开发者可以针对该项来自定义配置，此时只需要实现<code>WebMvcConfigurer</code>接口即可（在Spring5.0之前是通过继承<code>WebMvcConfigurerAdapter</code>类来实现的），相关代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.config;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line">import com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line">import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class MyWebMvcConfig implements WebMvcConfigurer {</span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageConverters(List<httpmessageconverter<?>> converters) {</httpmessageconverter<?></span><br><span class="line">        FastJsonHttpMessageConverter converter = new FastJsonHttpMessageConverter();</span><br><span class="line">        FastJsonConfig config = new FastJsonConfig();</span><br><span class="line">        config.setDateFormat("yyyy-MM-dd");</span><br><span class="line">        config.setCharset(Charset.forName("UTF-8"));</span><br><span class="line">        config.setSerializerFeatures(</span><br><span class="line">                SerializerFeature.WriteClassName,</span><br><span class="line">                SerializerFeature.WriteMapNullValue,</span><br><span class="line">                SerializerFeature.PrettyFormat,</span><br><span class="line">                SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">                SerializerFeature.WriteNullStringAsEmpty</span><br><span class="line">        );</span><br><span class="line">        converter.setFastJsonConfig(config);</span><br><span class="line">        converters.add(converter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>这里自定义的<code>MyWebMvcConfig</code>类实现了<code>WebMvcConfigurer</code>接口中的<code>configureMessageConverters</code>方法，然后将自定义的<code>FastJsonHttpMessageConverter</code>对象加入到converters中。</p>
<p><strong>当然如果你使用了Gson，也是可以采用上面这种方式，但是并不推荐这么做。因为当项目中没有<code>GsonHttpMessageConverter</code>时，SpringBoot会默认提供一个<code>GsonHttpMessageConverter</code>，此时你如果重写<code>configureMessageConverters</code>方法，而参数converters中已经有<code>GsonHttpMessageConverter</code>的实例了，需要替换已有的<code>GsonHttpMessageConverter</code>实例，操作比较麻烦，所以对于Gson，推荐直接提供<code>GsonHttpMessageConverter</code>这种方式。</strong></p>
<p><strong>（3）使用hutool</strong>。<a href="https://hutool.cn/docs/#/" target="_blank" rel="noopener">Hutool</a>是一个小而全的Java工具类库，通过静态方法封装，用于降低相关API的学习成本，提高工作效率，使Java拥有函数式语言般的优雅。该框架也可以集成到SpringBoot中。同样，hutool集成完后不能立即使用，需要提供一个<code>HttpMessageConverter</code>后才能使用。</p>
<p>同样如果你想使用hutool，需要先除去默认的<code>jackson-databind</code>，然后加入hutool依赖，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><!--使用hutool需要先移除默认的jackson-databind--></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line">    <artifactid>spring-boot-starter-web</artifactid></span><br><span class="line">    <exclusions></exclusions></span><br><span class="line">        <exclusion></exclusion></span><br><span class="line">            <groupid>com.fasterxml.jackson.core</groupid></span><br><span class="line">            <artifactid>jackson-databind</artifactid></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>cn.hutool</groupid></span><br><span class="line">    <artifactid>hutool-all</artifactid></span><br><span class="line">    <version>5.3.3</version></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>请注意使用hutool是不需要配置<code>HttpMessageConverter</code>，因为它内部已经实现了，因此最后可以直接返回String对象。在pojo包内新建一个<code>HutoolBook</code>类，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class HutoolBook {</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer price;</span><br><span class="line">    private Date publishDate;</span><br><span class="line">    //getter和setter方法，包含所有参数的构造方法</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>接着在BookController中新建一个hutoolBook方法，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping("/hutoolbook")</span><br><span class="line">public String hutoolBook(){</span><br><span class="line">    HutoolBook hutoolBook = new HutoolBook(3,"三国演义",null,new Date());</span><br><span class="line">    //第二2个true表示跳过空值, 第三个参数表示保持有序</span><br><span class="line">    JSONObject jsonObject = JSONUtil.parseObj(hutoolBook,true,true);</span><br><span class="line">    return jsonObject.toStringPretty();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>运行项目，在浏览器地址栏中输入<code>http://localhost:8080/hutoolbook</code>，即可看到返回了JSON数据：（价格被过滤了，因为你这里设置了跳过空值，所以值为null的属性都不会显示）</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-e1f5bdf2f4104462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-e1f5bdf2f4104462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>Hutool默认将日期输出为时间戳，如果需要自定义日期格式，可以修改上述代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping("/hutoolbook")</span><br><span class="line">public String hutoolBook(){</span><br><span class="line">    HutoolBook hutoolBook = new HutoolBook(3,"三国演义",null,new Date());</span><br><span class="line">    //第二2个true表示跳过空值, 第三个参数表示保持有序</span><br><span class="line">    JSONObject jsonObject = JSONUtil.parseObj(hutoolBook,true,true);</span><br><span class="line">    jsonObject.setDateFormat("yyyy-MM-dd");</span><br><span class="line">    return jsonObject.toStringPretty();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-414caf62da069ff4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-414caf62da069ff4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>同样，JSONUtil还可以支持以下对象转为JSONObject对象：String对象、Java Bean对象、Map对象、XML字符串（使用JSONUtil.parseFromXml方法）、ResourceBundle(使用JSONUtil.parseFromResourceBundle)等，所以优先建议大家使用hutool，这个工具配置和使用非常简单。</p>
<h1 id="静态文件上传"><a href="#静态文件上传" class="headerlink" title="静态文件上传"></a>静态文件上传</h1><p>在SpringMVC中，对于静态资源都需要开发者手动配置静态资源过滤。SpringBoot中对此提供了自动化配置，可以简化静态资源过滤配置。</p>
<h3 id="默认策略"><a href="#默认策略" class="headerlink" title="默认策略"></a>默认策略</h3><p>前面介绍过SpringBoot对于SpringMVC的自动化配置都是在<code>WebMvcAutoConfiguration</code>类中，因此默认的静态资源过滤策略可以从这个类中一探究竟。</p>
<p>在<code>WebMvcAutoConfiguration</code>类中有一个静态内部类<code>WebMvcAutoConfigurationAdapter</code>，同样它也实现了前面提到的<code>WebMvcConfigurer</code>接口。而<code>WebMvcConfigurer</code>接口中有一个<code>addResourceHandlers</code>方法，该方法用于配置静态资源过滤。这个<code>addResourceHandlers</code>方法在<code>WebMvcAutoConfigurationAdapter</code>类中得到了实现，里面有一段比较核心的代码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br><span class="line">                //其他代码</span><br><span class="line"></span><br><span class="line">                String staticPathPattern = this.mvcProperties.getStaticPathPattern();</span><br><span class="line">                if (!registry.hasMappingForPattern(staticPathPattern)) {</span><br><span class="line">                    this.customizeResourceHandlerRegistration(registry.addResourceHandler(new String[]{staticPathPattern})</span><br><span class="line">.addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(this.resourceProperties</span><br><span class="line">.getStaticLocations())).setCachePeriod(this.getSeconds(cachePeriod))</span><br><span class="line">.setCacheControl(cacheControl));</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure></div>
<p>SpringBoot在这里进行了默认的静态资源过滤配置，其中<code>staticPathPattern</code>默认定义在<code>WebMvcProperties</code>中（通过无参的构造方法来进行设置），定义的内容如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public WebMvcProperties() {</span><br><span class="line">        ......</span><br><span class="line">        this.staticPathPattern = "/**";</span><br><span class="line">        ......</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p>回到<code>addResourceHandlers</code>方法中，看下面这行代码：<code>this.resourceProperties.getStaticLocations();</code>，它获取到的默认静态资源位置定义在<code>ResourceProperties</code>类中，相应的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final String[] CLASSPATH_RESOURCE_LOCATIONS = new String[]{"classpath:/META-INF/resources/", "classpath:/resources/", "classpath:/static/", "classpath:/public/"};</span><br></pre></td></tr></tbody></table></figure></div>
<p>看到没有，这里一共有4个方法，但是这个<code>WebMvcAutoConfiguration.getResourceLocations()</code>方法又对这4个静态资源位置进行了扩充，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static String[] getResourceLocations(String[] staticLocations) {</span><br><span class="line">        String[] locations = new String[staticLocations.length + SERVLET_LOCATIONS.length];</span><br><span class="line">        System.arraycopy(staticLocations, 0, locations, 0, staticLocations.length);</span><br><span class="line">        System.arraycopy(SERVLET_LOCATIONS, 0, locations, staticLocations.length, SERVLET_LOCATIONS.length);</span><br><span class="line">        return locations;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p>再来看一下这行代码<code>private static final String[] SERVLET_LOCATIONS = new String[]{"/"};</code>，它告诉我们这个<code>SERVLET_LOCATIONS</code>其实是一个字符串数组，值为<code>{"/"}</code>。</p>
<p>通过前面的分析可以知道，SpringBoot默认会过滤所有的静态资源，而静态资源一共有5个位置，分别为：<code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>、<code>classpath:/public/</code>、和<code>/</code>，也就是说开发者可以将静态资源放到这5个位置中的任意一个。注意需要按照定义的顺序，5个静态资源位置的优先级依次降低。但是通常SpringBoot项目不需要webapp目录，所以第5个<code>/</code>一般不会考虑。</p>
<p>你可以尝试按照上面的方式来创建对应的4个目录，4个目录中放入同名的静态资源（序号表示优先级）：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-de0d2e47bd22eeea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-de0d2e47bd22eeea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>启动项目，在浏览器地址栏中输入<code>http://localhost:8080/avatar.jpg</code>就可以访问到<code>classpath:/META-INF/resources/</code>目录下的<code>avatar.jpg</code>。如果将<code>classpath:/META-INF/resources/</code>目录下的<code>avatar.jpg</code>删除掉，那么访问的就是<code>classpath:/resources/</code>目录下的<code>avatar.jpg</code>文件，以此类推。如果你使用IDEA来创建SpringBoot项目，那么它会默认创建出<code>classpath:/static/</code>，也就是序号3对应的路径，此时静态资源一般就放在这个目录下。</p>
<h3 id="自定义策略"><a href="#自定义策略" class="headerlink" title="自定义策略"></a>自定义策略</h3><p>如果默认的静态资源过滤策略不能满足开发需求，也可以自定义静态资源过滤策略，同样自定义静态资源过滤策略有两种方式：</p>
<p><strong>（1）在配置文件中定义。</strong>这种方式是最简单的，只需要在<code>application.properties</code>配置文件中直接定义过滤规则和静态资源位置：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置访问路径前缀</span><br><span class="line">spring.mvc.static-path-pattern=/static/**</span><br><span class="line"># 设置静态资源路径</span><br><span class="line">spring.resources.static-locations=classpath:/static/</span><br></pre></td></tr></tbody></table></figure></div>
<p>这里设置了过滤规则为<code>/static/**</code>，静态资源位置为<code>classpath:/static/</code>。</p>
<p>启动项目，在浏览器地址栏中输入<code>http://localhost:8080/static/avatar.jpg</code>就可以访问到<code>classpath:/static/</code>目录下的<code>avatar.jpg</code>资源文件。</p>
<p><strong>（2）通过java代码定义。</strong>其实也可以通过书写一个类，只要它实现<code>WebMvcConfigurer</code>接口中的<code>addResourceHandlers</code>方法即可，相应的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.webspringboot.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">/**静态文件访问配置**/</span><br><span class="line">@Configuration</span><br><span class="line">public class MyResourceWebMvcConfig  implements WebMvcConfigurer {</span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br><span class="line">        //第一个方法设置访问路径前缀，第二个方法设置资源路径</span><br><span class="line">        registry.addResourceHandler("/static/**").addResourceLocations("classpath:/static/");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>同样启动项目，在浏览器地址栏中输入<code>http://localhost:8080/static/avatar.jpg</code>依然可以访问到<code>classpath:/static/</code>目录下的<code>avatar.jpg</code>资源文件。</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><p>SpringMVC对文件上传做了简化，在SpringBoot中这种简化就更彻底了，几乎是零配置。</p>
<p>Java中文件的上传涉及到两个组件：<code>CommonsMultipartResolver</code>和<code>StandardServletMultipartResolver</code>。其中<code>CommonsMultipartResolver</code>使用<code>commons-fileupload</code>来处理mutilpart请求，而<code>StandardServletMultipartResolver</code>则是基于Servlet3.0来处理mutilpart请求，所以如果你使用<code>CommonsMultipartResolver</code>，则不需要添加额外的Jar包。众所周知，Tomcat自7.0版本开始就支持Servlet3.0，而此处使用的SpringBoot版本为2.1.14，内嵌的Tomcat版本为9.0.34，所以其实不用添加额外的Jar包，也是可以直接使用<code>StandardServletMultipartResolver</code>的。SpringBoot提供的文件上传自动配置类<code>MultipartAutoConfiguration</code>中，默认也是使用了<code>StandardServletMultipartResolver</code>，部分源码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Bean(</span><br><span class="line">        name = {"multipartResolver"}</span><br><span class="line">    )</span><br><span class="line">    @ConditionalOnMissingBean({MultipartResolver.class})</span><br><span class="line">    public StandardServletMultipartResolver multipartResolver() {</span><br><span class="line">        StandardServletMultipartResolver multipartResolver = new StandardServletMultipartResolver();</span><br><span class="line">        multipartResolver.setResolveLazily(this.multipartProperties.isResolveLazily());</span><br><span class="line">        return multipartResolver;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-c338a712e644008c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-c338a712e644008c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>注意到没有，它使用了<code>@ConditionalOnMissingBean</code>注解，也就是说如果开发者没有提供<code>MultipartResolver</code>，那么就会采用默认的<code>MultipartResolver</code>也就是<code>StandardServletMultipartResolver</code>。所以前面就说了，SpringBoot基本上做到了上文文件时的零配置。</p>
<h3 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h3><p>首先创建一个SpringBoot的Web项目（名称为filespringboot），然后在resources目录的static目录下新建一个<code>fileupload.html</code>文件，该文件用于测试单文件上传：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <meta charset="UTF-8"></span><br><span class="line">    <title>单文件上传</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><form action="/upload" method="post" enctype="multipart/form-data"><br><span class="line">    <input type="file" name="uploadFile" value="请选择文件"></span><br><span class="line">    <input type="submit" value="开始上传"></span><br><span class="line"></span></form><br><span class="line"></span><br><span class="line"></span><br></span></pre></td></tr></tbody></table></figure></div>
<p>这个页面非常的简单，就是一个演示单文件上传的demo，上传使用的接口是<code>/upload</code>，请求方式是Post，这个name控件中的<code>uploadFile</code>就是后续action方法中传入的<code>MultipartFile</code>对象。特别注意就是需要设置<code>enctype="multipart/form-data"</code>，这个配置非常重要，博主曾经就因为这个而导致无法修复Bug。。。</p>
<p>接着就是新建一个<code>FileUploadController</code>，用于处理文件上传接口，这样我们让文件上传后返回一个String格式的URL地址。里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.filespringboot.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class FileUploadController {</span><br><span class="line">    SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy/MM/dd/");</span><br><span class="line"></span><br><span class="line">    @PostMapping("/upload")</span><br><span class="line">    public String upload(MultipartFile uploadFile, HttpServletRequest request){</span><br><span class="line">        String realPath = request.getSession().getServletContext().getRealPath("/uploadFile/");</span><br><span class="line">        String format = simpleDateFormat.format(new Date());</span><br><span class="line">        File folder = new File(realPath+format);</span><br><span class="line">        if(!folder.isDirectory()){</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        }</span><br><span class="line">        String oldName = uploadFile.getOriginalFilename();</span><br><span class="line">        String newName = UUID.randomUUID().toString()+oldName.substring(oldName.lastIndexOf("."), oldName.length());</span><br><span class="line">        try{</span><br><span class="line">            uploadFile.transferTo(new File(folder,newName));</span><br><span class="line">            String filePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+"/uploadFile/"+format+newName;</span><br><span class="line">            return filePath;</span><br><span class="line">        }catch (IOException e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        return "文件上传失败";</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>解释一下上面代码的含义：首先我们设置上传文件的保存路径为项目运行目录下的<code>uploadFile</code>文件夹（目前就先这样，后期会结合自定义静态资源访问路径来让上传的文件保存在static目录下），并通过日期对所上传的文件进行归类保存。同时为避免文件名称重复，使用UUID给上传的文件进行了重命名。然后就是一些文件的保存操作。最后就是生成上传文件的访问路径，并将访问路径返回。</p>
<p>启动项目，在浏览器地址栏中输入<code>http://localhost:8080/fileupload.html</code>即可访问到该页面，选择一张图片后，点击上传按钮，即可返回对应的URL地址：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-dab721116851a0a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-dab721116851a0a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-2d803a41d4e721c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-2d803a41d4e721c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-4ad0f5f60db16ff1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-4ad0f5f60db16ff1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>你可能会好奇这里的图片怎么直接能被访问呢？其实静态资源位置除了classpath下面的4个路径之外，还有一个”/“，而此处的图片就是放在了”/“下，因此这里的图片虽说是静态资源，却可以直接访问的到。</p>
<p>这样一个简单的图片上传逻辑就完成了，开发者并没有花太多的时间在配置上，而是专注于图片逻辑的实现。</p>
<p>当然如果你想对图片上传的细节进行配置，如设置上传图片的大小限制，本地存放地址等，这些都是可以的。你只需要在<code>application.properties</code>配置文件中添加如下代码：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 是否开启文件上传支持，默认为true</span><br><span class="line">spring.servlet.multipart.enabled=true</span><br><span class="line"># 文件写入磁盘的阈值，默认为0</span><br><span class="line">spring.servlet.multipart.file-size-threshold=0</span><br><span class="line"># 上传文件的临时保存位置</span><br><span class="line">spring.servlet.multipart.location=F:\\temp</span><br><span class="line"># 上传的单个文件的最大大小，默认为1MB</span><br><span class="line">spring.servlet.multipart.max-file-size=1MB</span><br><span class="line"># 多文件上传时文件的总大小，默认为10MB</span><br><span class="line">spring.servlet.multipart.max-request-size=10MB</span><br><span class="line"># 文件是否延迟解析，默认为false</span><br><span class="line">spring.servlet.multipart.resolve-lazily=false</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h3><p>说完了单文件的上传，接下来介绍多文件的上传，它几乎和单文件上传一致。首先新建一个uploads.html文件，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <meta charset="UTF-8"></span><br><span class="line">    <title>多文件上传</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><form action="/uploads" method="post" enctype="multipart/form-data"><br><span class="line">    <input type="file" name="uploadFiles" value="请选择文件" multiple></span><br><span class="line">    <input type="submit" value="开始上传"></span><br><span class="line"></span></form><br><span class="line"></span><br><span class="line"></span><br></span></pre></td></tr></tbody></table></figure></div>
<p>这个页面也简单，就是一个演示多文件上传的demo，上传使用的接口是/uploads，请求方式是Post，这个name控件中的uploadFiles就是后续action方法中传入的<code>MultipartFile[]</code>对象。特别注意就是需要设置<code>enctype="multipart/form-data"</code>和在input输入框后使用<code>multiple</code>来标明这个是多文件上传按钮。</p>
<p>接着在<code>FileUploadController</code>类中新建一个uploads方法，用于处理多文件上传的逻辑。同样文件上传成功后返回一个JSON格式的数组，里面包含各个图片的访问地址。里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 多文件上传</span><br><span class="line">     * **/</span><br><span class="line">    @PostMapping("/uploads")</span><br><span class="line">    public String uploads (MultipartFile[] uploadFiles, HttpServletRequest request){</span><br><span class="line">        String realPath = request.getSession().getServletContext().getRealPath("/uploadFile/");</span><br><span class="line">        String format = simpleDateFormat.format(new Date());</span><br><span class="line">        File folder = new File(realPath+format);</span><br><span class="line">        if(!folder.isDirectory()){</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        }</span><br><span class="line">        List<string>stringList = new ArrayList<>();</string></span><br><span class="line">        for(MultipartFile uploadFile:uploadFiles){</span><br><span class="line">            String oldName = uploadFile.getOriginalFilename();</span><br><span class="line">            String newName = UUID.randomUUID().toString()+oldName.substring(oldName.lastIndexOf("."), oldName.length());</span><br><span class="line">            try{</span><br><span class="line">                uploadFile.transferTo(new File(folder,newName));</span><br><span class="line">                String filePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+"/uploadFile/"+format+newName;</span><br><span class="line">                stringList.add(filePath);</span><br><span class="line">            }catch (IOException e){</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return "文件上传失败";</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        JSONArray jsonArray = JSONUtil.parseArray(stringList);</span><br><span class="line">        return jsonArray.toString();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p>这里其实和单文件的逻辑几乎一致，唯一不同之处，在于多了一个遍历uploadFiles的步骤，以及最后将java list对象序列化为jsonarray对象。</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-7f22db596f81e9e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-7f22db596f81e9e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<h1 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h1><p>接下来介绍<code>@ControllerAdvice</code>注解相关的内容。顾名思义，<code>@ControllerAdvice</code>就是<code>@Controller</code>的增强版，因为在SpringMVC中Advice就是通知，增强的意思，特别是在AOP中，用的更为广泛。<code>@ControllerAdvice</code>主要用来处理全局数据，一般搭配<code>@ExceptionHandler</code>、<code>@ModelAttribute</code>以及<code>@InitBinder</code>使用。这个在日常工作过程中使用的还是较为频繁，特别是搭配<code>@ExceptionHandler</code>用于处理全局异常，在前后端分离的情况下，对于返回统一的数据格式显得尤为重要。</p>
<h3 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h3><p><code>@ControllerAdvice</code>最常见的使用场景就是全局异常处理。前面通过在<code>aplication.properties</code>配置文件中设置了上传文件大小的限制的配置，如果用户上传的文件超过了限制大小，此时就会抛异常，此时你就可以通过<code>@ControllerAdvice</code>结合<code>@ExceptionHandler</code>注解来定义全局异常捕获机制。在<code>com.envy.filespringboot</code>包内新建一个<code>handler</code>包，接着在里面新建一个<code>CustomExceptionHandler</code>类，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">public class CustomExceptionHandler {</span><br><span class="line">    @ExceptionHandler(MaxUploadSizeExceededException.class)</span><br><span class="line">    public void uploadException(MaxUploadSizeExceededException e, HttpServletResponse response) throws IOException {</span><br><span class="line">        response.setContentType("text/html;charset=utf-8");</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.write("上传文件大小超出限制");</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>只需要在系统中定义<code>CustomExceptionHandler</code>类，然后添加<code>@ControllerAdvice</code>注解即可。当系统启动时，该类就会被扫描到Spring容器中，然后定义<code>uploadException</code>方法，需要在该方法上添加<code>@ExceptionHandler</code>注解，其中定义的<code>MaxUploadSizeExceededException.class</code>表明该方法用来处理<code>MaxUploadSizeExceededException</code>类型的异常。如果想让该方法处理所有的异常，只需将<code>MaxUploadSizeExceededException</code>换成<code>Exception</code>即可。方法的参数可以有异常实例、<code>HttpServletResponse</code>、<code>HttpServletRequest</code>、<code>Model</code>等。同样它的返回值可以是一个JSON对象、一个<code>ModelAndView</code>、一个逻辑视图名等。下现在尝试启动项目，上传一个超大的文件，看是否有错误提示给用户：</p>
<p><a href="https://upload-images.jianshu.io/upload_images/8964398-188248f81d2b9346.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title class="mediumZoom lazyload" data-src="https://upload-images.jianshu.io/upload_images/8964398-188248f81d2b9346.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></a></p>
<p>如果返回参数是一个<code>ModelAndView</code>，假设使用的页面模板为<code>Thymeleaf</code>（注意你需要在pom.xml文件中添加<code>Thymeleaf</code>相关依赖），此时异常处理方法定义如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 使用了Thymeleaf模板</span><br><span class="line"> * **/</span><br><span class="line">@ControllerAdvice</span><br><span class="line">public class CustomExceptionHandler {</span><br><span class="line">    @ExceptionHandler(MaxUploadSizeExceededException.class)</span><br><span class="line">    public ModelAndView uploadException(MaxUploadSizeExceededException e) throws IOException {</span><br><span class="line">        ModelAndView modelAndView = new ModelAndView();</span><br><span class="line">        modelAndView.addObject("msg","上传文件大小超出限制");</span><br><span class="line">        modelAndView.setViewName("error");</span><br><span class="line">        return modelAndView;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>同时为了让错误信息得到显示，你还需要在<code>resources/templates</code>目录下新建一个<code>error.html</code>文件：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <meta charset="UTF-8"></span><br><span class="line">    <title>错误信息</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><div th:text="${ msg }"><br><span class="line"></span><br><span class="line"></span></div></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>然后运行项目，可以发现这个也能实现之前相同的效果。</p>
<h3 id="添加全局数据"><a href="#添加全局数据" class="headerlink" title="添加全局数据"></a>添加全局数据</h3><p><code>@ControllerAdvice</code>是一个全局数据处理组件，因此也可以在<code>@ControllerAdvice</code>中配置全局数据，使用<code>@ModelAttribute</code>注解进行配置，你可以新建一个<code>GlobalConfig</code>类，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">public class GlobalConfig {</span><br><span class="line"></span><br><span class="line">    @ModelAttribute(value = "info")</span><br><span class="line">    public Map<string,string> userInfo(){</string,string></span><br><span class="line">        Map<string,string> map =new HashMap<>();</string,string></span><br><span class="line">        map.put("username","吴承恩");</span><br><span class="line">        map.put("gender","男");</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>这里定义了一个全局配置类<code>GlobalConfig</code>，并添加了userInfo方法，返回一个map对象。该方法有一个<code>@ModelAttribute</code>注解，其中的value属性表示这条返回数据的key，而方法的返回值是返回数据的value。这样在任意请求的Controller中，通过方法参数中的Model都可以获取info的数据。在之前的<code>FileUploadController</code>类中新增一个hello方法，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 演示ModelAttribute信息获取</span><br><span class="line">     * **/</span><br><span class="line">    @GetMapping("/hello")</span><br><span class="line">    public void hello(Model model){</span><br><span class="line">        Map<string,object> map = model.asMap();</string,object></span><br><span class="line">        Set<string> keySet= map.keySet();</string></span><br><span class="line">        Iterator<string> iterator = keySet.iterator();</string></span><br><span class="line">        while (iterator.hasNext()){</span><br><span class="line">            String key = iterator.next();</span><br><span class="line">            Object value = map.get(key);</span><br><span class="line">            System.out.println(key+">>>>>>"+value);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>
<p>这个Model是一个接口，其中定义了一些方法，此处就是使用了它的asMap方法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface Model {</span><br><span class="line">    Model addAttribute(String var1, @Nullable Object var2);</span><br><span class="line">    Model addAttribute(Object var1);</span><br><span class="line">    Model addAllAttributes(Collection<!--?--> var1);</span><br><span class="line">    Model addAllAttributes(Map<string, ?> var1);</string,></span><br><span class="line">    Model mergeAttributes(Map<string, ?> var1);</string,></span><br><span class="line">    boolean containsAttribute(String var1);</span><br><span class="line">    Map<string, object> asMap();</string,></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>然后启动项目，访问hello方法，可以发现控制台输出以下信息：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info>>>>>>{gender=男, username=吴承恩}</span><br></pre></td></tr></tbody></table></figure></div>
<p>可以发现这个key确实是info，也就是前面<code>@ModelAttribute</code>中设置的value的值。</p>
<h3 id="请求参数预处理"><a href="#请求参数预处理" class="headerlink" title="请求参数预处理"></a>请求参数预处理</h3><p><code>@ControllerAdvice</code>结合<code>@InitBinder</code>还能实现请求参数预处理，即将表单中的数据绑定到实体类上时进行一些额外的处理。</p>
<p>在pojo包中定义两个实体类Book和Author，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.envy.filespringboot.pojo;</span><br><span class="line"></span><br><span class="line">public class Book {</span><br><span class="line">    private String name;</span><br><span class="line">    private String author;</span><br><span class="line">    //getter、setter和toString方法</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public class Author {</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    //getter、setter和toString方法</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>可能你也注意到此时故意在Book和Author类中定义了同名属性name，这个在实际开发过程中也是经常会遇到的问题。现在需要在Controller上接收两个实体类的数据，那么可以在Controller中定义一个book方法，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 请求参数预处理</span><br><span class="line">    * **/</span><br><span class="line">   @GetMapping("book")</span><br><span class="line">   public String book(Book book, Author author){</span><br><span class="line">       return book.toString()+"  >>>>>>  "+author.toString();</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div>
<p>那么在参数传递时，两个实体类中的name属性就会被混淆，此时你可以使用<code>@ControllerAdvice</code>结合<code>@InitBinder</code>注解就能解决这个问题。配置步骤如下。首先给Controller中<strong>book方法的参数</strong>添加<code>@ModelAttribute</code>注解，代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 请求参数预处理</span><br><span class="line">    * **/</span><br><span class="line">   @GetMapping("book")</span><br><span class="line">   public String book(@ModelAttribute("b")Book book,@ModelAttribute("a") Author author){</span><br><span class="line">       return book.toString()+"  >>>>>>  "+author.toString();</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div>
<p>既然使用了<code>@ModelAttribute</code>注解，那么需要定义一个<code>GlobalConfig</code>配置类，里面的代码为：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 配合InitBinder注解</span><br><span class="line"> * **/</span><br><span class="line">@ControllerAdvice</span><br><span class="line">public class GlobalConfig {</span><br><span class="line">    @InitBinder("b")</span><br><span class="line">    public void init(WebDataBinder binder){</span><br><span class="line">        binder.setFieldDefaultPrefix("b.");</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @InitBinder("a")</span><br><span class="line">    public void init2(WebDataBinder binder){</span><br><span class="line">        binder.setFieldDefaultPrefix("a.");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>解释一下上述代码的含义，在<code>GlobalConfig</code>类中定义了两个方法：第一个<code>@InitBinder("b")</code>表示该方法是处理<code>@ModelAttribute("b")</code>对应的参数，第二个<code>@InitBinder("a")</code>表示该方法是处理<code>@ModelAttribute("a")</code>对应的参数。然后在每个init方法中都给相应的Filed设置了一个前缀，然后运行项目，在浏览器地址栏中输入<code>http://localhost:8080/book?b.name=西游记&b.author=吴承恩&a.name=罗贯中&a.age=188</code>，这样就能成功地区分出name的属性。浏览器页面输出：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book{name='西游记', author='吴承恩'}  >>>>>>  Author{name='罗贯中', age=188}</span><br></pre></td></tr></tbody></table></figure></div>
<p>当然在<code>WebDataBinder</code>对象中，还可以设置允许的字段、禁止的字段、必填字段以及验证器等等。</p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">余思</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://envyzhan.top/2019/08/11/springboot-4-web-development-union-one/">http://envyzhan.top/2019/08/11/springboot-4-web-development-union-one/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://envyzhan.top">余思博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/08/13/springboot-5-web-development-union-two/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>SpringBoot Web开发整合（中）</span></div></a></div><div class="next-post pull_right"><a href="/2019/08/09/springboot-3-view-layer-union/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>视图层技术整合</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/09/28/springboot-22-union-one-fastDFS/" title="整合单机版FastDFS"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">整合单机版FastDFS</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/25/springboot-21-project-build-and-development/" title="项目构建与部署"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">项目构建与部署</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/22/springboot-20-application-monitor/" title="应用监控"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">应用监控</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/19/springboot-19-usual-development-for-enterprise-two/" title="企业开发常用功能（下）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">企业开发常用功能（下）</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/16/springboot-18-usual-development-for-enterprise-one/" title="企业开发常用功能（上）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">企业开发常用功能（上）</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/13/springboot-17-message-service/" title="消息服务"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-01</div><div class="relatedPosts_title">消息服务</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '9996b44b488f2fc52124',
  clientSecret: '6bec0f8e9c032eeae6211a5d4cffa3c97e2d4a64',
  repo: 'blogcomment',
  owner: 'Envythink',
  admin: 'Envythink',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">Copyright &copy;2017-2021 余思博客, 版权所有</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script src="/js/tw_cn.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>